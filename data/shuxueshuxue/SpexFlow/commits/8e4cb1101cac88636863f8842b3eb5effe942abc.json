{
  "cached_at": "2025-12-22T15:31:55.351237",
  "commit_sha": "8e4cb1101cac88636863f8842b3eb5effe942abc",
  "repo": "shuxueshuxue/SpexFlow",
  "data": {
    "sha": "8e4cb1101cac88636863f8842b3eb5effe942abc",
    "node_id": "C_kwDOQnjG49oAKDhlNGNiMTEwMWNhYzg4NjM2ODYzZjg4NDJiM2ViNWVmZmU5NDJhYmM",
    "commit": {
      "author": {
        "name": "shuxueshuxue",
        "email": "lexicalmathical@gmail.com",
        "date": "2025-12-20T10:19:42Z"
      },
      "committer": {
        "name": "shuxueshuxue",
        "email": "lexicalmathical@gmail.com",
        "date": "2025-12-20T10:19:42Z"
      },
      "message": "add canvas settings and default repo path",
      "tree": {
        "sha": "5d5b4e26008e6e64e073d8783efebf4dd741fc8e",
        "url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/git/trees/5d5b4e26008e6e64e073d8783efebf4dd741fc8e"
      },
      "url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/git/commits/8e4cb1101cac88636863f8842b3eb5effe942abc",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null,
        "verified_at": null
      }
    },
    "url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/commits/8e4cb1101cac88636863f8842b3eb5effe942abc",
    "html_url": "https://github.com/shuxueshuxue/SpexFlow/commit/8e4cb1101cac88636863f8842b3eb5effe942abc",
    "comments_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/commits/8e4cb1101cac88636863f8842b3eb5effe942abc/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "00ce1a8adbed7473f5c0bc71faf89704d007e619",
        "url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/commits/00ce1a8adbed7473f5c0bc71faf89704d007e619",
        "html_url": "https://github.com/shuxueshuxue/SpexFlow/commit/00ce1a8adbed7473f5c0bc71faf89704d007e619"
      }
    ],
    "stats": {
      "total": 1108,
      "additions": 705,
      "deletions": 403
    },
    "files": [
      {
        "sha": "e1b13d94863c3e67c8038fc0c460a9dff1d38492",
        "filename": "server/appData.ts",
        "status": "modified",
        "additions": 15,
        "deletions": 1,
        "changes": 16,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/server%2FappData.ts",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/server%2FappData.ts",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/server%2FappData.ts?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -563,7 +563,21 @@ export async function loadAppData(): Promise<AppData> {\n }\n \n export async function saveAppData(data: AppData): Promise<void> {\n-  const raw = JSON.stringify(data, null, 2)\n+  const toPersist: AppData = {\n+    ...data,\n+    tabs: data.tabs.map((tab) => {\n+      const { canvasSettings, ...rest } = tab\n+      return {\n+        ...rest,\n+        canvas: {\n+          nodes: [],\n+          edges: [],\n+          viewport: tab.canvas.viewport,\n+        },\n+      }\n+    }),\n+  }\n+  const raw = JSON.stringify(toPersist, null, 2)\n   await writeFile(dataPath, raw, 'utf-8')\n }\n "
      },
      {
        "sha": "9dccbc8b30cddd0f8f16b9fd8372ce422db29dee",
        "filename": "server/index.ts",
        "status": "modified",
        "additions": 18,
        "deletions": 1,
        "changes": 19,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/server%2Findex.ts",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/server%2Findex.ts",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/server%2Findex.ts?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -1,5 +1,5 @@\n import express from 'express'\n-import { mkdir, readFile, readdir, stat, writeFile } from 'node:fs/promises'\n+import { mkdir, readFile, readdir, stat, unlink, writeFile } from 'node:fs/promises'\n import path from 'node:path'\n import { runRelaceSearch } from './relaceSearch.js'\n import { loadAppData, saveAppData, getCodeSearchApiKey } from './appData.js'\n@@ -197,6 +197,23 @@ app.get('/api/canvases/load', async (req, res) => {\n   }\n })\n \n+app.delete('/api/canvases', async (req, res) => {\n+  try {\n+    await ensureCanvasesDir()\n+    const fileName = req.query.path\n+    if (typeof fileName !== 'string' || !fileName.trim()) throw new Error('path required')\n+    if (fileName.includes('/') || fileName.includes('\\\\')) throw new Error('Invalid path')\n+\n+    const filePath = path.join(CANVASES_DIR, fileName)\n+    await unlink(filePath)\n+    res.json({ ok: true })\n+  } catch (err: unknown) {\n+    console.error(err)\n+    const message = err instanceof Error ? err.message : String(err)\n+    res.status(500).json({ error: message })\n+  }\n+})\n+\n app.post('/api/repo-context', async (req, res) => {\n   try {\n     const repoPathRaw = req.body?.repoPath"
      },
      {
        "sha": "f0a3621c4116d76ed2bba2f58a0c8ae289d87e07",
        "filename": "shared/appDataTypes.ts",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/shared%2FappDataTypes.ts",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/shared%2FappDataTypes.ts",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/shared%2FappDataTypes.ts?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -120,12 +120,17 @@ export type Canvas<N, E> = {\n   viewport: Viewport\n }\n \n+export type CanvasSettings = {\n+  defaultRepoPath?: string\n+}\n+\n export type Tab<N, E> = {\n   id: string\n   name: string\n   createdAt: string\n   canvas: Canvas<N, E>\n   savedFilePath?: string\n+  canvasSettings?: CanvasSettings\n }\n \n export type AppData<N, E> = {"
      },
      {
        "sha": "aae664247a776302bd35e7f7b11ee2a3a9656610",
        "filename": "src/App.css",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2FApp.css",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2FApp.css",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2FApp.css?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -1109,6 +1109,17 @@\n   cursor: not-allowed;\n }\n \n+.sfButtonGroup--tight {\n+  align-items: center;\n+}\n+\n+.sfButtonGroup--tight button {\n+  flex: 0 0 auto;\n+  min-width: 0;\n+  padding: 4px 10px;\n+  border-radius: 4px;\n+}\n+\n /* ===== Output Section ===== */\n .sfOutputSection {\n   margin-top: 16px;"
      },
      {
        "sha": "ea3c6781b59f4b56f1ba50e93ab7e03f85b6a13e",
        "filename": "src/specflow/SpecFlowApp.tsx",
        "status": "modified",
        "additions": 30,
        "deletions": 144,
        "changes": 174,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2FSpecFlowApp.tsx",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2FSpecFlowApp.tsx",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2FSpecFlowApp.tsx?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -3,7 +3,7 @@ import { ReactFlow, Background, MiniMap } from '@xyflow/react'\n import '@xyflow/react/dist/style.css'\n \n import { useAppData, useNodeRunner, useChainRunner, useClipboard, useHotkeys } from './hooks'\n-import { NodeSidebar, ToolbarButton, MultiSelectInfo, APISettingsModal, SettingsIcon, DropdownMenu, CanvasFilePicker, ConfirmModal } from './components'\n+import { NodeSidebar, ToolbarButton, MultiSelectInfo, APISettingsModal, SettingsIcon, DropdownMenu, CanvasFilePicker, CanvasSettingsModal, CanvasIcon } from './components'\n import type { APISettings, AppData, Viewport } from './types'\n import type { Dispatch, RefObject, SetStateAction } from 'react'\n import {\n@@ -20,7 +20,6 @@ import {\n import { ChainManager } from './ChainManager'\n import { canRunFromPredecessors, predecessors, sameIdSet } from './utils'\n import { t } from './i18n'\n-import { listCanvasFiles, loadCanvasFile } from './api'\n import {\n   CodeSearchConductorNodeView,\n   CodeSearchNodeView,\n@@ -58,7 +57,6 @@ function SpecFlowAppLoaded(props: ReturnType<typeof useAppData> & { appData: App\n     loadError,\n     setActiveTabId,\n     addTab,\n-    renameTab,\n     closeTab,\n     deleteSelectedNodes,\n     archiveSelectedNodes,\n@@ -71,9 +69,11 @@ function SpecFlowAppLoaded(props: ReturnType<typeof useAppData> & { appData: App\n     addNode,\n     patchSelectedNode,\n     patchNodeById,\n-    saveCurrentCanvas,\n-    saveCanvasAs,\n     loadCanvas,\n+    renameCanvas,\n+    deleteCanvas,\n+    duplicateCanvas,\n+    updateCanvasSettings,\n   } = props\n \n   const appDataRef = props.appDataRef as RefObject<AppData>\n@@ -108,14 +108,17 @@ function SpecFlowAppLoaded(props: ReturnType<typeof useAppData> & { appData: App\n \n   const [isDragSelecting, setIsDragSelecting] = useState(false)\n   const [isSettingsOpen, setIsSettingsOpen] = useState(false)\n-  const [isSaveAsOpen, setIsSaveAsOpen] = useState(false)\n   const [isLoadPickerOpen, setIsLoadPickerOpen] = useState(false)\n-  const [saveState, setSaveState] = useState<'idle' | 'saving' | 'saved'>('idle')\n-  const saveStateTimerRef = useRef<number | null>(null)\n-  const [overwriteWarning, setOverwriteWarning] = useState<null | { kind: 'save' } | { kind: 'saveAs'; fileName: string }>(null)\n+  const [isCanvasSettingsOpen, setIsCanvasSettingsOpen] = useState(false)\n+  const [canvasSettingsTabId, setCanvasSettingsTabId] = useState<string | null>(null)\n \n   const language = appData.ui.language\n \n+  const canvasSettingsTab = useMemo(() => {\n+    if (!canvasSettingsTabId) return activeTab\n+    return appData.tabs.find((t) => t.id === canvasSettingsTabId) ?? activeTab\n+  }, [activeTab, appData.tabs, canvasSettingsTabId])\n+\n   const mutedNodeIds = useMemo(() => {\n     return new Set(activeTab.canvas.nodes.filter((n) => n.data.muted).map((n) => n.id))\n   }, [activeTab.canvas.nodes])\n@@ -209,88 +212,6 @@ function SpecFlowAppLoaded(props: ReturnType<typeof useAppData> & { appData: App\n     }))\n   }, [setAppDataStrict])\n \n-  const safeDefaultSaveName = useMemo(() => {\n-    const safe = activeTab.name.trim().replace(/[^a-zA-Z0-9_-]/g, '_')\n-    return safe || 'canvas'\n-  }, [activeTab.name])\n-\n-  useEffect(() => {\n-    return () => {\n-      if (saveStateTimerRef.current) window.clearTimeout(saveStateTimerRef.current)\n-    }\n-  }, [])\n-\n-  const markSaved = useCallback(() => {\n-    setSaveState('saved')\n-    if (saveStateTimerRef.current) window.clearTimeout(saveStateTimerRef.current)\n-    saveStateTimerRef.current = window.setTimeout(() => setSaveState('idle'), 1500)\n-  }, [])\n-\n-  const doSaveCurrentNoCheck = useCallback(async () => {\n-    const result = await saveCurrentCanvas()\n-    if (result.needsSaveAs) {\n-      setSaveState('idle')\n-      setIsSaveAsOpen(true)\n-      return\n-    }\n-    markSaved()\n-  }, [markSaved, saveCurrentCanvas])\n-\n-  const doSaveAsNoCheck = useCallback(async (safeName: string) => {\n-    await saveCanvasAs(safeName)\n-    markSaved()\n-  }, [markSaved, saveCanvasAs])\n-\n-  const handleSave = useCallback(async () => {\n-    setSaveState('saving')\n-    try {\n-      if (!activeTab.savedFilePath) {\n-        setSaveState('idle')\n-        setIsSaveAsOpen(true)\n-        return\n-      }\n-\n-      const existing = await loadCanvasFile(activeTab.savedFilePath)\n-      if (existing.id !== activeTab.id) {\n-        setSaveState('idle')\n-        setOverwriteWarning({ kind: 'save' })\n-        return\n-      }\n-\n-      await doSaveCurrentNoCheck()\n-    } catch (err) {\n-      setSaveState('idle')\n-      alert(String((err as Error)?.message ?? err))\n-    }\n-  }, [activeTab.id, activeTab.savedFilePath, doSaveCurrentNoCheck])\n-\n-  const handleSaveAs = useCallback(\n-    async (fileNameRaw: string) => {\n-      setSaveState('saving')\n-      try {\n-        const safeName = fileNameRaw.trim().replace(/[^a-zA-Z0-9_-]/g, '_')\n-        if (!safeName) throw new Error('Invalid file name')\n-\n-        const list = await listCanvasFiles()\n-        const exists = (list.files ?? []).some((f) => f.path === `${safeName}.canvas.json`)\n-        if (exists) {\n-          const existing = await loadCanvasFile(`${safeName}.canvas.json`)\n-          if (existing.id !== activeTab.id) {\n-            setSaveState('idle')\n-            setOverwriteWarning({ kind: 'saveAs', fileName: safeName })\n-            return\n-          }\n-        }\n-\n-        await doSaveAsNoCheck(safeName)\n-      } catch (err) {\n-        setSaveState('idle')\n-        alert(String((err as Error)?.message ?? err))\n-      }\n-    },\n-    [activeTab.id, doSaveAsNoCheck],\n-  )\n-\n   const nodeTypes = useMemo(\n     () => ({\n       'code-search': CodeSearchNodeView,\n@@ -367,7 +288,9 @@ function SpecFlowAppLoaded(props: ReturnType<typeof useAppData> & { appData: App\n               className=\"sfTabName\"\n               onDoubleClick={(e) => {\n                 e.stopPropagation()\n-                renameTab(t.id)\n+                setActiveTabId(t.id)\n+                setCanvasSettingsTabId(t.id)\n+                setIsCanvasSettingsOpen(true)\n               }}\n               title={t.name}\n             >\n@@ -398,24 +321,14 @@ function SpecFlowAppLoaded(props: ReturnType<typeof useAppData> & { appData: App\n \n         <div className=\"sfTabActions\">\n           <button\n-            className={`sfSaveBtn ${saveState === 'saved' ? 'sfSaved' : ''}`}\n-            onClick={handleSave}\n-            disabled={saveState === 'saving'}\n-            title={t(language, 'save')}\n-          >\n-            {saveState === 'saved'\n-              ? t(language, 'canvas_saved')\n-              : saveState === 'saving'\n-                ? t(language, 'saving')\n-                : t(language, 'save')}\n-          </button>\n-          <button\n-            className=\"sfSaveBtn\"\n-            onClick={() => setIsSaveAsOpen(true)}\n-            disabled={saveState === 'saving'}\n-            title={t(language, 'save_as')}\n+            className=\"sfSettingsBtn\"\n+            onClick={() => {\n+              setCanvasSettingsTabId(activeTab.id)\n+              setIsCanvasSettingsOpen(true)\n+            }}\n+            title={t(language, 'canvas_settings')}\n           >\n-            {t(language, 'save_as')}\n+            <CanvasIcon />\n           </button>\n           <button\n             className=\"sfSettingsBtn\"\n@@ -592,42 +505,15 @@ function SpecFlowAppLoaded(props: ReturnType<typeof useAppData> & { appData: App\n         }}\n       />\n \n-      <CanvasFilePicker\n-        isOpen={isSaveAsOpen}\n-        mode=\"save\"\n+      <CanvasSettingsModal\n+        isOpen={isCanvasSettingsOpen}\n+        tab={canvasSettingsTab}\n         language={language}\n-        defaultFileName={safeDefaultSaveName}\n-        onClose={() => setIsSaveAsOpen(false)}\n-        onConfirmSave={(name) => {\n-          setIsSaveAsOpen(false)\n-          handleSaveAs(name)\n-        }}\n-      />\n-\n-      <ConfirmModal\n-        isOpen={overwriteWarning !== null}\n-        title={t(language, 'confirm_overwrite_title')}\n-        message={t(language, 'confirm_overwrite_message')}\n-        confirmLabel={t(language, 'confirm')}\n-        cancelLabel={t(language, 'cancel')}\n-        onCancel={() => setOverwriteWarning(null)}\n-        onConfirm={() => {\n-          const w = overwriteWarning\n-          setOverwriteWarning(null)\n-          if (!w) return\n-          setSaveState('saving')\n-          if (w.kind === 'save') {\n-            doSaveCurrentNoCheck().catch((e) => {\n-              setSaveState('idle')\n-              alert(String((e as Error)?.message ?? e))\n-            })\n-            return\n-          }\n-          doSaveAsNoCheck(w.fileName).catch((e) => {\n-            setSaveState('idle')\n-            alert(String((e as Error)?.message ?? e))\n-          })\n-        }}\n+        onClose={() => setIsCanvasSettingsOpen(false)}\n+        onRename={renameCanvas}\n+        onDuplicate={duplicateCanvas}\n+        onDelete={deleteCanvas}\n+        onUpdateSettings={updateCanvasSettings}\n       />\n     </div>\n   )"
      },
      {
        "sha": "f8e9d1aa4e9e2d1a64e7ad687fad1e5c78192573",
        "filename": "src/specflow/api.ts",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fapi.ts",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fapi.ts",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fapi.ts?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -7,6 +7,7 @@ export type SavedCanvasFile = {\n   id: string\n   name: string\n   savedAt: string\n+  settings?: { defaultRepoPath?: string }\n   canvas: {\n     nodes: AppNode[]\n     edges: Edge[]\n@@ -66,6 +67,14 @@ export async function loadCanvasFile(p: string): Promise<SavedCanvasFile> {\n   return data as SavedCanvasFile\n }\n \n+export async function deleteCanvasFile(p: string): Promise<void> {\n+  const res = await fetch(`/api/canvases?path=${encodeURIComponent(p)}`, { method: 'DELETE' })\n+  const data = await res.json().catch(() => ({}))\n+  if (!res.ok) {\n+    throw new Error(typeof data?.error === 'string' ? data.error : JSON.stringify(data))\n+  }\n+}\n+\n export async function runCodeSearch(args: { repoPath: string; query: string; debugMessages?: boolean; signal?: AbortSignal }) {\n   const res = await fetch('/api/relace-search', {\n     method: 'POST',"
      },
      {
        "sha": "423245988623ab90dd1cc73161b97c0265179a0c",
        "filename": "src/specflow/components/APISettingsModal.tsx",
        "status": "modified",
        "additions": 186,
        "deletions": 192,
        "changes": 378,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FAPISettingsModal.tsx",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FAPISettingsModal.tsx",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fcomponents%2FAPISettingsModal.tsx?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -2,6 +2,7 @@ import { useState, useEffect } from 'react'\n import type { APISettings, LLMProvider, LLMModel } from '../types'\n import type { Language } from '../../../shared/appDataTypes'\n import { t } from '../i18n'\n+import { SettingsModalShell } from './SettingsModalShell'\n \n type Props = {\n   isOpen: boolean\n@@ -117,215 +118,208 @@ export function APISettingsModal({ isOpen, settings, language, onLanguageChange,\n     onClose()\n   }\n \n-  function handleBackdropClick(e: React.MouseEvent) {\n-    if (e.target === e.currentTarget) {\n-      onClose()\n-    }\n-  }\n-\n   return (\n-    <div className=\"sfModalBackdrop\" onClick={handleBackdropClick}>\n-      <div className=\"sfSettingsModal\">\n-        <div className=\"sfModalHeader\">\n-          <span className=\"sfModalTitle\">{t(language, 'settings_title')}</span>\n-          <button className=\"sfModalCloseBtn\" onClick={onClose} title={t(language, 'close')}>Ã—</button>\n-        </div>\n-\n-        <div className=\"sfFieldGroup\" style={{ padding: '0 16px' }}>\n-          <label className=\"sfFieldLabel\">{t(language, 'language')}</label>\n-          <select\n-            className=\"sfSelect\"\n-            value={language}\n-            onChange={(e) => onLanguageChange(e.target.value as Language)}\n-          >\n-            <option value=\"en\">{t(language, 'language_en')}</option>\n-            <option value=\"zh\">{t(language, 'language_zh')}</option>\n-          </select>\n-        </div>\n-\n-        {/* Tab Switcher */}\n-        <div className=\"sfSettingsTabs\">\n-          <button\n-            className={`sfSettingsTab ${activeTab === 'llm' ? 'active' : ''}`}\n-            onClick={() => setActiveTab('llm')}\n-          >\n-            {t(language, 'settings_tab_llm')}\n-          </button>\n-          <button\n-            className={`sfSettingsTab ${activeTab === 'codesearch' ? 'active' : ''}`}\n-            onClick={() => setActiveTab('codesearch')}\n-          >\n-            {t(language, 'settings_tab_codesearch')}\n-          </button>\n-        </div>\n-\n-        <div className=\"sfSettingsContent\">\n-          {activeTab === 'llm' && (\n-            <div className=\"sfLLMSettings\">\n-              {/* Provider List */}\n-              <div className=\"sfProviderList\">\n-                <div className=\"sfProviderListHeader\">\n-                  <span>{t(language, 'providers')}</span>\n-                  <button className=\"sfAddBtn\" onClick={addProvider}>{t(language, 'add')}</button>\n-                </div>\n-                {localSettings.llm.providers.map(provider => (\n-                  <div\n-                    key={provider.id}\n-                    className={`sfProviderItem ${selectedProviderId === provider.id ? 'active' : ''}`}\n-                    onClick={() => setSelectedProviderId(provider.id)}\n-                  >\n-                    <span>{provider.name}</span>\n-                    {provider.apiKey && <span className=\"sfKeyIndicator\">ðŸ”‘</span>}\n-                  </div>\n-                ))}\n+    <SettingsModalShell\n+      isOpen={isOpen}\n+      title={t(language, 'settings_title')}\n+      onClose={onClose}\n+      closeTitle={t(language, 'close')}\n+      footer={\n+        <>\n+          <button className=\"sfCancelBtn\" onClick={onClose}>{t(language, 'cancel')}</button>\n+          <button className=\"sfSaveBtn\" onClick={handleSave}>{t(language, 'save_settings')}</button>\n+        </>\n+      }\n+    >\n+      <div className=\"sfFieldGroup\" style={{ padding: '0 16px' }}>\n+        <label className=\"sfFieldLabel\">{t(language, 'language')}</label>\n+        <select\n+          className=\"sfSelect\"\n+          value={language}\n+          onChange={(e) => onLanguageChange(e.target.value as Language)}\n+        >\n+          <option value=\"en\">{t(language, 'language_en')}</option>\n+          <option value=\"zh\">{t(language, 'language_zh')}</option>\n+        </select>\n+      </div>\n+\n+      {/* Tab Switcher */}\n+      <div className=\"sfSettingsTabs\">\n+        <button\n+          className={`sfSettingsTab ${activeTab === 'llm' ? 'active' : ''}`}\n+          onClick={() => setActiveTab('llm')}\n+        >\n+          {t(language, 'settings_tab_llm')}\n+        </button>\n+        <button\n+          className={`sfSettingsTab ${activeTab === 'codesearch' ? 'active' : ''}`}\n+          onClick={() => setActiveTab('codesearch')}\n+        >\n+          {t(language, 'settings_tab_codesearch')}\n+        </button>\n+      </div>\n+\n+      <div className=\"sfSettingsContent\">\n+        {activeTab === 'llm' && (\n+          <div className=\"sfLLMSettings\">\n+            {/* Provider List */}\n+            <div className=\"sfProviderList\">\n+              <div className=\"sfProviderListHeader\">\n+                <span>{t(language, 'providers')}</span>\n+                <button className=\"sfAddBtn\" onClick={addProvider}>{t(language, 'add')}</button>\n               </div>\n+              {localSettings.llm.providers.map(provider => (\n+                <div\n+                  key={provider.id}\n+                  className={`sfProviderItem ${selectedProviderId === provider.id ? 'active' : ''}`}\n+                  onClick={() => setSelectedProviderId(provider.id)}\n+                >\n+                  <span>{provider.name}</span>\n+                  {provider.apiKey && <span className=\"sfKeyIndicator\">ðŸ”‘</span>}\n+                </div>\n+              ))}\n+            </div>\n \n-              {/* Provider Details */}\n-              {selectedProvider && (\n-                <div className=\"sfProviderDetails\">\n-                  <div className=\"sfFieldGroup\">\n-                    <label className=\"sfFieldLabel\">{t(language, 'provider_name')}</label>\n-                    <input\n-                      className=\"sfInput\"\n-                      value={selectedProvider.name}\n-                      onChange={(e) => updateProvider(selectedProvider.id, { name: e.target.value })}\n-                      placeholder=\"e.g., OpenAI\"\n-                    />\n-                  </div>\n+            {/* Provider Details */}\n+            {selectedProvider && (\n+              <div className=\"sfProviderDetails\">\n+                <div className=\"sfFieldGroup\">\n+                  <label className=\"sfFieldLabel\">{t(language, 'provider_name')}</label>\n+                  <input\n+                    className=\"sfInput\"\n+                    value={selectedProvider.name}\n+                    onChange={(e) => updateProvider(selectedProvider.id, { name: e.target.value })}\n+                    placeholder=\"e.g., OpenAI\"\n+                  />\n+                </div>\n \n-                  <div className=\"sfFieldGroup\">\n-                    <label className=\"sfFieldLabel\">{t(language, 'endpoint')}</label>\n-                    <input\n-                      className=\"sfInput\"\n-                      value={selectedProvider.endpoint}\n-                      onChange={(e) => updateProvider(selectedProvider.id, { endpoint: e.target.value })}\n-                      placeholder=\"e.g., https://api.openai.com/v1\"\n-                    />\n-                  </div>\n+                <div className=\"sfFieldGroup\">\n+                  <label className=\"sfFieldLabel\">{t(language, 'endpoint')}</label>\n+                  <input\n+                    className=\"sfInput\"\n+                    value={selectedProvider.endpoint}\n+                    onChange={(e) => updateProvider(selectedProvider.id, { endpoint: e.target.value })}\n+                    placeholder=\"e.g., https://api.openai.com/v1\"\n+                  />\n+                </div>\n \n-                  <div className=\"sfFieldGroup\">\n-                    <label className=\"sfFieldLabel\">{t(language, 'api_key')}</label>\n-                    <input\n-                      className=\"sfInput\"\n-                      type=\"password\"\n-                      value={selectedProvider.apiKey}\n-                      onChange={(e) => updateProvider(selectedProvider.id, { apiKey: e.target.value })}\n-                      placeholder=\"sk-...\"\n-                    />\n+                <div className=\"sfFieldGroup\">\n+                  <label className=\"sfFieldLabel\">{t(language, 'api_key')}</label>\n+                  <input\n+                    className=\"sfInput\"\n+                    type=\"password\"\n+                    value={selectedProvider.apiKey}\n+                    onChange={(e) => updateProvider(selectedProvider.id, { apiKey: e.target.value })}\n+                    placeholder=\"sk-...\"\n+                  />\n+                </div>\n+\n+                <div className=\"sfModelsSection\">\n+                  <div className=\"sfModelsSectionHeader\">\n+                    <span className=\"sfFieldLabel\">{t(language, 'models')}</span>\n+                    <button className=\"sfAddBtn\" onClick={() => addModel(selectedProvider.id)}>\n+                      {t(language, 'add_model')}\n+                    </button>\n                   </div>\n \n-                  <div className=\"sfModelsSection\">\n-                    <div className=\"sfModelsSectionHeader\">\n-                      <span className=\"sfFieldLabel\">{t(language, 'models')}</span>\n-                      <button className=\"sfAddBtn\" onClick={() => addModel(selectedProvider.id)}>\n-                        {t(language, 'add_model')}\n+                  {selectedProvider.models.map(model => (\n+                    <div key={model.id} className=\"sfModelRow\">\n+                      <input\n+                        className=\"sfInput sfModelIdInput\"\n+                        value={model.id}\n+                        onChange={(e) => updateModel(selectedProvider.id, model.id, { id: e.target.value })}\n+                        placeholder={t(language, 'model_id')}\n+                      />\n+                      <input\n+                        className=\"sfInput sfModelNameInput\"\n+                        value={model.name}\n+                        onChange={(e) => updateModel(selectedProvider.id, model.id, { name: e.target.value })}\n+                        placeholder={t(language, 'display_name')}\n+                      />\n+                      <button\n+                        className=\"sfRemoveBtn\"\n+                        onClick={() => removeModel(selectedProvider.id, model.id)}\n+                      >\n+                        Ã—\n                       </button>\n                     </div>\n+                  ))}\n \n-                    {selectedProvider.models.map(model => (\n-                      <div key={model.id} className=\"sfModelRow\">\n-                        <input\n-                          className=\"sfInput sfModelIdInput\"\n-                          value={model.id}\n-                          onChange={(e) => updateModel(selectedProvider.id, model.id, { id: e.target.value })}\n-                          placeholder={t(language, 'model_id')}\n-                        />\n-                        <input\n-                          className=\"sfInput sfModelNameInput\"\n-                          value={model.name}\n-                          onChange={(e) => updateModel(selectedProvider.id, model.id, { name: e.target.value })}\n-                          placeholder={t(language, 'display_name')}\n-                        />\n-                        <button\n-                          className=\"sfRemoveBtn\"\n-                          onClick={() => removeModel(selectedProvider.id, model.id)}\n-                        >\n-                          Ã—\n-                        </button>\n-                      </div>\n-                    ))}\n-\n-                    {selectedProvider.models.length === 0 && (\n-                      <div className=\"sfEmptyModels\">{t(language, 'no_models_configured')}</div>\n-                    )}\n-                  </div>\n-\n-                  <button\n-                    className=\"sfRemoveProviderBtn\"\n-                    onClick={() => removeProvider(selectedProvider.id)}\n-                  >\n-                    {t(language, 'remove_provider')}\n-                  </button>\n+                  {selectedProvider.models.length === 0 && (\n+                    <div className=\"sfEmptyModels\">{t(language, 'no_models_configured')}</div>\n+                  )}\n                 </div>\n-              )}\n \n-              {!selectedProvider && localSettings.llm.providers.length === 0 && (\n-                <div className=\"sfNoProviders\">\n-                  <p>{t(language, 'no_providers_configured')}</p>\n-                  <button className=\"sfAddBtn\" onClick={addProvider}>{t(language, 'add_provider')}</button>\n-                </div>\n-              )}\n-            </div>\n-          )}\n-\n-          {activeTab === 'codesearch' && (\n-            <div className=\"sfCodeSearchSettings\">\n-              <div className=\"sfFieldGroup\">\n-                <label className=\"sfFieldLabel\">{t(language, 'active_provider')}</label>\n-                <select\n-                  className=\"sfSelect\"\n-                  value={localSettings.codeSearch.activeProvider}\n-                  onChange={(e) => setLocalSettings(prev => ({\n-                    ...prev,\n-                    codeSearch: { ...prev.codeSearch, activeProvider: e.target.value }\n-                  }))}\n+                <button\n+                  className=\"sfRemoveProviderBtn\"\n+                  onClick={() => removeProvider(selectedProvider.id)}\n                 >\n-                  {localSettings.codeSearch.providers.map(p => (\n-                    <option key={p.id} value={p.id}>{p.name}</option>\n-                  ))}\n-                </select>\n+                  {t(language, 'remove_provider')}\n+                </button>\n               </div>\n+            )}\n \n-              {/* API Key for active provider */}\n-              {(() => {\n-                const activeProvider = localSettings.codeSearch.providers.find(\n-                  p => p.id === localSettings.codeSearch.activeProvider\n-                )\n-                if (!activeProvider) return null\n-                return (\n-                  <div className=\"sfFieldGroup\">\n-                    <label className=\"sfFieldLabel\">{activeProvider.name} {t(language, 'api_key_for_provider')}</label>\n-                    <input\n-                      className=\"sfInput\"\n-                      type=\"password\"\n-                      value={activeProvider.apiKey}\n-                      onChange={(e) => setLocalSettings(prev => ({\n-                        ...prev,\n-                        codeSearch: {\n-                          ...prev.codeSearch,\n-                          providers: prev.codeSearch.providers.map(p =>\n-                            p.id === activeProvider.id ? { ...p, apiKey: e.target.value } : p\n-                          )\n-                        }\n-                      }))}\n-                      placeholder={t(language, 'enter_api_key_placeholder')}\n-                    />\n-                  </div>\n-                )\n-              })()}\n-\n-              <p className=\"sfSettingsNote\">\n-                {t(language, 'codesearch_note')}\n-              </p>\n+            {!selectedProvider && localSettings.llm.providers.length === 0 && (\n+              <div className=\"sfNoProviders\">\n+                <p>{t(language, 'no_providers_configured')}</p>\n+                <button className=\"sfAddBtn\" onClick={addProvider}>{t(language, 'add_provider')}</button>\n+              </div>\n+            )}\n+          </div>\n+        )}\n+\n+        {activeTab === 'codesearch' && (\n+          <div className=\"sfCodeSearchSettings\">\n+            <div className=\"sfFieldGroup\">\n+              <label className=\"sfFieldLabel\">{t(language, 'active_provider')}</label>\n+              <select\n+                className=\"sfSelect\"\n+                value={localSettings.codeSearch.activeProvider}\n+                onChange={(e) => setLocalSettings(prev => ({\n+                  ...prev,\n+                  codeSearch: { ...prev.codeSearch, activeProvider: e.target.value }\n+                }))}\n+              >\n+                {localSettings.codeSearch.providers.map(p => (\n+                  <option key={p.id} value={p.id}>{p.name}</option>\n+                ))}\n+              </select>\n             </div>\n-          )}\n-        </div>\n \n-        <div className=\"sfModalFooter\">\n-          <button className=\"sfCancelBtn\" onClick={onClose}>{t(language, 'cancel')}</button>\n-          <button className=\"sfSaveBtn\" onClick={handleSave}>{t(language, 'save_settings')}</button>\n-        </div>\n+            {/* API Key for active provider */}\n+            {(() => {\n+              const activeProvider = localSettings.codeSearch.providers.find(\n+                p => p.id === localSettings.codeSearch.activeProvider\n+              )\n+              if (!activeProvider) return null\n+              return (\n+                <div className=\"sfFieldGroup\">\n+                  <label className=\"sfFieldLabel\">{activeProvider.name} {t(language, 'api_key_for_provider')}</label>\n+                  <input\n+                    className=\"sfInput\"\n+                    type=\"password\"\n+                    value={activeProvider.apiKey}\n+                    onChange={(e) => setLocalSettings(prev => ({\n+                      ...prev,\n+                      codeSearch: {\n+                        ...prev.codeSearch,\n+                        providers: prev.codeSearch.providers.map(p =>\n+                          p.id === activeProvider.id ? { ...p, apiKey: e.target.value } : p\n+                        )\n+                      }\n+                    }))}\n+                    placeholder={t(language, 'enter_api_key_placeholder')}\n+                  />\n+                </div>\n+              )\n+            })()}\n+\n+            <p className=\"sfSettingsNote\">\n+              {t(language, 'codesearch_note')}\n+            </p>\n+          </div>\n+        )}\n       </div>\n-    </div>\n+    </SettingsModalShell>\n   )\n }"
      },
      {
        "sha": "79a76963724ae782280e679524cd6554d63fba40",
        "filename": "src/specflow/components/CanvasIcon.tsx",
        "status": "added",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FCanvasIcon.tsx",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FCanvasIcon.tsx",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fcomponents%2FCanvasIcon.tsx?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -0,0 +1,8 @@\n+export function CanvasIcon() {\n+  return (\n+    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n+      <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" />\n+      <path d=\"M4 9h16M9 4v16\" />\n+    </svg>\n+  )\n+}"
      },
      {
        "sha": "7ebbf06d75bc634c7b501573336b12e324a9b814",
        "filename": "src/specflow/components/CanvasSettingsModal.tsx",
        "status": "added",
        "additions": 157,
        "deletions": 0,
        "changes": 157,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FCanvasSettingsModal.tsx",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FCanvasSettingsModal.tsx",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fcomponents%2FCanvasSettingsModal.tsx?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -0,0 +1,157 @@\n+import { useEffect, useState } from 'react'\n+import type { Tab } from '../types'\n+import type { Language } from '../../../shared/appDataTypes'\n+import { t } from '../i18n'\n+import { SettingsModalShell } from './SettingsModalShell'\n+\n+type Props = {\n+  isOpen: boolean\n+  tab: Tab | null\n+  language: Language\n+  onClose: () => void\n+  onRename: (tabId: string, nextName: string) => Promise<void>\n+  onDuplicate: (tabId: string, nextName: string) => Promise<void>\n+  onDelete: (tabId: string) => Promise<void>\n+  onUpdateSettings: (tabId: string, patch: { defaultRepoPath?: string }) => void\n+}\n+\n+export function CanvasSettingsModal({\n+  isOpen,\n+  tab,\n+  language,\n+  onClose,\n+  onRename,\n+  onDuplicate,\n+  onDelete,\n+  onUpdateSettings,\n+}: Props) {\n+  const [renameValue, setRenameValue] = useState('')\n+  const [duplicateValue, setDuplicateValue] = useState('')\n+  const [defaultRepoPath, setDefaultRepoPath] = useState('')\n+  const [isBusy, setIsBusy] = useState(false)\n+\n+  useEffect(() => {\n+    if (!isOpen || !tab) return\n+    setRenameValue(tab.name)\n+    setDuplicateValue(`${tab.name} Copy`)\n+    setDefaultRepoPath(tab.canvasSettings?.defaultRepoPath ?? '')\n+    setIsBusy(false)\n+  }, [isOpen, tab])\n+\n+  if (!tab) return null\n+  const tabId = tab.id\n+\n+  async function handleRename() {\n+    if (!renameValue.trim()) return\n+    setIsBusy(true)\n+    try {\n+      await onRename(tabId, renameValue)\n+      onClose()\n+    } catch (err) {\n+      alert(String((err as Error)?.message ?? err))\n+      setIsBusy(false)\n+    }\n+  }\n+\n+  async function handleDuplicate() {\n+    if (!duplicateValue.trim()) return\n+    setIsBusy(true)\n+    try {\n+      await onDuplicate(tabId, duplicateValue)\n+      onClose()\n+    } catch (err) {\n+      alert(String((err as Error)?.message ?? err))\n+      setIsBusy(false)\n+    }\n+  }\n+\n+  async function handleDelete() {\n+    if (!window.confirm(t(language, 'confirm_delete_canvas'))) return\n+    setIsBusy(true)\n+    try {\n+      await onDelete(tabId)\n+      onClose()\n+    } catch (err) {\n+      alert(String((err as Error)?.message ?? err))\n+      setIsBusy(false)\n+    }\n+  }\n+\n+  return (\n+    <SettingsModalShell\n+      isOpen={isOpen}\n+      title={t(language, 'canvas_settings_title')}\n+      onClose={onClose}\n+      closeTitle={t(language, 'close')}\n+      footer={\n+        <button className=\"sfCancelBtn\" onClick={onClose}>\n+          {t(language, 'close')}\n+        </button>\n+      }\n+    >\n+      <div className=\"sfSettingsContent\">\n+        <div className=\"sfFieldGroup\">\n+          <label className=\"sfFieldLabel\">{t(language, 'canvas_name')}</label>\n+          <div className=\"sfButtonGroup sfButtonGroup--tight\">\n+            <div className=\"sfButtonWrap\">\n+              <input\n+                className=\"sfInput\"\n+                value={renameValue}\n+                onChange={(e) => setRenameValue(e.target.value)}\n+                disabled={isBusy}\n+              />\n+            </div>\n+            <button className=\"sfAddBtn\" onClick={handleRename} disabled={isBusy}>\n+              {t(language, 'rename')}\n+            </button>\n+          </div>\n+        </div>\n+\n+        <div className=\"sfFieldGroup\">\n+          <label className=\"sfFieldLabel\">{t(language, 'duplicate_canvas_as')}</label>\n+          <div className=\"sfButtonGroup sfButtonGroup--tight\">\n+            <div className=\"sfButtonWrap\">\n+              <input\n+                className=\"sfInput\"\n+                value={duplicateValue}\n+                onChange={(e) => setDuplicateValue(e.target.value)}\n+                disabled={isBusy}\n+              />\n+            </div>\n+            <button className=\"sfAddBtn\" onClick={handleDuplicate} disabled={isBusy}>\n+              {t(language, 'duplicate')}\n+            </button>\n+          </div>\n+        </div>\n+\n+        <div className=\"sfFieldGroup\">\n+          <label className=\"sfFieldLabel\">{t(language, 'canvas_default_repo_path')}</label>\n+          <div className=\"sfButtonGroup sfButtonGroup--tight\">\n+            <div className=\"sfButtonWrap\">\n+              <input\n+                className=\"sfInput\"\n+                value={defaultRepoPath}\n+                onChange={(e) => setDefaultRepoPath(e.target.value)}\n+                disabled={isBusy}\n+                placeholder={t(language, 'placeholder_repo_path')}\n+              />\n+            </div>\n+            <button\n+              className=\"sfAddBtn\"\n+              onClick={() => onUpdateSettings(tabId, { defaultRepoPath: defaultRepoPath.trim() })}\n+              disabled={isBusy}\n+            >\n+              {t(language, 'save')}\n+            </button>\n+          </div>\n+        </div>\n+\n+        <div className=\"sfSectionDivider\" />\n+\n+        <button className=\"sfRemoveProviderBtn\" onClick={handleDelete} disabled={isBusy}>\n+          {t(language, 'delete_canvas')}\n+        </button>\n+      </div>\n+    </SettingsModalShell>\n+  )\n+}"
      },
      {
        "sha": "32c5721bb8baa658b2a108a02ce4b0f51d5cfad1",
        "filename": "src/specflow/components/SettingsModalShell.tsx",
        "status": "added",
        "additions": 50,
        "deletions": 0,
        "changes": 50,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FSettingsModalShell.tsx",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2FSettingsModalShell.tsx",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fcomponents%2FSettingsModalShell.tsx?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -0,0 +1,50 @@\n+import { useRef } from 'react'\n+import type { ReactNode, MouseEvent } from 'react'\n+\n+type Props = {\n+  isOpen: boolean\n+  title: string\n+  onClose: () => void\n+  children: ReactNode\n+  footer?: ReactNode\n+  closeTitle?: string\n+}\n+\n+export function SettingsModalShell({ isOpen, title, onClose, children, footer, closeTitle = 'Close' }: Props) {\n+  const mouseDownInsideRef = useRef(false)\n+\n+  if (!isOpen) return null\n+\n+  function handleBackdropClick(e: MouseEvent) {\n+    if (mouseDownInsideRef.current) {\n+      mouseDownInsideRef.current = false\n+      return\n+    }\n+    if (e.target === e.currentTarget) {\n+      onClose()\n+    }\n+  }\n+\n+  return (\n+    <div className=\"sfModalBackdrop\" onClick={handleBackdropClick}>\n+      <div\n+        className=\"sfSettingsModal\"\n+        onMouseDown={() => {\n+          mouseDownInsideRef.current = true\n+        }}\n+        onMouseUp={() => {\n+          mouseDownInsideRef.current = false\n+        }}\n+      >\n+        <div className=\"sfModalHeader\">\n+          <span className=\"sfModalTitle\">{title}</span>\n+          <button className=\"sfModalCloseBtn\" onClick={onClose} title={closeTitle}>\n+            Ã—\n+          </button>\n+        </div>\n+        {children}\n+        {footer ? <div className=\"sfModalFooter\">{footer}</div> : null}\n+      </div>\n+    </div>\n+  )\n+}"
      },
      {
        "sha": "e3446ef5d4cac2060e0ef795e4dd7dda9a58bed0",
        "filename": "src/specflow/components/index.ts",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2Findex.ts",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fcomponents%2Findex.ts",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fcomponents%2Findex.ts?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -9,9 +9,12 @@ export { CopyButton } from './CopyButton'\n export { APISettingsModal } from './APISettingsModal'\n export { ModelSelect } from './ModelSelect'\n export { SettingsIcon } from './SettingsIcon'\n+export { CanvasIcon } from './CanvasIcon'\n export { OutputViewerModal } from './OutputViewerModal'\n export { ArchivedMemberModal } from './ArchivedMemberModal'\n export { RepoPickerModal } from './RepoPickerModal'\n export { DropdownMenu } from './DropdownMenu'\n export { CanvasFilePicker } from './CanvasFilePicker'\n export { ConfirmModal } from './ConfirmModal'\n+export { CanvasSettingsModal } from './CanvasSettingsModal'\n+export { SettingsModalShell } from './SettingsModalShell'"
      },
      {
        "sha": "7ad4bb5f26c46993edffdf2ac8137da0c5372cb1",
        "filename": "src/specflow/hooks/useAppData.ts",
        "status": "modified",
        "additions": 195,
        "deletions": 65,
        "changes": 260,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fhooks%2FuseAppData.ts",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fhooks%2FuseAppData.ts",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fhooks%2FuseAppData.ts?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -3,8 +3,8 @@ import type { Edge } from '@xyflow/react'\n import { addEdge, applyEdgeChanges, applyNodeChanges } from '@xyflow/react'\n import type { Connection, EdgeChange, NodeChange } from '@xyflow/react'\n import type { AppData, AppNode, ArchiveData, ArchiveNode, ArchivedMember, Canvas, NonArchiveNode, Tab, Viewport } from '../types'\n-import { fetchAppData, loadCanvasFile, saveAppData, saveCanvasFile, type SavedCanvasFile } from '../api'\n-import { getActiveTab, isValidConnection, uid, updateNode } from '../utils'\n+import { deleteCanvasFile, fetchAppData, listCanvasFiles, loadCanvasFile, saveAppData, saveCanvasFile, type SavedCanvasFile } from '../api'\n+import { deepClone, getActiveTab, isValidConnection, uid, updateNode } from '../utils'\n \n export type Selected = { nodeIds: string[]; primaryId: string } | null\n \n@@ -20,6 +20,25 @@ function stripCanvasExt(p: string) {\n   return p.endsWith('.canvas.json') ? p.slice(0, -'.canvas.json'.length) : p\n }\n \n+function sanitizeCanvasFileName(name: string) {\n+  const safe = name.trim().replace(/[^a-zA-Z0-9_-]/g, '_')\n+  return safe || 'canvas'\n+}\n+\n+function buildCanvasFile(tab: Tab): SavedCanvasFile {\n+  return {\n+    version: 1,\n+    id: tab.id,\n+    name: tab.name,\n+    savedAt: new Date().toISOString(),\n+    settings: tab.canvasSettings ? { ...tab.canvasSettings } : undefined,\n+    canvas: {\n+      nodes: tab.canvas.nodes,\n+      edges: tab.canvas.edges,\n+    },\n+  }\n+}\n+\n export function useAppData() {\n   const [appData, setAppData] = useState<AppData | null>(null)\n   const appDataRef = useRef<AppData | null>(appData)\n@@ -53,14 +72,35 @@ export function useAppData() {\n     setIsLoading(true)\n     setLoadError(null)\n     fetchAppData()\n-      .then((data) => {\n+      .then(async (data) => {\n         if (!alive) return\n         if (!data || !Array.isArray(data.tabs) || data.tabs.length === 0) {\n           throw new Error('Invalid app data: missing tabs')\n         }\n-        getActiveTab(data)\n-        appDataRef.current = data\n-        setAppData(data)\n+        const hydratedTabs: Tab[] = []\n+        for (const tab of data.tabs) {\n+          if (!tab.savedFilePath) {\n+            hydratedTabs.push(tab)\n+            continue\n+          }\n+          const loaded = await loadCanvasFile(tab.savedFilePath)\n+          if (loaded.id !== tab.id) {\n+            throw new Error(`Canvas ID mismatch for ${tab.name}`)\n+          }\n+          hydratedTabs.push({\n+            ...tab,\n+            canvasSettings: loaded.settings ?? tab.canvasSettings,\n+            canvas: {\n+              ...tab.canvas,\n+              nodes: loaded.canvas.nodes,\n+              edges: loaded.canvas.edges,\n+            },\n+          })\n+        }\n+        const hydrated = { ...data, tabs: hydratedTabs }\n+        getActiveTab(hydrated)\n+        appDataRef.current = hydrated\n+        setAppData(hydrated)\n       })\n       .catch((e) => {\n         if (!alive) return\n@@ -82,9 +122,49 @@ export function useAppData() {\n     if (!appData) return\n     if (saveTimer.current) window.clearTimeout(saveTimer.current)\n     saveTimer.current = window.setTimeout(() => {\n-      saveAppData(appData).catch((e) => {\n+      const snap = appDataRef.current\n+      if (!snap) return\n+      saveAppData(snap).catch((e) => {\n         console.error(e)\n       })\n+\n+      const tab = getActiveTab(snap)\n+      const canvasFile = buildCanvasFile(tab)\n+      if (!tab.savedFilePath) {\n+        const fileName = sanitizeCanvasFileName(tab.name)\n+        listCanvasFiles()\n+          .then((list) => {\n+            const targetPath = `${fileName}.canvas.json`\n+            const exists = (list.files ?? []).some((f) => f.path === targetPath)\n+            if (!exists) return null\n+            return loadCanvasFile(targetPath)\n+          })\n+          .then((existing) => {\n+            if (existing && existing.id !== tab.id) {\n+              throw new Error(`Canvas name \"${tab.name}\" is already used by another file`)\n+            }\n+            return saveCanvasFile(fileName, canvasFile)\n+          })\n+          .then((result) => {\n+            setAppData((prev) => {\n+              if (!prev) throw new Error('App data not loaded')\n+              return {\n+                ...prev,\n+                tabs: prev.tabs.map((t) => (t.id === tab.id ? { ...t, savedFilePath: result.path } : t)),\n+              }\n+            })\n+          })\n+          .catch((e) => {\n+            console.error(e)\n+            setLoadError(String((e as Error)?.message ?? e))\n+          })\n+        return\n+      }\n+\n+      saveCanvasFile(stripCanvasExt(tab.savedFilePath), canvasFile).catch((e) => {\n+        console.error(e)\n+        setLoadError(String((e as Error)?.message ?? e))\n+      })\n     }, 400)\n     return () => {\n       if (saveTimer.current) window.clearTimeout(saveTimer.current)\n@@ -138,18 +218,35 @@ export function useAppData() {\n     })\n   }, [])\n \n-  const renameTab = useCallback((tabId: string) => {\n+  const renameCanvas = useCallback(async (tabId: string, nextNameRaw: string) => {\n     const snap = appDataRef.current\n     if (!snap) throw new Error('App data not loaded')\n     const tab = snap.tabs.find((t) => t.id === tabId)\n-    if (!tab) return\n-    const nextName = window.prompt('Canvas name?', tab.name) ?? ''\n-    if (!nextName.trim()) return\n+    if (!tab) throw new Error('Canvas not found')\n+    const nextName = nextNameRaw.trim()\n+    if (!nextName) throw new Error('Canvas name is required')\n+\n+    const safeName = sanitizeCanvasFileName(nextName)\n+    const targetPath = `${safeName}.canvas.json`\n+    const existingList = await listCanvasFiles()\n+    const conflict = (existingList.files ?? []).some((f) => f.path === targetPath)\n+    if (conflict) {\n+      const existing = await loadCanvasFile(targetPath)\n+      if (existing.id !== tab.id) throw new Error(`Canvas name \"${nextName}\" is already used`)\n+    }\n+\n+    const canvasFile = buildCanvasFile({ ...tab, name: nextName })\n+    await saveCanvasFile(safeName, canvasFile)\n+\n+    if (tab.savedFilePath && tab.savedFilePath !== targetPath) {\n+      await deleteCanvasFile(tab.savedFilePath)\n+    }\n+\n     setAppData((d) => {\n       if (!d) throw new Error('App data not loaded')\n       return {\n         ...d,\n-        tabs: d.tabs.map((t) => (t.id === tabId ? { ...t, name: nextName.trim() } : t)),\n+        tabs: d.tabs.map((t) => (t.id === tabId ? { ...t, name: nextName, savedFilePath: targetPath } : t)),\n       }\n     })\n   }, [])\n@@ -362,6 +459,7 @@ export function useAppData() {\n       const snap = appDataRef.current\n       if (!snap) throw new Error('App data not loaded')\n       const tabSnap = getActiveTab(snap)\n+      const defaultRepoPath = tabSnap.canvasSettings?.defaultRepoPath ?? ''\n       const id = uid('n')\n       // Place new node at viewport center (use live viewport if provided, else fall back to saved)\n       const viewport = liveViewport ?? tabSnap.canvas.viewport ?? { x: 0, y: 0, zoom: 1 }\n@@ -386,7 +484,7 @@ export function useAppData() {\n             error: null,\n             locked: false,\n             muted: false,\n-            repoPath: '',\n+            repoPath: defaultRepoPath,\n             query: '',\n             debugMessages: false,\n             output: null,\n@@ -445,7 +543,7 @@ export function useAppData() {\n             error: null,\n             locked: false,\n             muted: false,\n-            repoPath: '',\n+            repoPath: defaultRepoPath,\n             items: [],\n             output: null,\n           },\n@@ -506,54 +604,6 @@ export function useAppData() {\n     [updateActiveCanvas],\n   )\n \n-  const saveCurrentCanvas = useCallback(async () => {\n-    const snap = appDataRef.current\n-    if (!snap) throw new Error('App data not loaded')\n-    const tab = getActiveTab(snap)\n-    if (!tab.savedFilePath) return { needsSaveAs: true as const }\n-\n-    const canvasFile: SavedCanvasFile = {\n-      version: 1,\n-      id: tab.id,\n-      name: tab.name,\n-      savedAt: new Date().toISOString(),\n-      canvas: {\n-        nodes: tab.canvas.nodes,\n-        edges: tab.canvas.edges,\n-      },\n-    }\n-\n-    await saveCanvasFile(stripCanvasExt(tab.savedFilePath), canvasFile)\n-    return { needsSaveAs: false as const }\n-  }, [])\n-\n-  const saveCanvasAs = useCallback(async (fileName: string) => {\n-    const snap = appDataRef.current\n-    if (!snap) throw new Error('App data not loaded')\n-    const tab = getActiveTab(snap)\n-\n-    const canvasFile: SavedCanvasFile = {\n-      version: 1,\n-      id: tab.id,\n-      name: tab.name,\n-      savedAt: new Date().toISOString(),\n-      canvas: {\n-        nodes: tab.canvas.nodes,\n-        edges: tab.canvas.edges,\n-      },\n-    }\n-\n-    const result = await saveCanvasFile(fileName, canvasFile)\n-    setAppData((prev) => {\n-      if (!prev) throw new Error('App data not loaded')\n-      return {\n-        ...prev,\n-        tabs: prev.tabs.map((t) => (t.id === tab.id ? { ...t, savedFilePath: result.path } : t)),\n-      }\n-    })\n-    return result\n-  }, [])\n-\n   const loadCanvas = useCallback(async (filePath: string) => {\n     const loaded = await loadCanvasFile(filePath)\n \n@@ -577,6 +627,7 @@ export function useAppData() {\n       name: loaded.name,\n       createdAt: now,\n       savedFilePath: filePath,\n+      canvasSettings: loaded.settings ?? undefined,\n       canvas: {\n         nodes: loaded.canvas.nodes,\n         edges: loaded.canvas.edges,\n@@ -596,6 +647,84 @@ export function useAppData() {\n     return { switched: false as const }\n   }, [])\n \n+  const deleteCanvas = useCallback(async (tabId: string) => {\n+    const snap = appDataRef.current\n+    if (!snap) throw new Error('App data not loaded')\n+    if (snap.tabs.length <= 1) throw new Error('Cannot delete the last canvas')\n+    const tab = snap.tabs.find((t) => t.id === tabId)\n+    if (!tab) throw new Error('Canvas not found')\n+    if (tab.savedFilePath) {\n+      await deleteCanvasFile(tab.savedFilePath)\n+    }\n+\n+    setSelected(null)\n+    setAppData((d) => {\n+      if (!d) throw new Error('App data not loaded')\n+      const nextTabs = d.tabs.filter((t) => t.id !== tabId)\n+      const nextActive = d.activeTabId === tabId ? (nextTabs[0]?.id ?? null) : d.activeTabId\n+      return { ...d, tabs: nextTabs, activeTabId: nextActive }\n+    })\n+  }, [])\n+\n+  const duplicateCanvas = useCallback(async (tabId: string, nextNameRaw: string) => {\n+    const snap = appDataRef.current\n+    if (!snap) throw new Error('App data not loaded')\n+    const tab = snap.tabs.find((t) => t.id === tabId)\n+    if (!tab) throw new Error('Canvas not found')\n+    const nextName = nextNameRaw.trim()\n+    if (!nextName) throw new Error('Canvas name is required')\n+\n+    const safeName = sanitizeCanvasFileName(nextName)\n+    const targetPath = `${safeName}.canvas.json`\n+    const existingList = await listCanvasFiles()\n+    const conflict = (existingList.files ?? []).some((f) => f.path === targetPath)\n+    if (conflict) throw new Error(`Canvas name \"${nextName}\" is already used`)\n+\n+    const now = new Date().toISOString()\n+    const newId = uid('tab')\n+    const canvas = deepClone(tab.canvas)\n+    const newTab: Tab = {\n+      id: newId,\n+      name: nextName,\n+      createdAt: now,\n+      savedFilePath: targetPath,\n+      canvasSettings: tab.canvasSettings ? deepClone(tab.canvasSettings) : undefined,\n+      canvas,\n+    }\n+\n+    const canvasFile = buildCanvasFile(newTab)\n+    await saveCanvasFile(safeName, canvasFile)\n+\n+    setSelected(null)\n+    setAppData((d) => {\n+      if (!d) throw new Error('App data not loaded')\n+      return {\n+        ...d,\n+        tabs: [...d.tabs, newTab],\n+        activeTabId: newTab.id,\n+      }\n+    })\n+  }, [])\n+\n+  const updateCanvasSettings = useCallback((tabId: string, patch: { defaultRepoPath?: string }) => {\n+    setAppData((d) => {\n+      if (!d) throw new Error('App data not loaded')\n+      return {\n+        ...d,\n+        tabs: d.tabs.map((t) => {\n+          if (t.id !== tabId) return t\n+          return {\n+            ...t,\n+            canvasSettings: {\n+              ...(t.canvasSettings ?? {}),\n+              ...patch,\n+            },\n+          }\n+        }),\n+      }\n+    })\n+  }, [])\n+\n   return {\n     appData,\n     setAppData,\n@@ -609,7 +738,6 @@ export function useAppData() {\n     loadError,\n     setActiveTabId,\n     addTab,\n-    renameTab,\n     closeTab,\n     deleteSelectedNodes,\n     updateActiveCanvas,\n@@ -622,8 +750,10 @@ export function useAppData() {\n     patchNodeById,\n     archiveSelectedNodes,\n     unarchiveNode,\n-    saveCurrentCanvas,\n-    saveCanvasAs,\n     loadCanvas,\n+    renameCanvas,\n+    deleteCanvas,\n+    duplicateCanvas,\n+    updateCanvasSettings,\n   }\n }"
      },
      {
        "sha": "a0ede8b943855e0f2c1c7552352390569d2c3c59",
        "filename": "src/specflow/i18n.ts",
        "status": "modified",
        "additions": 18,
        "deletions": 0,
        "changes": 18,
        "blob_url": "https://github.com/shuxueshuxue/SpexFlow/blob/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fi18n.ts",
        "raw_url": "https://github.com/shuxueshuxue/SpexFlow/raw/8e4cb1101cac88636863f8842b3eb5effe942abc/src%2Fspecflow%2Fi18n.ts",
        "contents_url": "https://api.github.com/repos/shuxueshuxue/SpexFlow/contents/src%2Fspecflow%2Fi18n.ts?ref=8e4cb1101cac88636863f8842b3eb5effe942abc",
        "patch": "@@ -122,6 +122,15 @@ const EN: Dict = {\n   canvas_saved: 'Saved!',\n   confirm_overwrite_title: 'Overwrite Canvas?',\n   confirm_overwrite_message: 'This file contains a different canvas (ID mismatch). Overwrite anyway?',\n+  canvas_settings: 'Canvas Settings',\n+  canvas_settings_title: 'Canvas Settings',\n+  canvas_name: 'Canvas name',\n+  canvas_default_repo_path: 'Default repo path',\n+  rename: 'Rename',\n+  duplicate: 'Duplicate',\n+  duplicate_canvas_as: 'Duplicate canvas as',\n+  delete_canvas: 'Delete canvas',\n+  confirm_delete_canvas: 'Delete this canvas file and close the tab?',\n \n   manual_import: 'Manual Import',\n   manual_import_repo_path: 'Repository Path',\n@@ -264,6 +273,15 @@ const ZH: Dict = {\n   canvas_saved: 'å·²ä¿å­˜ï¼',\n   confirm_overwrite_title: 'è¦†ç›–ç”»å¸ƒï¼Ÿ',\n   confirm_overwrite_message: 'æ­¤æ–‡ä»¶åŒ…å«ä¸åŒç”»å¸ƒï¼ˆID ä¸åŒ¹é…ï¼‰ã€‚ä»ç„¶è¦†ç›–å—ï¼Ÿ',\n+  canvas_settings: 'ç”»å¸ƒè®¾ç½®',\n+  canvas_settings_title: 'ç”»å¸ƒè®¾ç½®',\n+  canvas_name: 'ç”»å¸ƒåç§°',\n+  canvas_default_repo_path: 'é»˜è®¤ä»“åº“è·¯å¾„',\n+  rename: 'é‡å‘½å',\n+  duplicate: 'å¤åˆ¶',\n+  duplicate_canvas_as: 'å¤åˆ¶ç”»å¸ƒä¸º',\n+  delete_canvas: 'åˆ é™¤ç”»å¸ƒ',\n+  confirm_delete_canvas: 'åˆ é™¤æ­¤ç”»å¸ƒæ–‡ä»¶å¹¶å…³é—­æ ‡ç­¾é¡µï¼Ÿ',\n \n   manual_import: 'æ‰‹åŠ¨å¯¼å…¥',\n   manual_import_repo_path: 'ä»“åº“è·¯å¾„',"
      }
    ]
  }
}