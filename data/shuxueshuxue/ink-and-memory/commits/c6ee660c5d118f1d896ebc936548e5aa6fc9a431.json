{
  "sha": "c6ee660c5d118f1d896ebc936548e5aa6fc9a431",
  "node_id": "C_kwDOP2Zrm9oAKGM2ZWU2NjBjNWQxMThmMWQ4OTZlYmM5MzY1NDhlNWFhNmZjOWE0MzE",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-18T08:12:33Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-18T08:12:33Z"
    },
    "message": "Fix deck UI bugs and timeline placeholder\n\n- Fix deck names showing \"0\" suffix by converting is_system to boolean\n- Fix button widths: make Create Deck and Add Voice buttons auto-width\n- Fix textarea overflow by adding box-sizing: border-box\n- Set default enabled decks to only introspection deck on registration\n- Update timeline placeholder for today to show automatic generation message\n- Disable manual generation click for today's empty image slot\n\nü§ñ Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>",
    "tree": {
      "sha": "c58910b130a60e56b9ae93308c4ed527531798f6",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/c58910b130a60e56b9ae93308c4ed527531798f6"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/c6ee660c5d118f1d896ebc936548e5aa6fc9a431",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/c6ee660c5d118f1d896ebc936548e5aa6fc9a431",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/c6ee660c5d118f1d896ebc936548e5aa6fc9a431",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/c6ee660c5d118f1d896ebc936548e5aa6fc9a431/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "5237b059f3950e069df2aff7a7fcc855ad30094c",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/5237b059f3950e069df2aff7a7fcc855ad30094c",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/5237b059f3950e069df2aff7a7fcc855ad30094c"
    }
  ],
  "stats": {
    "total": 647,
    "additions": 581,
    "deletions": 66
  },
  "files": [
    {
      "sha": "7fb8bfe27ada1c04f0be9db0be3610227b713fc6",
      "filename": "backend/database.py",
      "status": "modified",
      "additions": 11,
      "deletions": 3,
      "changes": 14,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/c6ee660c5d118f1d896ebc936548e5aa6fc9a431/backend%2Fdatabase.py",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/c6ee660c5d118f1d896ebc936548e5aa6fc9a431/backend%2Fdatabase.py",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/backend%2Fdatabase.py?ref=c6ee660c5d118f1d896ebc936548e5aa6fc9a431",
      "patch": "@@ -561,15 +561,22 @@ def auto_fork_system_decks(user_id: int):\n         db.close()\n \n     # Fork each deck (each fork opens its own connection)\n+    # @@@ Only enable introspection deck by default\n     for deck_id in deck_ids:\n-        fork_deck(user_id, deck_id)\n+        should_enable = (deck_id == 'introspection_deck')\n+        fork_deck(user_id, deck_id, enabled=should_enable)\n \n     print(f\"‚úÖ Auto-forked {len(deck_ids)} system decks for user {user_id}\")\n \n-def fork_deck(user_id: int, deck_id: str) -> str:\n+def fork_deck(user_id: int, deck_id: str, enabled: bool = True) -> str:\n     \"\"\"\n     Fork a deck to create user's own copy.\n     Copies deck + all voices. Returns new deck_id.\n+\n+    Args:\n+        user_id: The user who is forking the deck\n+        deck_id: ID of the deck to fork\n+        enabled: Whether the forked deck should be enabled (default: True)\n     \"\"\"\n     import uuid\n \n@@ -587,7 +594,7 @@ def fork_deck(user_id: int, deck_id: str) -> str:\n         db.execute(\"\"\"\n         INSERT INTO decks (id, name, name_zh, name_en, description, description_zh, description_en,\n                           icon, color, is_system, parent_id, owner_id, enabled, has_local_changes, order_index)\n-        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 0, ?, ?, 1, 0, ?)\n+        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 0, ?, ?, ?, 0, ?)\n         \"\"\", (new_deck_id,\n               source_deck['name'],\n               source_deck['name_zh'],\n@@ -599,6 +606,7 @@ def fork_deck(user_id: int, deck_id: str) -> str:\n               source_deck['color'],\n               deck_id,  # parent_id tracks fork source\n               user_id,\n+              1 if enabled else 0,  # @@@ enabled parameter\n               source_deck['order_index']))\n \n         # Copy all voices"
    },
    {
      "sha": "b90758ff8c116692d11152e1fad1fee700a075f4",
      "filename": "frontend/src/components/CollectionsView.tsx",
      "status": "modified",
      "additions": 7,
      "deletions": 6,
      "changes": 13,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/c6ee660c5d118f1d896ebc936548e5aa6fc9a431/frontend%2Fsrc%2Fcomponents%2FCollectionsView.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/c6ee660c5d118f1d896ebc936548e5aa6fc9a431/frontend%2Fsrc%2Fcomponents%2FCollectionsView.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FCollectionsView.tsx?ref=c6ee660c5d118f1d896ebc936548e5aa6fc9a431",
      "patch": "@@ -146,7 +146,7 @@ function generateTimelineDays(): TimelineDay[] {\n \n // @@@ Helper function for interesting placeholders\n function getPlaceholderText(daysOffset: number): string {\n-  if (daysOffset === 0) return 'Click to generate';\n+  if (daysOffset === 0) return 'Generates automatically overnight';\n \n   const placeholders: Record<string, string> = {\n     '-7': 'taste buds renew every 10 days',\n@@ -635,9 +635,8 @@ function TimelinePage({ isVisible, voiceConfigs }: { isVisible: boolean; voiceCo\n                 onClick={() => {\n                   if (dayData?.picture) {\n                     handleImageClick(dayData.picture);\n-                  } else if (day.isToday && !isGenerating) {\n-                    handleGenerateForDate(day.date);\n                   }\n+                  // @@@ Removed manual generation for today - now automatic only\n                 }}\n                 style={{\n                   display: 'flex',\n@@ -647,12 +646,12 @@ function TimelinePage({ isVisible, voiceConfigs }: { isVisible: boolean; voiceCo\n                   border: '1px solid #d0c4b0',\n                   borderRadius: '8px',\n                   padding: '1rem',\n-                  cursor: (dayData?.picture || day.isToday) && !isGenerating ? 'pointer' : 'default',\n+                  cursor: dayData?.picture && !isGenerating ? 'pointer' : 'default',\n                   transition: 'transform 0.2s, box-shadow 0.2s',\n                   opacity: day.isPast && !hasData ? 0.4 : 1\n                 }}\n                 onMouseEnter={e => {\n-                  if ((dayData?.picture || day.isToday) && !isGenerating) {\n+                  if (dayData?.picture && !isGenerating) {\n                     e.currentTarget.style.transform = 'translateX(8px)';\n                     e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';\n                   }\n@@ -746,9 +745,11 @@ function TimelinePage({ isVisible, voiceConfigs }: { isVisible: boolean; voiceCo\n                   <div style={{\n                     fontSize: '13px',\n                     color: '#888',\n-                    fontStyle: textByDate.get(day.date) ? 'normal' : 'italic'\n+                    fontStyle: (day.isToday && !dayData?.picture) || (!textByDate.get(day.date) && !dayData?.comments?.length) ? 'italic' : 'normal'\n                   }}>\n                     {isGenerating ? 'Generating...' :\n+                     day.isToday && !dayData?.picture ?\n+                       getPlaceholderText(day.daysOffset) :\n                      textByDate.get(day.date) ?\n                        getTextPreview(textByDate.get(day.date)!) :\n                      dayData?.comments?.length ?"
    },
    {
      "sha": "51f51b03033ee480162efad573d613771a8a9ba3",
      "filename": "frontend/src/components/DeckManager.tsx",
      "status": "modified",
      "additions": 563,
      "deletions": 57,
      "changes": 620,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/c6ee660c5d118f1d896ebc936548e5aa6fc9a431/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/c6ee660c5d118f1d896ebc936548e5aa6fc9a431/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx?ref=c6ee660c5d118f1d896ebc936548e5aa6fc9a431",
      "patch": "@@ -1,4 +1,4 @@\n-import { useState, useEffect } from 'react';\n+import { useState, useEffect, useRef } from 'react';\n import {\n   listDecks,\n   getDeck,\n@@ -11,6 +11,7 @@ import {\n   updateVoice,\n   deleteVoice,\n   forkVoice,\n+  publishDeck,\n   type Deck,\n   type Voice\n } from '../api/voiceApi';\n@@ -67,18 +68,34 @@ interface Props {\n \n export default function DeckManager({ onUpdate }: Props) {\n   const [decks, setDecks] = useState<Deck[]>([]);\n+  const [communityDecks, setCommunityDecks] = useState<Deck[]>([]);\n   const [expandedDecks, setExpandedDecks] = useState<Set<string>>(new Set());\n   const [loading, setLoading] = useState(true);\n   const [error, setError] = useState<string | null>(null);\n   const [editingVoice, setEditingVoice] = useState<string | null>(null);\n+  const [editingField, setEditingField] = useState<'name' | 'prompt' | null>(null);\n+  const [creatingDeck, setCreatingDeck] = useState(false);\n+  const [creatingVoice, setCreatingVoice] = useState<string | null>(null);\n+  const [publishWarning, setPublishWarning] = useState<string | null>(null);\n+\n+  // @@@ Scroll position preservation\n+  const scrollContainerRef = useRef<HTMLDivElement>(null);\n \n   useEffect(() => {\n     loadDecks();\n+    loadCommunityDecks();\n   }, []);\n \n-  async function loadDecks() {\n+  async function loadDecks(preserveScroll = false) {\n+    // @@@ Save scroll position before reload\n+    const savedScrollTop = preserveScroll && scrollContainerRef.current\n+      ? scrollContainerRef.current.scrollTop\n+      : 0;\n+\n     try {\n-      setLoading(true);\n+      if (!preserveScroll) {\n+        setLoading(true);\n+      }\n       const fetchedDecks = await listDecks();\n \n       // Load voices for each deck\n@@ -95,11 +112,22 @@ export default function DeckManager({ onUpdate }: Props) {\n \n       setDecks(decksWithVoices);\n       setError(null);\n+\n+      // @@@ Restore scroll position after render\n+      if (preserveScroll && scrollContainerRef.current) {\n+        setTimeout(() => {\n+          if (scrollContainerRef.current) {\n+            scrollContainerRef.current.scrollTop = savedScrollTop;\n+          }\n+        }, 0);\n+      }\n     } catch (err: any) {\n       console.error('Failed to load decks:', err);\n       setError(err.message || 'Failed to load decks');\n     } finally {\n-      setLoading(false);\n+      if (!preserveScroll) {\n+        setLoading(false);\n+      }\n     }\n   }\n \n@@ -118,7 +146,7 @@ export default function DeckManager({ onUpdate }: Props) {\n   async function handleForkDeck(deckId: string) {\n     try {\n       await forkDeck(deckId);\n-      await loadDecks();\n+      await loadDecks(true);\n       onUpdate?.();\n     } catch (err: any) {\n       alert(`Failed to fork deck: ${err.message}`);\n@@ -128,7 +156,7 @@ export default function DeckManager({ onUpdate }: Props) {\n   async function handleToggleDeck(deckId: string, currentEnabled: boolean) {\n     try {\n       await updateDeck(deckId, { enabled: !currentEnabled });\n-      await loadDecks();\n+      await loadDecks(true);\n       onUpdate?.();\n     } catch (err: any) {\n       alert(`Failed to toggle deck: ${err.message}`);\n@@ -140,7 +168,7 @@ export default function DeckManager({ onUpdate }: Props) {\n \n     try {\n       await deleteDeck(deckId);\n-      await loadDecks();\n+      await loadDecks(true);\n       onUpdate?.();\n     } catch (err: any) {\n       alert(`Failed to delete deck: ${err.message}`);\n@@ -153,7 +181,7 @@ export default function DeckManager({ onUpdate }: Props) {\n     try {\n       const result = await syncDeck(deckId);\n       alert(`‚úÖ Synced ${result.synced_voices} voices with original template`);\n-      await loadDecks();\n+      await loadDecks(true);\n       onUpdate?.();\n     } catch (err: any) {\n       alert(`Failed to sync deck: ${err.message}`);\n@@ -163,7 +191,7 @@ export default function DeckManager({ onUpdate }: Props) {\n   async function handleToggleVoice(voiceId: string, currentEnabled: boolean) {\n     try {\n       await updateVoice(voiceId, { enabled: !currentEnabled });\n-      await loadDecks();\n+      await loadDecks(true);\n       onUpdate?.();\n     } catch (err: any) {\n       alert(`Failed to toggle voice: ${err.message}`);\n@@ -173,7 +201,7 @@ export default function DeckManager({ onUpdate }: Props) {\n   async function handleUpdateVoice(voiceId: string, data: Partial<Voice>) {\n     try {\n       await updateVoice(voiceId, data);\n-      await loadDecks();\n+      await loadDecks(true);\n       setEditingVoice(null);\n       onUpdate?.();\n     } catch (err: any) {\n@@ -186,13 +214,94 @@ export default function DeckManager({ onUpdate }: Props) {\n \n     try {\n       await deleteVoice(voiceId);\n-      await loadDecks();\n+      await loadDecks(true);\n       onUpdate?.();\n     } catch (err: any) {\n       alert(`Failed to delete voice: ${err.message}`);\n     }\n   }\n \n+  async function loadCommunityDecks() {\n+    try {\n+      const published = await listDecks(true);\n+      setCommunityDecks(published);\n+    } catch (err: any) {\n+      console.error('Failed to load community decks:', err);\n+    }\n+  }\n+\n+  async function handleCreateDeck() {\n+    setCreatingDeck(true);\n+    try {\n+      const newDeck = await createDeck({\n+        name: 'New Deck',\n+        description: 'Describe your deck here',\n+        icon: 'brain',\n+        color: 'blue'\n+      });\n+      await loadDecks(true);\n+      setExpandedDecks(prev => new Set([...prev, newDeck.id]));\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to create deck: ${err.message}`);\n+    } finally {\n+      setCreatingDeck(false);\n+    }\n+  }\n+\n+  async function handleAddVoice(deckId: string) {\n+    setCreatingVoice(deckId);\n+    try {\n+      await createVoice({\n+        deck_id: deckId,\n+        name: 'New Voice',\n+        system_prompt: 'You are a helpful assistant.',\n+        icon: 'brain',\n+        color: 'blue'\n+      });\n+      await loadDecks(true);\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to create voice: ${err.message}`);\n+    } finally {\n+      setCreatingVoice(null);\n+    }\n+  }\n+\n+  async function handlePublishClick(deck: Deck) {\n+    if (deck.published) {\n+      handlePublishToggle(deck.id, false);\n+    } else {\n+      setPublishWarning(deck.id);\n+    }\n+  }\n+\n+  async function handlePublishToggle(deckId: string, shouldPublish: boolean) {\n+    try {\n+      const result = await publishDeck(deckId);\n+      alert(result.published ? '‚úÖ Deck published to community!' : '‚úÖ Deck unpublished');\n+      await loadDecks(true);\n+      await loadCommunityDecks();\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed: ${err.message}`);\n+    } finally {\n+      setPublishWarning(null);\n+    }\n+  }\n+\n+  async function handleInstallDeck(deckId: string) {\n+    try {\n+      await forkDeck(deckId);\n+      alert('‚úÖ Deck installed to your collection!');\n+      await loadDecks(true);\n+      await loadCommunityDecks();\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to install deck: ${err.message}`);\n+    }\n+  }\n+\n   if (loading) {\n     return (\n       <div style={{\n@@ -266,11 +375,50 @@ export default function DeckManager({ onUpdate }: Props) {\n       </div>\n \n       {/* Scrollable Content */}\n-      <div style={{ flex: 1, overflowY: 'auto', padding: '32px' }}>\n+      <div ref={scrollContainerRef} style={{ flex: 1, overflowY: 'auto', padding: '32px' }}>\n         <div style={{ maxWidth: 1200, margin: '0 auto', display: 'flex', flexDirection: 'column', gap: 24 }}>\n+          {/* Create New Deck Button */}\n+          <button\n+            onClick={handleCreateDeck}\n+            disabled={creatingDeck}\n+            style={{\n+              padding: '12px 24px',\n+              marginBottom: '8px',\n+              background: '#4a90e2',\n+              color: 'white',\n+              border: 'none',\n+              borderRadius: '8px',\n+              cursor: creatingDeck ? 'not-allowed' : 'pointer',\n+              fontSize: '14px',\n+              fontWeight: '500',\n+              opacity: creatingDeck ? 0.6 : 1,\n+              transition: 'all 0.2s ease',\n+              alignSelf: 'flex-start'\n+            }}\n+            onMouseEnter={(e) => {\n+              if (!creatingDeck) e.currentTarget.style.background = '#357abd';\n+            }}\n+            onMouseLeave={(e) => {\n+              if (!creatingDeck) e.currentTarget.style.background = '#4a90e2';\n+            }}\n+          >\n+            {creatingDeck ? 'Creating...' : '+ Create New Deck'}\n+          </button>\n+\n+          {/* My Decks Section Header */}\n+          <h3 style={{\n+            margin: '8px 0',\n+            fontSize: '16px',\n+            fontWeight: '500',\n+            color: '#2c2c2c'\n+          }}>\n+            My Decks\n+          </h3>\n+\n+          {/* User's Decks */}\n           {decks.map(deck => {\n             const isExpanded = expandedDecks.has(deck.id);\n-            const isSystem = deck.is_system;\n+            const isSystem = !!deck.is_system; // @@@ Convert to boolean to prevent React from rendering \"0\"\n             const Icon = iconMap[deck.icon as keyof typeof iconMap] || FaBrain;\n             const colorHex = COLORS[deck.color as keyof typeof COLORS]?.hex || '#4a90e2';\n \n@@ -334,7 +482,6 @@ export default function DeckManager({ onUpdate }: Props) {\n                       color: '#2c2c2c',\n                       marginBottom: 4\n                     }}>\n-                      {console.log('üîç Rendering deck:', deck.name, 'order_index:', deck.order_index, 'full deck:', deck)}\n                       {deck.name}\n                       {isSystem && (\n                         <span style={{\n@@ -449,6 +596,32 @@ export default function DeckManager({ onUpdate }: Props) {\n                             Sync with Original\n                           </button>\n                         )}\n+                        {/* @@@ Publish button for user-owned decks */}\n+                        <button\n+                          onClick={() => handlePublishClick(deck)}\n+                          style={{\n+                            padding: '8px 16px',\n+                            background: deck.published ? '#e74c3c' : '#9b59b6',\n+                            color: '#fff',\n+                            border: 'none',\n+                            borderRadius: 6,\n+                            cursor: 'pointer',\n+                            fontSize: 13,\n+                            fontWeight: 600,\n+                            transition: 'all 0.2s'\n+                          }}\n+                          onMouseEnter={(e) => {\n+                            e.currentTarget.style.transform = 'translateY(-1px)';\n+                            const color = deck.published ? 'rgba(231, 76, 60, 0.4)' : 'rgba(155, 89, 182, 0.4)';\n+                            e.currentTarget.style.boxShadow = `0 4px 12px ${color}`;\n+                          }}\n+                          onMouseLeave={(e) => {\n+                            e.currentTarget.style.transform = 'translateY(0)';\n+                            e.currentTarget.style.boxShadow = 'none';\n+                          }}\n+                        >\n+                          {deck.published ? 'Unpublish' : 'Publish to Community'}\n+                        </button>\n                         <button\n                           onClick={() => handleDeleteDeck(deck.id)}\n                           style={{\n@@ -479,14 +652,15 @@ export default function DeckManager({ onUpdate }: Props) {\n                 </div>\n \n                 {/* Voices List (Expanded) */}\n-                {isExpanded && deck.voices && deck.voices.length > 0 && (\n+                {isExpanded && (\n                   <div style={{ padding: 20, background: '#fafafa' }}>\n-                    <div style={{\n-                      display: 'grid',\n-                      gridTemplateColumns: 'repeat(auto-fill, minmax(340px, 1fr))',\n-                      gap: 16\n-                    }}>\n-                      {deck.voices.map(voice => {\n+                    {deck.voices && deck.voices.length > 0 && (\n+                      <div style={{\n+                        display: 'grid',\n+                        gridTemplateColumns: 'repeat(auto-fill, minmax(340px, 1fr))',\n+                        gap: 16\n+                      }}>\n+                        {deck.voices.map(voice => {\n                         const VoiceIcon = iconMap[voice.icon as keyof typeof iconMap] || FaBrain;\n                         const voiceColor = COLORS[voice.color as keyof typeof COLORS]?.hex || '#4a90e2';\n                         const isEditing = editingVoice === voice.id;\n@@ -522,16 +696,63 @@ export default function DeckManager({ onUpdate }: Props) {\n                               </div>\n \n                               <div style={{ flex: 1, minWidth: 0 }}>\n-                                <div style={{\n-                                  fontSize: 16,\n-                                  fontWeight: 600,\n-                                  color: '#2c2c2c',\n-                                  overflow: 'hidden',\n-                                  textOverflow: 'ellipsis',\n-                                  whiteSpace: 'nowrap'\n-                                }}>\n-                                  {voice.name}\n-                                </div>\n+                                {/* @@@ Inline editing for voice name */}\n+                                {!isEditing || editingField !== 'name' ? (\n+                                  <div\n+                                    onClick={() => {\n+                                      if (!isSystem) {\n+                                        setEditingVoice(voice.id);\n+                                        setEditingField('name');\n+                                      }\n+                                    }}\n+                                    style={{\n+                                      fontSize: 16,\n+                                      fontWeight: 600,\n+                                      color: '#2c2c2c',\n+                                      overflow: 'hidden',\n+                                      textOverflow: 'ellipsis',\n+                                      whiteSpace: 'nowrap',\n+                                      cursor: isSystem ? 'default' : 'pointer',\n+                                      transition: 'opacity 0.2s'\n+                                    }}\n+                                    onMouseEnter={(e) => {\n+                                      if (!isSystem) e.currentTarget.style.opacity = '0.7';\n+                                    }}\n+                                    onMouseLeave={(e) => {\n+                                      if (!isSystem) e.currentTarget.style.opacity = '1';\n+                                    }}\n+                                  >\n+                                    {voice.name}\n+                                  </div>\n+                                ) : (\n+                                  <input\n+                                    autoFocus\n+                                    defaultValue={voice.name}\n+                                    onBlur={(e) => {\n+                                      handleUpdateVoice(voice.id, { name: e.target.value });\n+                                      setEditingVoice(null);\n+                                      setEditingField(null);\n+                                    }}\n+                                    onKeyDown={(e) => {\n+                                      if (e.key === 'Enter') {\n+                                        e.currentTarget.blur();\n+                                      } else if (e.key === 'Escape') {\n+                                        setEditingVoice(null);\n+                                        setEditingField(null);\n+                                      }\n+                                    }}\n+                                    style={{\n+                                      width: '100%',\n+                                      fontSize: 16,\n+                                      fontWeight: 600,\n+                                      color: '#2c2c2c',\n+                                      padding: '4px 8px',\n+                                      border: '2px solid #4a90e2',\n+                                      borderRadius: 4,\n+                                      background: '#f0f8ff'\n+                                    }}\n+                                  />\n+                                )}\n                               </div>\n \n                               {/* @@@ Voice-level toggle switch */}\n@@ -593,42 +814,327 @@ export default function DeckManager({ onUpdate }: Props) {\n                               )}\n                             </div>\n \n-                            {/* Voice Prompt */}\n-                            <div style={{\n-                              fontSize: 12,\n-                              color: '#666',\n-                              lineHeight: 1.6,\n-                              overflow: 'hidden',\n-                              textOverflow: 'ellipsis',\n-                              display: '-webkit-box',\n-                              WebkitLineClamp: 3,\n-                              WebkitBoxOrient: 'vertical'\n-                            }}>\n-                              {voice.system_prompt}\n-                            </div>\n+                            {/* Voice Prompt with inline editing */}\n+                            {!isEditing || editingField !== 'prompt' ? (\n+                              <div\n+                                onClick={() => {\n+                                  if (!isSystem) {\n+                                    setEditingVoice(voice.id);\n+                                    setEditingField('prompt');\n+                                  }\n+                                }}\n+                                style={{\n+                                  fontSize: 12,\n+                                  color: '#666',\n+                                  lineHeight: 1.6,\n+                                  overflow: 'hidden',\n+                                  textOverflow: 'ellipsis',\n+                                  display: '-webkit-box',\n+                                  WebkitLineClamp: 3,\n+                                  WebkitBoxOrient: 'vertical',\n+                                  cursor: isSystem ? 'default' : 'pointer',\n+                                  transition: 'opacity 0.2s'\n+                                }}\n+                                onMouseEnter={(e) => {\n+                                  if (!isSystem) e.currentTarget.style.opacity = '0.7';\n+                                }}\n+                                onMouseLeave={(e) => {\n+                                  if (!isSystem) e.currentTarget.style.opacity = '1';\n+                                }}\n+                              >\n+                                {voice.system_prompt}\n+                              </div>\n+                            ) : (\n+                              <>\n+                                <textarea\n+                                  autoFocus\n+                                  defaultValue={voice.system_prompt}\n+                                  onBlur={(e) => {\n+                                    handleUpdateVoice(voice.id, { system_prompt: e.target.value });\n+                                    setEditingVoice(null);\n+                                    setEditingField(null);\n+                                  }}\n+                                  onKeyDown={(e) => {\n+                                    if (e.key === 'Escape') {\n+                                      setEditingVoice(null);\n+                                      setEditingField(null);\n+                                    }\n+                                  }}\n+                                  style={{\n+                                    width: '100%',\n+                                    minHeight: '100px',\n+                                    fontSize: 12,\n+                                    color: '#2c2c2c',\n+                                    padding: '8px',\n+                                    border: '2px solid #4a90e2',\n+                                    borderRadius: 4,\n+                                    background: '#f0f8ff',\n+                                    fontFamily: 'inherit',\n+                                    lineHeight: 1.6,\n+                                    resize: 'vertical',\n+                                    boxSizing: 'border-box'\n+                                  }}\n+                                />\n+                                <div style={{\n+                                  fontSize: 11,\n+                                  color: '#999',\n+                                  marginTop: 4\n+                                }}>\n+                                  {voice.system_prompt.length} chars ¬∑ Press Esc to cancel\n+                                </div>\n+                              </>\n+                            )}\n                           </div>\n                         );\n-                      })}\n-                    </div>\n-                  </div>\n-                )}\n+                        })}\n+                      </div>\n+                    )}\n \n-                {/* Empty State */}\n-                {isExpanded && (!deck.voices || deck.voices.length === 0) && (\n-                  <div style={{\n-                    padding: 32,\n-                    textAlign: 'center',\n-                    color: '#999',\n-                    fontStyle: 'italic'\n-                  }}>\n-                    No voices in this deck yet\n+                    {/* @@@ Add Voice button */}\n+                    {!isSystem && (\n+                      <button\n+                        onClick={() => handleAddVoice(deck.id)}\n+                        disabled={creatingVoice === deck.id}\n+                        style={{\n+                          padding: '8px 16px',\n+                          marginTop: '16px',\n+                          background: 'transparent',\n+                          color: '#4a90e2',\n+                          border: '1px dashed #4a90e2',\n+                          borderRadius: '4px',\n+                          cursor: creatingVoice === deck.id ? 'not-allowed' : 'pointer',\n+                          fontSize: '12px',\n+                          opacity: creatingVoice === deck.id ? 0.6 : 1,\n+                          transition: 'all 0.2s',\n+                          alignSelf: 'flex-start'\n+                        }}\n+                        onMouseEnter={(e) => {\n+                          if (creatingVoice !== deck.id) {\n+                            e.currentTarget.style.background = '#f0f8ff';\n+                          }\n+                        }}\n+                        onMouseLeave={(e) => {\n+                          if (creatingVoice !== deck.id) {\n+                            e.currentTarget.style.background = 'transparent';\n+                          }\n+                        }}\n+                      >\n+                        {creatingVoice === deck.id ? 'Adding...' : '+ Add Voice to this Deck'}\n+                      </button>\n+                    )}\n+\n+                    {/* Empty State */}\n+                    {(!deck.voices || deck.voices.length === 0) && (\n+                      <div style={{\n+                        padding: 32,\n+                        textAlign: 'center',\n+                        color: '#999',\n+                        fontStyle: 'italic'\n+                      }}>\n+                        No voices in this deck yet\n+                      </div>\n+                    )}\n                   </div>\n                 )}\n               </div>\n             );\n           })}\n+\n+          {/* @@@ Community Decks Section */}\n+          <hr style={{ margin: '32px 0', border: '1px solid #d0c4b0' }} />\n+\n+          <h3 style={{\n+            margin: '16px 0',\n+            fontSize: '16px',\n+            fontWeight: '500',\n+            color: '#2c2c2c'\n+          }}>\n+            Community Decks ({communityDecks.length})\n+          </h3>\n+\n+          {communityDecks.length === 0 ? (\n+            <p style={{\n+              color: '#999',\n+              fontSize: '14px',\n+              fontStyle: 'italic',\n+              textAlign: 'center',\n+              padding: '32px 0'\n+            }}>\n+              No published decks yet. Be the first to share!\n+            </p>\n+          ) : (\n+            <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n+              {communityDecks.map(deck => {\n+                const Icon = iconMap[deck.icon as keyof typeof iconMap] || FaBrain;\n+                const colorHex = COLORS[deck.color as keyof typeof COLORS]?.hex || '#4a90e2';\n+\n+                return (\n+                  <div\n+                    key={deck.id}\n+                    style={{\n+                      background: '#fff',\n+                      border: `2px solid ${colorHex}`,\n+                      borderRadius: 12,\n+                      padding: 20,\n+                      boxShadow: '0 4px 12px rgba(0,0,0,0.1)',\n+                      transition: 'all 0.3s'\n+                    }}\n+                  >\n+                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n+                      <div style={{ display: 'flex', alignItems: 'center', gap: 16, flex: 1 }}>\n+                        {/* Deck Icon */}\n+                        <div style={{\n+                          width: 56,\n+                          height: 56,\n+                          borderRadius: 28,\n+                          background: `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}cc 100%)`,\n+                          display: 'flex',\n+                          alignItems: 'center',\n+                          justifyContent: 'center',\n+                          color: '#fff',\n+                          flexShrink: 0,\n+                          boxShadow: `0 3px 8px ${colorHex}40`\n+                        }}>\n+                          <Icon size={28} />\n+                        </div>\n+\n+                        <div style={{ flex: 1, minWidth: 0 }}>\n+                          <div style={{\n+                            fontSize: 18,\n+                            fontWeight: 700,\n+                            color: '#2c2c2c',\n+                            marginBottom: 4\n+                          }}>\n+                            {deck.name}\n+                          </div>\n+                          <div style={{\n+                            fontSize: 14,\n+                            color: '#666',\n+                            marginBottom: 4\n+                          }}>\n+                            {deck.description || 'No description'}\n+                          </div>\n+                          <div style={{\n+                            fontSize: 12,\n+                            color: '#999'\n+                          }}>\n+                            by {deck.author_name || 'Anonymous'} ¬∑ {deck.voice_count || 0} voices ¬∑ {deck.install_count || 0} installs\n+                          </div>\n+                        </div>\n+                      </div>\n+\n+                      <button\n+                        onClick={() => handleInstallDeck(deck.id)}\n+                        style={{\n+                          padding: '8px 16px',\n+                          background: '#27ae60',\n+                          color: '#fff',\n+                          border: 'none',\n+                          borderRadius: 6,\n+                          fontSize: 13,\n+                          fontWeight: 600,\n+                          cursor: 'pointer',\n+                          transition: 'all 0.2s',\n+                          flexShrink: 0\n+                        }}\n+                        onMouseEnter={(e) => {\n+                          e.currentTarget.style.transform = 'translateY(-1px)';\n+                          e.currentTarget.style.boxShadow = '0 4px 12px rgba(39, 174, 96, 0.4)';\n+                        }}\n+                        onMouseLeave={(e) => {\n+                          e.currentTarget.style.transform = 'translateY(0)';\n+                          e.currentTarget.style.boxShadow = 'none';\n+                        }}\n+                      >\n+                        Install\n+                      </button>\n+                    </div>\n+                  </div>\n+                );\n+              })}\n+            </div>\n+          )}\n         </div>\n       </div>\n+\n+      {/* @@@ Publish Warning Modal */}\n+      {publishWarning && (\n+        <div\n+          className=\"modal-overlay\"\n+          style={{\n+            position: 'fixed',\n+            top: 0,\n+            left: 0,\n+            right: 0,\n+            bottom: 0,\n+            background: 'rgba(0,0,0,0.5)',\n+            display: 'flex',\n+            alignItems: 'center',\n+            justifyContent: 'center',\n+            zIndex: 9999\n+          }}\n+          onClick={() => setPublishWarning(null)}\n+        >\n+          <div\n+            className=\"modal-content\"\n+            style={{\n+              background: 'white',\n+              padding: '24px',\n+              borderRadius: '8px',\n+              maxWidth: '400px',\n+              boxShadow: '0 4px 12px rgba(0,0,0,0.15)'\n+            }}\n+            onClick={(e) => e.stopPropagation()}\n+          >\n+            <h3 style={{ marginBottom: '16px', fontSize: '18px', fontWeight: 600 }}>\n+              ‚ö†Ô∏è Publish Deck Warning\n+            </h3>\n+\n+            <p style={{ marginBottom: '16px', lineHeight: '1.5', fontSize: '14px' }}>\n+              Publishing will <strong>break the parent link</strong>. This deck will become\n+              a standalone deck in the community store.\n+            </p>\n+\n+            <p style={{ marginBottom: '16px', color: '#e74c3c', fontSize: '13px', lineHeight: '1.5' }}>\n+              This action cannot be undone. You can unpublish later, but the parent\n+              link will remain broken.\n+            </p>\n+\n+            <div style={{ display: 'flex', gap: '8px', justifyContent: 'flex-end' }}>\n+              <button\n+                onClick={() => setPublishWarning(null)}\n+                style={{\n+                  padding: '8px 16px',\n+                  background: '#ccc',\n+                  color: '#2c2c2c',\n+                  border: 'none',\n+                  borderRadius: '4px',\n+                  cursor: 'pointer',\n+                  fontSize: '14px',\n+                  fontWeight: 500\n+                }}\n+              >\n+                Cancel\n+              </button>\n+              <button\n+                onClick={() => handlePublishToggle(publishWarning, true)}\n+                style={{\n+                  padding: '8px 16px',\n+                  background: '#9b59b6',\n+                  color: 'white',\n+                  border: 'none',\n+                  borderRadius: '4px',\n+                  cursor: 'pointer',\n+                  fontSize: '14px',\n+                  fontWeight: 500\n+                }}\n+              >\n+                Publish Anyway\n+              </button>\n+            </div>\n+          </div>\n+        </div>\n+      )}\n     </div>\n   );\n }"
    }
  ]
}