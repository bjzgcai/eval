{
  "sha": "cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc",
  "node_id": "C_kwDOP2Zrm9oAKGNmMDQ5ZjI2ZWFmMzRmNWQxYjIwNDg2YmYwYjdlNWJjNzM3ZGMyZmM",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-19T01:48:44Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-19T01:48:44Z"
    },
    "message": "add color picker",
    "tree": {
      "sha": "39761705737d8556eb0b733cfe1282a18c94faaf",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/39761705737d8556eb0b733cfe1282a18c94faaf"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "4991c28c4f2ddffba066a5808acef75774a26399",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/4991c28c4f2ddffba066a5808acef75774a26399",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/4991c28c4f2ddffba066a5808acef75774a26399"
    }
  ],
  "stats": {
    "total": 343,
    "additions": 237,
    "deletions": 106
  },
  "files": [
    {
      "sha": "fba2ae7f9a6d07c3c78f1b4764038e09783fe0f1",
      "filename": "frontend/src/components/DeckManager.tsx",
      "status": "modified",
      "additions": 237,
      "deletions": 106,
      "changes": 343,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx?ref=cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc",
      "patch": "@@ -60,8 +60,8 @@ export default function DeckManager({ onUpdate }: Props) {\n   const [error, setError] = useState<string | null>(null);\n   const [editingVoice, setEditingVoice] = useState<string | null>(null);\n   const [editingField, setEditingField] = useState<'name' | 'prompt' | null>(null);\n-  const [iconPickerOpen, setIconPickerOpen] = useState<string | null>(null); // @@@ Track which voice's icon picker is open\n-  const [deckIconPickerOpen, setDeckIconPickerOpen] = useState<string | null>(null); // @@@ Track which deck's icon picker is open\n+  const [iconPickerOpen, setIconPickerOpen] = useState<string | null>(null); // @@@ Track which voice's icon+color picker is open\n+  const [deckIconPickerOpen, setDeckIconPickerOpen] = useState<string | null>(null); // @@@ Track which deck's icon+color picker is open\n   const [creatingDeck, setCreatingDeck] = useState(false);\n   const [creatingVoice, setCreatingVoice] = useState<string | null>(null);\n   const [publishWarning, setPublishWarning] = useState<string | null>(null);\n@@ -461,7 +461,10 @@ export default function DeckManager({ onUpdate }: Props) {\n                   </div>\n \n                   {/* Deck Icon with picker */}\n-                  <div style={{ position: 'relative' }}>\n+                  <div\n+                    style={{ position: 'relative' }}\n+                    onClick={(e) => e.stopPropagation()}\n+                  >\n                     <div\n                       data-deck-icon={deck.id}\n                       onClick={(e) => {\n@@ -521,7 +524,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                               zIndex: 9999\n                             }}\n                           />\n-                          {/* Icon picker dropdown */}\n+                          {/* Icon & Color picker dropdown */}\n                           <div\n                             style={{\n                               position: 'fixed',\n@@ -533,52 +536,104 @@ export default function DeckManager({ onUpdate }: Props) {\n                               padding: 8,\n                               boxShadow: '0 4px 16px rgba(0,0,0,0.2)',\n                               zIndex: 10000,\n-                              display: 'grid',\n-                              gridTemplateColumns: 'repeat(4, 1fr)',\n-                              gap: 4,\n                               minWidth: 180\n                             }}\n                           >\n-                            {Object.entries(iconMap).map(([iconName, IconComponent]) => {\n-                              const isSelected = deck.icon === iconName;\n-                              return (\n-                                <div\n-                                  key={iconName}\n-                                  onClick={(e) => {\n-                                    e.stopPropagation();\n-                                    handleUpdateDeck(deck.id, { icon: iconName });\n-                                    setDeckIconPickerOpen(null);\n-                                  }}\n-                                  style={{\n-                                    width: 40,\n-                                    height: 40,\n-                                    borderRadius: 8,\n-                                    background: isSelected ? colorHex : '#f0f0f0',\n-                                    display: 'flex',\n-                                    alignItems: 'center',\n-                                    justifyContent: 'center',\n-                                    color: isSelected ? '#fff' : '#666',\n-                                    cursor: 'pointer',\n-                                    transition: 'all 0.2s'\n-                                  }}\n-                                  onMouseEnter={(e) => {\n-                                    if (!isSelected) {\n-                                      e.currentTarget.style.background = '#e0e0e0';\n-                                      e.currentTarget.style.transform = 'scale(1.1)';\n-                                    }\n-                                  }}\n-                                  onMouseLeave={(e) => {\n-                                    if (!isSelected) {\n-                                      e.currentTarget.style.background = '#f0f0f0';\n-                                      e.currentTarget.style.transform = 'scale(1)';\n-                                    }\n-                                  }}\n-                                  title={iconName}\n-                                >\n-                                  <IconComponent size={20} />\n-                                </div>\n-                              );\n-                            })}\n+                            {/* Icons Grid */}\n+                            <div style={{\n+                              display: 'grid',\n+                              gridTemplateColumns: 'repeat(4, 1fr)',\n+                              gap: 4,\n+                              marginBottom: 8\n+                            }}>\n+                              {Object.entries(iconMap).map(([iconName, IconComponent]) => {\n+                                const isSelected = deck.icon === iconName;\n+                                return (\n+                                  <div\n+                                    key={iconName}\n+                                    onClick={(e) => {\n+                                      e.stopPropagation();\n+                                      handleUpdateDeck(deck.id, { icon: iconName });\n+                                    }}\n+                                    style={{\n+                                      width: 40,\n+                                      height: 40,\n+                                      borderRadius: 8,\n+                                      background: isSelected ? colorHex : '#f0f0f0',\n+                                      display: 'flex',\n+                                      alignItems: 'center',\n+                                      justifyContent: 'center',\n+                                      color: isSelected ? '#fff' : '#666',\n+                                      cursor: 'pointer',\n+                                      transition: 'all 0.2s'\n+                                    }}\n+                                    onMouseEnter={(e) => {\n+                                      if (!isSelected) {\n+                                        e.currentTarget.style.background = '#e0e0e0';\n+                                        e.currentTarget.style.transform = 'scale(1.1)';\n+                                      }\n+                                    }}\n+                                    onMouseLeave={(e) => {\n+                                      if (!isSelected) {\n+                                        e.currentTarget.style.background = '#f0f0f0';\n+                                        e.currentTarget.style.transform = 'scale(1)';\n+                                      }\n+                                    }}\n+                                    title={iconName}\n+                                  >\n+                                    <IconComponent size={20} />\n+                                  </div>\n+                                );\n+                              })}\n+                            </div>\n+\n+                            {/* Divider */}\n+                            <div style={{\n+                              height: 1,\n+                              background: '#e0e0e0',\n+                              marginBottom: 8\n+                            }} />\n+\n+                            {/* Colors Row */}\n+                            <div style={{\n+                              display: 'flex',\n+                              gap: 6,\n+                              justifyContent: 'center'\n+                            }}>\n+                              {Object.entries(COLORS).map(([colorName, colorData]) => {\n+                                const isSelected = deck.color === colorName;\n+                                return (\n+                                  <div\n+                                    key={colorName}\n+                                    onClick={(e) => {\n+                                      e.stopPropagation();\n+                                      handleUpdateDeck(deck.id, { color: colorName });\n+                                    }}\n+                                    style={{\n+                                      width: 28,\n+                                      height: 28,\n+                                      borderRadius: 14,\n+                                      background: colorData.hex,\n+                                      cursor: 'pointer',\n+                                      border: isSelected ? '3px solid #2c2c2c' : '2px solid #ddd',\n+                                      transition: 'all 0.2s',\n+                                      boxSizing: 'border-box'\n+                                    }}\n+                                    onMouseEnter={(e) => {\n+                                      if (!isSelected) {\n+                                        e.currentTarget.style.transform = 'scale(1.15)';\n+                                      }\n+                                    }}\n+                                    onMouseLeave={(e) => {\n+                                      if (!isSelected) {\n+                                        e.currentTarget.style.transform = 'scale(1)';\n+                                      }\n+                                    }}\n+                                    title={colorData.label}\n+                                  />\n+                                );\n+                              })}\n+                            </div>\n                           </div>\n                         </>,\n                         document.body\n@@ -883,6 +938,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                               {/* @@@ Icon badge with picker */}\n                               <div style={{ position: 'relative' }}>\n                                 <div\n+                                  data-voice-icon={voice.id}\n                                   onClick={() => {\n                                     if (!isSystem) {\n                                       setIconPickerOpen(iconPickerOpen === voice.id ? null : voice.id);\n@@ -918,66 +974,141 @@ export default function DeckManager({ onUpdate }: Props) {\n                                   <VoiceIcon size={20} />\n                                 </div>\n \n-                                {/* Icon Picker Dropdown */}\n-                                {iconPickerOpen === voice.id && (\n-                                  <div\n-                                    style={{\n-                                      position: 'absolute',\n-                                      top: 45,\n-                                      left: 0,\n-                                      background: '#fff',\n-                                      border: '2px solid #4a90e2',\n-                                      borderRadius: 8,\n-                                      padding: 8,\n-                                      boxShadow: '0 4px 16px rgba(0,0,0,0.2)',\n-                                      zIndex: 1000,\n-                                      display: 'grid',\n-                                      gridTemplateColumns: 'repeat(4, 1fr)',\n-                                      gap: 4,\n-                                      minWidth: 180\n-                                    }}\n-                                  >\n-                                    {Object.entries(iconMap).map(([iconName, IconComponent]) => {\n-                                      const isSelected = voice.icon === iconName;\n-                                      return (\n-                                        <div\n-                                          key={iconName}\n-                                          onClick={() => {\n-                                            handleUpdateVoice(voice.id, { icon: iconName });\n-                                            setIconPickerOpen(null);\n-                                          }}\n-                                          style={{\n-                                            width: 40,\n-                                            height: 40,\n-                                            borderRadius: 8,\n-                                            background: isSelected ? voiceColor : '#f0f0f0',\n-                                            display: 'flex',\n-                                            alignItems: 'center',\n-                                            justifyContent: 'center',\n-                                            color: isSelected ? '#fff' : '#666',\n-                                            cursor: 'pointer',\n-                                            transition: 'all 0.2s'\n-                                          }}\n-                                          onMouseEnter={(e) => {\n-                                            if (!isSelected) {\n-                                              e.currentTarget.style.background = '#e0e0e0';\n-                                              e.currentTarget.style.transform = 'scale(1.1)';\n-                                            }\n-                                          }}\n-                                          onMouseLeave={(e) => {\n-                                            if (!isSelected) {\n-                                              e.currentTarget.style.background = '#f0f0f0';\n-                                              e.currentTarget.style.transform = 'scale(1)';\n-                                            }\n-                                          }}\n-                                          title={iconName}\n-                                        >\n-                                          <IconComponent size={20} />\n+                                {/* Icon & Color Picker Dropdown - Rendered at top level using portal */}\n+                                {iconPickerOpen === voice.id && (() => {\n+                                  const iconBadge = document.querySelector(`[data-voice-icon=\"${voice.id}\"]`) as HTMLElement;\n+                                  if (!iconBadge) return null;\n+                                  const rect = iconBadge.getBoundingClientRect();\n+\n+                                  return createPortal(\n+                                    <>\n+                                      {/* Transparent overlay to capture clicks outside */}\n+                                      <div\n+                                        onClick={() => setIconPickerOpen(null)}\n+                                        style={{\n+                                          position: 'fixed',\n+                                          top: 0,\n+                                          left: 0,\n+                                          right: 0,\n+                                          bottom: 0,\n+                                          zIndex: 9999\n+                                        }}\n+                                      />\n+                                      {/* Icon & Color picker dropdown */}\n+                                      <div\n+                                        style={{\n+                                          position: 'fixed',\n+                                          top: rect.bottom + 4,\n+                                          left: rect.left,\n+                                          background: '#fff',\n+                                          border: '2px solid #4a90e2',\n+                                          borderRadius: 8,\n+                                          padding: 8,\n+                                          boxShadow: '0 4px 16px rgba(0,0,0,0.2)',\n+                                          zIndex: 10000,\n+                                          minWidth: 180\n+                                        }}\n+                                      >\n+                                        {/* Icons Grid */}\n+                                        <div style={{\n+                                          display: 'grid',\n+                                          gridTemplateColumns: 'repeat(4, 1fr)',\n+                                          gap: 4,\n+                                          marginBottom: 8\n+                                        }}>\n+                                          {Object.entries(iconMap).map(([iconName, IconComponent]) => {\n+                                            const isSelected = voice.icon === iconName;\n+                                            return (\n+                                              <div\n+                                                key={iconName}\n+                                                onClick={(e) => {\n+                                                  e.stopPropagation();\n+                                                  handleUpdateVoice(voice.id, { icon: iconName });\n+                                                }}\n+                                                style={{\n+                                                  width: 40,\n+                                                  height: 40,\n+                                                  borderRadius: 8,\n+                                                  background: isSelected ? voiceColor : '#f0f0f0',\n+                                                  display: 'flex',\n+                                                  alignItems: 'center',\n+                                                  justifyContent: 'center',\n+                                                  color: isSelected ? '#fff' : '#666',\n+                                                  cursor: 'pointer',\n+                                                  transition: 'all 0.2s'\n+                                                }}\n+                                                onMouseEnter={(e) => {\n+                                                  if (!isSelected) {\n+                                                    e.currentTarget.style.background = '#e0e0e0';\n+                                                    e.currentTarget.style.transform = 'scale(1.1)';\n+                                                  }\n+                                                }}\n+                                                onMouseLeave={(e) => {\n+                                                  if (!isSelected) {\n+                                                    e.currentTarget.style.background = '#f0f0f0';\n+                                                    e.currentTarget.style.transform = 'scale(1)';\n+                                                  }\n+                                                }}\n+                                                title={iconName}\n+                                              >\n+                                                <IconComponent size={20} />\n+                                              </div>\n+                                            );\n+                                          })}\n                                         </div>\n-                                      );\n-                                    })}\n-                                  </div>\n-                                )}\n+\n+                                        {/* Divider */}\n+                                        <div style={{\n+                                          height: 1,\n+                                          background: '#e0e0e0',\n+                                          marginBottom: 8\n+                                        }} />\n+\n+                                        {/* Colors Row */}\n+                                        <div style={{\n+                                          display: 'flex',\n+                                          gap: 6,\n+                                          justifyContent: 'center'\n+                                        }}>\n+                                          {Object.entries(COLORS).map(([colorName, colorData]) => {\n+                                            const isSelected = voice.color === colorName;\n+                                            return (\n+                                              <div\n+                                                key={colorName}\n+                                                onClick={(e) => {\n+                                                  e.stopPropagation();\n+                                                  handleUpdateVoice(voice.id, { color: colorName });\n+                                                }}\n+                                                style={{\n+                                                  width: 28,\n+                                                  height: 28,\n+                                                  borderRadius: 14,\n+                                                  background: colorData.hex,\n+                                                  cursor: 'pointer',\n+                                                  border: isSelected ? '3px solid #2c2c2c' : '2px solid #ddd',\n+                                                  transition: 'all 0.2s',\n+                                                  boxSizing: 'border-box'\n+                                                }}\n+                                                onMouseEnter={(e) => {\n+                                                  if (!isSelected) {\n+                                                    e.currentTarget.style.transform = 'scale(1.15)';\n+                                                  }\n+                                                }}\n+                                                onMouseLeave={(e) => {\n+                                                  if (!isSelected) {\n+                                                    e.currentTarget.style.transform = 'scale(1)';\n+                                                  }\n+                                                }}\n+                                                title={colorData.label}\n+                                              />\n+                                            );\n+                                          })}\n+                                        </div>\n+                                      </div>\n+                                    </>,\n+                                    document.body\n+                                  );\n+                                })()}\n                               </div>\n \n                               <div style={{ flex: 1, minWidth: 0 }}>"
    }
  ]
}