{
  "sha": "dca7234449c4c380dcf332ea6cc9677016a65888",
  "node_id": "C_kwDOP2Zrm9oAKGRjYTcyMzQ0NDljNGMzODBkY2YzMzJlYTZjYzk2NzcwMTZhNjU4ODg",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-16T11:47:37Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-16T11:47:37Z"
    },
    "message": "Add deck system UI and navigation reorganization\n\n- Create DeckManager component for browsing/managing deck collections\n- Integrate deck system API (10 endpoints: decks/voices CRUD + fork)\n- Add loadVoicesFromDecks() to load voice configs from deck system\n- Reorganize navigation: move deck UI to 'Decks' tab, Settings to gear icon\n- Fix Vite bug: inline all TypeScript types in voiceApi.ts (types/ directory broken)\n- Update Settings panel: add language toggle placeholder + About content",
    "tree": {
      "sha": "c1296b8543afc77e583022e32f7a4ff59d255a48",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/c1296b8543afc77e583022e32f7a4ff59d255a48"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/dca7234449c4c380dcf332ea6cc9677016a65888",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/dca7234449c4c380dcf332ea6cc9677016a65888",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/dca7234449c4c380dcf332ea6cc9677016a65888",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/dca7234449c4c380dcf332ea6cc9677016a65888/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "9833c407d4ba089d87e152dbcf3e4a9c2be553c0",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/9833c407d4ba089d87e152dbcf3e4a9c2be553c0",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/9833c407d4ba089d87e152dbcf3e4a9c2be553c0"
    }
  ],
  "stats": {
    "total": 996,
    "additions": 939,
    "deletions": 57
  },
  "files": [
    {
      "sha": "917bbde64318589051c3871399e68cec5534d21a",
      "filename": "frontend/src/App.tsx",
      "status": "modified",
      "additions": 105,
      "deletions": 28,
      "changes": 133,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2FApp.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2FApp.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2FApp.tsx?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -12,6 +12,7 @@ import {\n } from 'react-icons/fa';\n import TopNavBar from './components/TopNavBar';\n import VoiceSettings from './components/VoiceSettings';\n+import DeckManager from './components/DeckManager';\n import CalendarPopup from './components/CalendarPopup';\n import { saveEntryToToday, type CalendarEntry } from './utils/calendarStorage';\n import CollectionsView from './components/CollectionsView';\n@@ -20,9 +21,9 @@ import AboutView from './components/AboutView';\n import AgentDropdown from './components/AgentDropdown';\n import ChatWidgetUI from './components/ChatWidgetUI';\n import StateChooser from './components/StateChooser';\n-import type { VoiceConfig, StateConfig } from './types/voice';\n+import type { VoiceConfig, StateConfig } from './api/voiceApi';\n import { getVoices, getMetaPrompt, getStateConfig } from './utils/voiceStorage';\n-import { getDefaultVoices, chatWithVoice, importLocalData, getSuggestion, type VoiceInspiration } from './api/voiceApi';\n+import { getDefaultVoices, chatWithVoice, importLocalData, getSuggestion, loadVoicesFromDecks, type VoiceInspiration } from './api/voiceApi';\n import { useMobile } from './utils/mobileDetect';\n import { CommentGroupCard } from './components/CommentCard';\n import { findNormalizedPhrase } from './utils/textNormalize';\n@@ -237,7 +238,7 @@ export default function App() {\n   const [showMigrationDialog, setShowMigrationDialog] = useState(false);\n   const [isMigrating, setIsMigrating] = useState(false);\n \n-  const [currentView, setCurrentView] = useState<'writing' | 'settings' | 'timeline' | 'analysis' | 'about'>('writing');\n+  const [currentView, setCurrentView] = useState<'writing' | 'settings' | 'timeline' | 'analysis' | 'decks'>('writing');\n   const [showCalendarPopup, setShowCalendarPopup] = useState(false);\n   const [voiceConfigs, setVoiceConfigs] = useState<Record<string, VoiceConfig>>({});\n   const [metaPrompt, setMetaPrompt] = useState<string>('');\n@@ -361,9 +362,9 @@ export default function App() {\n     }\n   }, [currentInspiration]);\n \n-  // @@@ Fetch default voices from backend\n+  // @@@ Fetch default voices from backend and load from deck system\n   useEffect(() => {\n-    getDefaultVoices().then(backendVoices => {\n+    getDefaultVoices().then(async backendVoices => {\n       const converted: Record<string, VoiceConfig> = {};\n       for (const [name, data] of Object.entries(backendVoices)) {\n         const v = data as any;\n@@ -376,9 +377,15 @@ export default function App() {\n         };\n       }\n       setDefaultVoiceConfigs(converted);\n-      const configs = getVoices() || converted;\n+\n+      // @@@ Try loading from deck system first, then localStorage, then defaults\n+      const deckVoices = await loadVoicesFromDecks();\n+      const hasDecks = Object.keys(deckVoices).length > 0;\n+      const configs = hasDecks ? deckVoices : (getVoices() || converted);\n       setVoiceConfigs(configs);\n \n+      console.log(`üìö Loaded voices from: ${hasDecks ? 'deck system' : 'localStorage or defaults'}`);\n+\n       // Update engine with voice configs\n       if (engineRef.current) {\n         engineRef.current.setVoiceConfigs(configs);\n@@ -2293,7 +2300,7 @@ export default function App() {\n           )}\n         </div>\n       )}\n-      {currentView === 'settings' && (\n+      {currentView === 'decks' && (\n         <div style={{\n           position: 'fixed',\n           top: 48,\n@@ -2304,13 +2311,97 @@ export default function App() {\n           display: 'flex',\n           overflow: 'hidden'\n         }}>\n-          <VoiceSettings\n-            defaultVoices={defaultVoiceConfigs}\n-            currentVoices={voiceConfigs}\n-            currentMetaPrompt={metaPrompt}\n-            currentStateConfig={loadedStateConfig}\n-            onSave={handleVoiceConfigsSave}\n-          />\n+          <DeckManager onUpdate={() => {\n+            // Reload voice configs when decks/voices are updated\n+            console.log('Deck system updated, reloading...');\n+          }} />\n+        </div>\n+      )}\n+      {currentView === 'settings' && (\n+        <div style={{\n+          flex: 1,\n+          display: 'flex',\n+          justifyContent: 'center',\n+          padding: '60px 40px 120px 40px',\n+          overflow: 'auto',\n+          position: 'fixed',\n+          top: 48,\n+          left: 0,\n+          right: 0,\n+          bottom: 0,\n+          background: '#f8f0e6'\n+        }}>\n+          <div style={{\n+            maxWidth: 800,\n+            width: '100%'\n+          }}>\n+            {/* Language Toggle (Placeholder) */}\n+            <section style={{ marginBottom: 48 }}>\n+              <h2 style={{\n+                fontSize: 24,\n+                fontWeight: 600,\n+                color: '#2c2c2c',\n+                marginBottom: 16,\n+                fontFamily: 'Georgia, \"Times New Roman\", serif'\n+              }}>\n+                Settings\n+              </h2>\n+              <div style={{\n+                background: 'rgba(255, 255, 255, 0.5)',\n+                border: '1px solid #d0c4b0',\n+                borderRadius: 8,\n+                padding: 24\n+              }}>\n+                <div style={{ marginBottom: 16 }}>\n+                  <label style={{\n+                    fontSize: 14,\n+                    fontWeight: 500,\n+                    color: '#2c2c2c',\n+                    marginBottom: 8,\n+                    display: 'block',\n+                    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif'\n+                  }}>\n+                    Language / ËØ≠Ë®Ä\n+                  </label>\n+                  <div style={{ display: 'flex', gap: 12 }}>\n+                    <button\n+                      style={{\n+                        padding: '8px 16px',\n+                        background: '#2c2c2c',\n+                        color: '#fff',\n+                        border: 'none',\n+                        borderRadius: 6,\n+                        fontSize: 14,\n+                        fontWeight: 500,\n+                        cursor: 'pointer',\n+                        fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif'\n+                      }}\n+                    >\n+                      English\n+                    </button>\n+                    <button\n+                      style={{\n+                        padding: '8px 16px',\n+                        background: 'transparent',\n+                        color: '#666',\n+                        border: '1px solid #d0c4b0',\n+                        borderRadius: 6,\n+                        fontSize: 14,\n+                        fontWeight: 500,\n+                        cursor: 'pointer',\n+                        fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif'\n+                      }}\n+                    >\n+                      ‰∏≠Êñá\n+                    </button>\n+                  </div>\n+                </div>\n+              </div>\n+            </section>\n+\n+            {/* About Content */}\n+            <AboutView />\n+          </div>\n         </div>\n       )}\n       {/* @@@ Always render timeline to pre-load data and position scroll */}\n@@ -2340,20 +2431,6 @@ export default function App() {\n           <AnalysisView />\n         </div>\n       )}\n-      {currentView === 'about' && (\n-        <div style={{\n-          position: 'fixed',\n-          top: 48,\n-          left: 0,\n-          right: 0,\n-          bottom: 0,\n-          background: '#f8f0e6',\n-          display: 'flex',\n-          overflow: 'hidden'\n-        }}>\n-          <AboutView />\n-        </div>\n-      )}\n \n       {/* Warning Dialog */}\n       {showWarning && ("
    },
    {
      "sha": "731fe236deaa8bed0c905244a529a7b01cd9a00a",
      "filename": "frontend/src/api/voiceApi.ts",
      "status": "modified",
      "additions": 308,
      "deletions": 0,
      "changes": 308,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fapi%2FvoiceApi.ts",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fapi%2FvoiceApi.ts",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fapi%2FvoiceApi.ts?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -4,6 +4,63 @@\n \n import { STORAGE_KEYS } from '../constants/storageKeys';\n \n+// ========== Inline Types (workaround for Vite bug) ==========\n+export interface VoiceConfig {\n+  name: string;\n+  systemPrompt: string;\n+  enabled: boolean;\n+  icon: string;\n+  color: string;\n+}\n+\n+export interface UserState {\n+  name: string;\n+  prompt: string;\n+}\n+\n+export interface StateConfig {\n+  greeting: string;\n+  states: Record<string, UserState>;\n+}\n+export interface Voice {\n+  id: string;\n+  deck_id: string;\n+  name: string;\n+  name_zh?: string;\n+  name_en?: string;\n+  system_prompt: string;\n+  icon: string;\n+  color: string;\n+  is_system: boolean;\n+  parent_id?: string;\n+  owner_id?: number;\n+  enabled: boolean;\n+  order_index?: number;\n+  created_at?: string;\n+  updated_at?: string;\n+}\n+\n+export interface Deck {\n+  id: string;\n+  name: string;\n+  name_zh?: string;\n+  name_en?: string;\n+  description?: string;\n+  description_zh?: string;\n+  description_en?: string;\n+  icon?: string;\n+  color?: string;\n+  is_system: boolean;\n+  parent_id?: string;\n+  owner_id?: number;\n+  enabled: boolean;\n+  order_index?: number;\n+  voice_count?: number;\n+  voices?: Voice[];\n+  created_at?: string;\n+  updated_at?: string;\n+}\n+\n // nginx proxies /ink-and-memory/api/* to backend (8765)\n const API_BASE = '/ink-and-memory';\n \n@@ -563,3 +620,254 @@ export async function markFirstLoginCompleted(): Promise<void> {\n     throw new Error(error.detail || 'Mark first login completed failed');\n   }\n }\n+\n+// ========== Deck System API ==========\n+\n+/**\n+ * List all decks (includes system decks + user's own decks)\n+ */\n+export async function listDecks(): Promise<Deck[]> {\n+  const response = await fetch(`${API_BASE}/api/decks`, {\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'List decks failed');\n+  }\n+\n+  const data = await response.json();\n+  return data.decks;\n+}\n+\n+/**\n+ * Get a specific deck with all its voices\n+ */\n+export async function getDeck(deckId: string): Promise<Deck> {\n+  const response = await fetch(`${API_BASE}/api/decks/${deckId}`, {\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Get deck failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Create a new deck\n+ */\n+export async function createDeck(data: {\n+  name: string;\n+  name_zh?: string;\n+  name_en?: string;\n+  description?: string;\n+  description_zh?: string;\n+  description_en?: string;\n+  icon?: string;\n+  color?: string;\n+}): Promise<{ deck_id: string }> {\n+  const response = await fetch(`${API_BASE}/api/decks`, {\n+    method: 'POST',\n+    headers: getAuthHeaders(),\n+    body: JSON.stringify(data)\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Create deck failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Update a deck (only user-owned decks)\n+ */\n+export async function updateDeck(deckId: string, data: {\n+  name?: string;\n+  name_zh?: string;\n+  name_en?: string;\n+  description?: string;\n+  description_zh?: string;\n+  description_en?: string;\n+  icon?: string;\n+  color?: string;\n+  enabled?: boolean;\n+  order_index?: number;\n+}): Promise<void> {\n+  const response = await fetch(`${API_BASE}/api/decks/${deckId}`, {\n+    method: 'PUT',\n+    headers: getAuthHeaders(),\n+    body: JSON.stringify(data)\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Update deck failed');\n+  }\n+}\n+\n+/**\n+ * Delete a deck (only user-owned decks, cascades to voices)\n+ */\n+export async function deleteDeck(deckId: string): Promise<void> {\n+  const response = await fetch(`${API_BASE}/api/decks/${deckId}`, {\n+    method: 'DELETE',\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Delete deck failed');\n+  }\n+}\n+\n+/**\n+ * Fork a deck (copy-on-write: creates user-owned copy of system deck)\n+ */\n+export async function forkDeck(deckId: string): Promise<{ deck_id: string }> {\n+  const response = await fetch(`${API_BASE}/api/decks/${deckId}/fork`, {\n+    method: 'POST',\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Fork deck failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Create a new voice in a deck\n+ */\n+export async function createVoice(data: {\n+  deck_id: string;\n+  name: string;\n+  name_zh?: string;\n+  name_en?: string;\n+  system_prompt: string;\n+  icon: string;\n+  color: string;\n+}): Promise<{ voice_id: string }> {\n+  const response = await fetch(`${API_BASE}/api/voices`, {\n+    method: 'POST',\n+    headers: getAuthHeaders(),\n+    body: JSON.stringify(data)\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Create voice failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Update a voice (only voices in user-owned decks)\n+ */\n+export async function updateVoice(voiceId: string, data: {\n+  name?: string;\n+  name_zh?: string;\n+  name_en?: string;\n+  system_prompt?: string;\n+  icon?: string;\n+  color?: string;\n+  enabled?: boolean;\n+  order_index?: number;\n+}): Promise<void> {\n+  const response = await fetch(`${API_BASE}/api/voices/${voiceId}`, {\n+    method: 'PUT',\n+    headers: getAuthHeaders(),\n+    body: JSON.stringify(data)\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Update voice failed');\n+  }\n+}\n+\n+/**\n+ * Delete a voice (only voices in user-owned decks)\n+ */\n+export async function deleteVoice(voiceId: string): Promise<void> {\n+  const response = await fetch(`${API_BASE}/api/voices/${voiceId}`, {\n+    method: 'DELETE',\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Delete voice failed');\n+  }\n+}\n+\n+/**\n+ * Fork a voice to a target deck (copy-on-write: creates user-owned copy)\n+ */\n+export async function forkVoice(voiceId: string, targetDeckId: string): Promise<{ voice_id: string }> {\n+  const response = await fetch(`${API_BASE}/api/voices/${voiceId}/fork`, {\n+    method: 'POST',\n+    headers: getAuthHeaders(),\n+    body: JSON.stringify({ target_deck_id: targetDeckId })\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Fork voice failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+// ========== Voice Config Loading ==========\n+\n+/**\n+ * @@@ Load all enabled voices from all enabled decks and convert to VoiceConfig format\n+ * This bridges the new deck system with the existing voice analysis system\n+ */\n+export async function loadVoicesFromDecks(): Promise<Record<string, VoiceConfig>> {\n+  try {\n+    const decks = await listDecks();\n+    const voiceConfigs: Record<string, VoiceConfig> = {};\n+\n+    // Load voices from each enabled deck\n+    for (const deck of decks) {\n+      if (!deck.enabled) continue;\n+\n+      try {\n+        const fullDeck = await getDeck(deck.id);\n+\n+        if (fullDeck.voices) {\n+          for (const voice of fullDeck.voices) {\n+            if (!voice.enabled) continue;\n+\n+            // Convert Voice to VoiceConfig format\n+            voiceConfigs[voice.name] = {\n+              name: voice.name,\n+              systemPrompt: voice.system_prompt,\n+              enabled: voice.enabled,\n+              icon: voice.icon,\n+              color: voice.color\n+            };\n+          }\n+        }\n+      } catch (err) {\n+        console.error(`Failed to load voices from deck ${deck.id}:`, err);\n+        // Continue loading other decks even if one fails\n+      }\n+    }\n+\n+    return voiceConfigs;\n+  } catch (err) {\n+    console.error('Failed to load voices from decks:', err);\n+    // Return empty object if loading fails - app can fall back to localStorage\n+    return {};\n+  }\n+}"
    },
    {
      "sha": "0f8554304689bf9a21d749be030e1450351d5638",
      "filename": "frontend/src/components/AgentDropdown.tsx",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FAgentDropdown.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FAgentDropdown.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FAgentDropdown.tsx?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -1,5 +1,5 @@\n import React from 'react';\n-import type { VoiceConfig } from '../types/voice';\n+import type { VoiceConfig } from '../api/voiceApi';\n import {\n   FaBrain, FaHeart, FaQuestion, FaCloud, FaTheaterMasks, FaEye,\n   FaFistRaised, FaLightbulb, FaShieldAlt, FaWind, FaFire, FaCompass"
    },
    {
      "sha": "a204cd05a741e3d369a565a1b05a101c062aad32",
      "filename": "frontend/src/components/DeckManager.tsx",
      "status": "added",
      "additions": 514,
      "deletions": 0,
      "changes": 514,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -0,0 +1,514 @@\n+import { useState, useEffect } from 'react';\n+import {\n+  listDecks,\n+  getDeck,\n+  createDeck,\n+  updateDeck,\n+  deleteDeck,\n+  forkDeck,\n+  createVoice,\n+  updateVoice,\n+  deleteVoice,\n+  forkVoice,\n+  type Deck,\n+  type Voice\n+} from '../api/voiceApi';\n+import {\n+  FaBrain, FaHeart, FaQuestion, FaCloud, FaTheaterMasks, FaEye,\n+  FaFistRaised, FaLightbulb, FaShieldAlt, FaWind, FaFire, FaCompass,\n+  FaChevronDown, FaChevronRight\n+} from 'react-icons/fa';\n+\n+// @@@ Display mappings (text name ‚Üí visual)\n+const COLORS = {\n+  'blue': { hex: '#4a90e2', label: 'Blue' },\n+  'purple': { hex: '#9b59b6', label: 'Purple' },\n+  'pink': { hex: '#e91e63', label: 'Pink' },\n+  'green': { hex: '#27ae60', label: 'Green' },\n+  'yellow': { hex: '#f39c12', label: 'Yellow' }\n+};\n+\n+// @@@ Icon map with React Icons\n+const iconMap = {\n+  brain: FaBrain,\n+  heart: FaHeart,\n+  question: FaQuestion,\n+  cloud: FaCloud,\n+  masks: FaTheaterMasks,\n+  eye: FaEye,\n+  fist: FaFistRaised,\n+  lightbulb: FaLightbulb,\n+  shield: FaShieldAlt,\n+  wind: FaWind,\n+  fire: FaFire,\n+  compass: FaCompass,\n+};\n+\n+// @@@ Icon labels for dropdown display\n+const ICON_LABELS = {\n+  'brain': 'üß† brain',\n+  'lightbulb': 'üí° lightbulb',\n+  'masks': 'üé≠ masks',\n+  'cloud': '‚òÅÔ∏è cloud',\n+  'shield': 'üõ°Ô∏è shield',\n+  'compass': 'üß≠ compass',\n+  'heart': '‚ù§Ô∏è heart',\n+  'fist': '‚úä fist',\n+  'fire': 'üî• fire',\n+  'wind': 'üí® wind',\n+  'question': '‚ùì question',\n+  'eye': 'üëÅÔ∏è eye'\n+};\n+\n+interface Props {\n+  onUpdate?: () => void;\n+}\n+\n+export default function DeckManager({ onUpdate }: Props) {\n+  const [decks, setDecks] = useState<Deck[]>([]);\n+  const [expandedDecks, setExpandedDecks] = useState<Set<string>>(new Set());\n+  const [loading, setLoading] = useState(true);\n+  const [error, setError] = useState<string | null>(null);\n+  const [editingVoice, setEditingVoice] = useState<string | null>(null);\n+\n+  useEffect(() => {\n+    loadDecks();\n+  }, []);\n+\n+  async function loadDecks() {\n+    try {\n+      setLoading(true);\n+      const fetchedDecks = await listDecks();\n+\n+      // Load voices for each deck\n+      const decksWithVoices = await Promise.all(\n+        fetchedDecks.map(async (deck) => {\n+          try {\n+            return await getDeck(deck.id);\n+          } catch (err) {\n+            console.error(`Failed to load voices for deck ${deck.id}:`, err);\n+            return deck;\n+          }\n+        })\n+      );\n+\n+      setDecks(decksWithVoices);\n+      setError(null);\n+    } catch (err: any) {\n+      console.error('Failed to load decks:', err);\n+      setError(err.message || 'Failed to load decks');\n+    } finally {\n+      setLoading(false);\n+    }\n+  }\n+\n+  function toggleDeck(deckId: string) {\n+    setExpandedDecks(prev => {\n+      const next = new Set(prev);\n+      if (next.has(deckId)) {\n+        next.delete(deckId);\n+      } else {\n+        next.add(deckId);\n+      }\n+      return next;\n+    });\n+  }\n+\n+  async function handleForkDeck(deckId: string) {\n+    try {\n+      await forkDeck(deckId);\n+      await loadDecks();\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to fork deck: ${err.message}`);\n+    }\n+  }\n+\n+  async function handleDeleteDeck(deckId: string) {\n+    if (!confirm('Delete this deck and all its voices?')) return;\n+\n+    try {\n+      await deleteDeck(deckId);\n+      await loadDecks();\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to delete deck: ${err.message}`);\n+    }\n+  }\n+\n+  async function handleUpdateVoice(voiceId: string, data: Partial<Voice>) {\n+    try {\n+      await updateVoice(voiceId, data);\n+      await loadDecks();\n+      setEditingVoice(null);\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to update voice: ${err.message}`);\n+    }\n+  }\n+\n+  async function handleDeleteVoice(voiceId: string) {\n+    if (!confirm('Delete this voice?')) return;\n+\n+    try {\n+      await deleteVoice(voiceId);\n+      await loadDecks();\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to delete voice: ${err.message}`);\n+    }\n+  }\n+\n+  if (loading) {\n+    return (\n+      <div style={{\n+        display: 'flex',\n+        alignItems: 'center',\n+        justifyContent: 'center',\n+        height: '100vh',\n+        background: '#f8f0e6'\n+      }}>\n+        <div style={{ fontSize: 18, color: '#666' }}>Loading decks...</div>\n+      </div>\n+    );\n+  }\n+\n+  if (error) {\n+    return (\n+      <div style={{\n+        display: 'flex',\n+        flexDirection: 'column',\n+        alignItems: 'center',\n+        justifyContent: 'center',\n+        height: '100vh',\n+        background: '#f8f0e6',\n+        gap: 16\n+      }}>\n+        <div style={{ fontSize: 18, color: '#e74c3c' }}>‚ùå {error}</div>\n+        <button\n+          onClick={loadDecks}\n+          style={{\n+            padding: '8px 16px',\n+            background: '#2c2c2c',\n+            color: '#fff',\n+            border: 'none',\n+            borderRadius: 6,\n+            cursor: 'pointer'\n+          }}\n+        >\n+          Retry\n+        </button>\n+      </div>\n+    );\n+  }\n+\n+  return (\n+    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: '#f8f0e6', overflow: 'hidden' }}>\n+      {/* Fixed Header */}\n+      <div style={{\n+        padding: '24px 32px',\n+        background: '#f8f0e6',\n+        flexShrink: 0,\n+        borderBottom: '2px solid #d0c4b0'\n+      }}>\n+        <h1 style={{\n+          margin: 0,\n+          fontSize: 28,\n+          fontWeight: 700,\n+          color: '#2c2c2c',\n+          fontFamily: 'Georgia, serif',\n+          letterSpacing: '-0.5px'\n+        }}>\n+          Voice Decks\n+        </h1>\n+        <p style={{\n+          margin: '6px 0 0',\n+          fontSize: 14,\n+          color: '#666',\n+          fontStyle: 'italic'\n+        }}>\n+          Organize your inner voices into thematic collections\n+        </p>\n+      </div>\n+\n+      {/* Scrollable Content */}\n+      <div style={{ flex: 1, overflowY: 'auto', padding: '32px' }}>\n+        <div style={{ maxWidth: 1200, margin: '0 auto', display: 'flex', flexDirection: 'column', gap: 24 }}>\n+          {decks.map(deck => {\n+            const isExpanded = expandedDecks.has(deck.id);\n+            const isSystem = deck.is_system;\n+            const Icon = iconMap[deck.icon as keyof typeof iconMap] || FaBrain;\n+            const colorHex = COLORS[deck.color as keyof typeof COLORS]?.hex || '#4a90e2';\n+\n+            return (\n+              <div\n+                key={deck.id}\n+                style={{\n+                  background: '#fff',\n+                  border: `2px solid ${isSystem ? '#d0c4b0' : colorHex}`,\n+                  borderRadius: 12,\n+                  overflow: 'hidden',\n+                  boxShadow: '0 4px 12px rgba(0,0,0,0.1)',\n+                  transition: 'all 0.3s'\n+                }}\n+              >\n+                {/* Deck Header */}\n+                <div\n+                  onClick={() => toggleDeck(deck.id)}\n+                  style={{\n+                    padding: 20,\n+                    background: isSystem ? '#f9f9f9' : '#fafafa',\n+                    cursor: 'pointer',\n+                    display: 'flex',\n+                    alignItems: 'center',\n+                    gap: 16,\n+                    transition: 'background 0.2s'\n+                  }}\n+                  onMouseEnter={(e) => {\n+                    e.currentTarget.style.background = isSystem ? '#f0f0f0' : '#f5f5f5';\n+                  }}\n+                  onMouseLeave={(e) => {\n+                    e.currentTarget.style.background = isSystem ? '#f9f9f9' : '#fafafa';\n+                  }}\n+                >\n+                  {/* Expand/Collapse Icon */}\n+                  <div style={{ fontSize: 20, color: '#666' }}>\n+                    {isExpanded ? <FaChevronDown /> : <FaChevronRight />}\n+                  </div>\n+\n+                  {/* Deck Icon */}\n+                  <div style={{\n+                    width: 56,\n+                    height: 56,\n+                    borderRadius: 28,\n+                    background: `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}cc 100%)`,\n+                    display: 'flex',\n+                    alignItems: 'center',\n+                    justifyContent: 'center',\n+                    color: '#fff',\n+                    flexShrink: 0,\n+                    boxShadow: `0 3px 8px ${colorHex}40`\n+                  }}>\n+                    <Icon size={28} />\n+                  </div>\n+\n+                  {/* Deck Info */}\n+                  <div style={{ flex: 1, minWidth: 0 }}>\n+                    <div style={{\n+                      fontSize: 20,\n+                      fontWeight: 700,\n+                      color: '#2c2c2c',\n+                      marginBottom: 4\n+                    }}>\n+                      {deck.name}\n+                      {isSystem && (\n+                        <span style={{\n+                          marginLeft: 12,\n+                          fontSize: 12,\n+                          fontWeight: 500,\n+                          color: '#888',\n+                          background: '#e0e0e0',\n+                          padding: '2px 8px',\n+                          borderRadius: 4\n+                        }}>\n+                          System\n+                        </span>\n+                      )}\n+                    </div>\n+                    <div style={{\n+                      fontSize: 14,\n+                      color: '#666'\n+                    }}>\n+                      {deck.description || 'No description'}\n+                    </div>\n+                    <div style={{\n+                      fontSize: 12,\n+                      color: '#999',\n+                      marginTop: 4\n+                    }}>\n+                      {deck.voice_count || deck.voices?.length || 0} voices\n+                    </div>\n+                  </div>\n+\n+                  {/* Actions */}\n+                  <div style={{ display: 'flex', gap: 8 }} onClick={(e) => e.stopPropagation()}>\n+                    {isSystem ? (\n+                      <button\n+                        onClick={() => handleForkDeck(deck.id)}\n+                        style={{\n+                          padding: '8px 16px',\n+                          background: colorHex,\n+                          color: '#fff',\n+                          border: 'none',\n+                          borderRadius: 6,\n+                          cursor: 'pointer',\n+                          fontSize: 13,\n+                          fontWeight: 600,\n+                          transition: 'all 0.2s'\n+                        }}\n+                        onMouseEnter={(e) => {\n+                          e.currentTarget.style.transform = 'translateY(-1px)';\n+                          e.currentTarget.style.boxShadow = `0 4px 12px ${colorHex}60`;\n+                        }}\n+                        onMouseLeave={(e) => {\n+                          e.currentTarget.style.transform = 'translateY(0)';\n+                          e.currentTarget.style.boxShadow = 'none';\n+                        }}\n+                      >\n+                        Fork to My Collection\n+                      </button>\n+                    ) : (\n+                      <button\n+                        onClick={() => handleDeleteDeck(deck.id)}\n+                        style={{\n+                          padding: '8px 16px',\n+                          background: '#e74c3c',\n+                          color: '#fff',\n+                          border: 'none',\n+                          borderRadius: 6,\n+                          cursor: 'pointer',\n+                          fontSize: 13,\n+                          fontWeight: 600,\n+                          transition: 'all 0.2s'\n+                        }}\n+                        onMouseEnter={(e) => {\n+                          e.currentTarget.style.transform = 'translateY(-1px)';\n+                          e.currentTarget.style.boxShadow = '0 4px 12px rgba(231, 76, 60, 0.4)';\n+                        }}\n+                        onMouseLeave={(e) => {\n+                          e.currentTarget.style.transform = 'translateY(0)';\n+                          e.currentTarget.style.boxShadow = 'none';\n+                        }}\n+                      >\n+                        Delete Deck\n+                      </button>\n+                    )}\n+                  </div>\n+                </div>\n+\n+                {/* Voices List (Expanded) */}\n+                {isExpanded && deck.voices && deck.voices.length > 0 && (\n+                  <div style={{ padding: 20, background: '#fafafa' }}>\n+                    <div style={{\n+                      display: 'grid',\n+                      gridTemplateColumns: 'repeat(auto-fill, minmax(340px, 1fr))',\n+                      gap: 16\n+                    }}>\n+                      {deck.voices.map(voice => {\n+                        const VoiceIcon = iconMap[voice.icon as keyof typeof iconMap] || FaBrain;\n+                        const voiceColor = COLORS[voice.color as keyof typeof COLORS]?.hex || '#4a90e2';\n+                        const isEditing = editingVoice === voice.id;\n+\n+                        return (\n+                          <div\n+                            key={voice.id}\n+                            style={{\n+                              background: '#fff',\n+                              border: `2px solid ${voice.enabled ? voiceColor : '#ddd'}`,\n+                              borderRadius: 8,\n+                              padding: 16,\n+                              position: 'relative',\n+                              boxShadow: '0 2px 6px rgba(0,0,0,0.08)',\n+                              transition: 'all 0.2s',\n+                              opacity: voice.enabled ? 1 : 0.6\n+                            }}\n+                          >\n+                            {/* Voice Header */}\n+                            <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 12 }}>\n+                              <div style={{\n+                                width: 40,\n+                                height: 40,\n+                                borderRadius: 20,\n+                                background: `linear-gradient(135deg, ${voiceColor} 0%, ${voiceColor}cc 100%)`,\n+                                display: 'flex',\n+                                alignItems: 'center',\n+                                justifyContent: 'center',\n+                                color: '#fff',\n+                                flexShrink: 0\n+                              }}>\n+                                <VoiceIcon size={20} />\n+                              </div>\n+\n+                              <div style={{ flex: 1, minWidth: 0 }}>\n+                                <div style={{\n+                                  fontSize: 16,\n+                                  fontWeight: 600,\n+                                  color: '#2c2c2c',\n+                                  overflow: 'hidden',\n+                                  textOverflow: 'ellipsis',\n+                                  whiteSpace: 'nowrap'\n+                                }}>\n+                                  {voice.name}\n+                                </div>\n+                              </div>\n+\n+                              {!isSystem && (\n+                                <button\n+                                  onClick={() => handleDeleteVoice(voice.id)}\n+                                  style={{\n+                                    background: 'rgba(255, 255, 255, 0.9)',\n+                                    border: '1px solid #ddd',\n+                                    borderRadius: 4,\n+                                    width: 24,\n+                                    height: 24,\n+                                    display: 'flex',\n+                                    alignItems: 'center',\n+                                    justifyContent: 'center',\n+                                    cursor: 'pointer',\n+                                    fontSize: 12,\n+                                    transition: 'all 0.2s'\n+                                  }}\n+                                  onMouseEnter={(e) => {\n+                                    e.currentTarget.style.background = '#fee';\n+                                    e.currentTarget.style.borderColor = '#fcc';\n+                                  }}\n+                                  onMouseLeave={(e) => {\n+                                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.9)';\n+                                    e.currentTarget.style.borderColor = '#ddd';\n+                                  }}\n+                                  title=\"Delete\"\n+                                >\n+                                  √ó\n+                                </button>\n+                              )}\n+                            </div>\n+\n+                            {/* Voice Prompt */}\n+                            <div style={{\n+                              fontSize: 12,\n+                              color: '#666',\n+                              lineHeight: 1.6,\n+                              overflow: 'hidden',\n+                              textOverflow: 'ellipsis',\n+                              display: '-webkit-box',\n+                              WebkitLineClamp: 3,\n+                              WebkitBoxOrient: 'vertical'\n+                            }}>\n+                              {voice.system_prompt}\n+                            </div>\n+                          </div>\n+                        );\n+                      })}\n+                    </div>\n+                  </div>\n+                )}\n+\n+                {/* Empty State */}\n+                {isExpanded && (!deck.voices || deck.voices.length === 0) && (\n+                  <div style={{\n+                    padding: 32,\n+                    textAlign: 'center',\n+                    color: '#999',\n+                    fontStyle: 'italic'\n+                  }}>\n+                    No voices in this deck yet\n+                  </div>\n+                )}\n+              </div>\n+            );\n+          })}\n+        </div>\n+      </div>\n+    </div>\n+  );\n+}"
    },
    {
      "sha": "d21f5512c94851f398cc5b73e7c188acd6f3aff4",
      "filename": "frontend/src/components/StateChooser.tsx",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FStateChooser.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FStateChooser.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FStateChooser.tsx?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -1,6 +1,6 @@\n import { useState, useEffect, useRef } from 'react';\n import { StateCube } from './StateCube';\n-import type { StateConfig } from '../types/voice';\n+import type { StateConfig } from '../api/voiceApi';\n \n interface Props {\n   stateConfig: StateConfig;"
    },
    {
      "sha": "db0d196222ad72c7994fd4e2786ae43d981770ea",
      "filename": "frontend/src/components/TopNavBar.tsx",
      "status": "modified",
      "additions": 8,
      "deletions": 8,
      "changes": 16,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FTopNavBar.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FTopNavBar.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FTopNavBar.tsx?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -2,8 +2,8 @@ import { useState } from 'react';\n import { useAuth } from '../contexts/AuthContext';\n \n interface Props {\n-  currentView: 'writing' | 'settings' | 'timeline' | 'analysis' | 'about';\n-  onViewChange: (view: 'writing' | 'settings' | 'timeline' | 'analysis' | 'about') => void;\n+  currentView: 'writing' | 'settings' | 'timeline' | 'analysis' | 'decks';\n+  onViewChange: (view: 'writing' | 'settings' | 'timeline' | 'analysis' | 'decks') => void;\n }\n \n export default function LeftSidebar({ currentView, onViewChange }: Props) {\n@@ -134,21 +134,21 @@ export default function LeftSidebar({ currentView, onViewChange }: Props) {\n         </button>\n \n         <button\n-          onClick={() => onViewChange('about')}\n-          style={buttonStyle(currentView === 'about')}\n-          title=\"About\"\n+          onClick={() => onViewChange('decks')}\n+          style={buttonStyle(currentView === 'decks')}\n+          title=\"Decks\"\n           onMouseEnter={e => {\n-            if (currentView !== 'about') {\n+            if (currentView !== 'decks') {\n               e.currentTarget.style.background = 'rgba(44, 44, 44, 0.04)';\n             }\n           }}\n           onMouseLeave={e => {\n-            if (currentView !== 'about') {\n+            if (currentView !== 'decks') {\n               e.currentTarget.style.background = 'transparent';\n             }\n           }}\n         >\n-          About\n+          Decks\n         </button>\n       </div>\n "
    },
    {
      "sha": "105973b18b5d1553881b54d0efe38ddb736f8c57",
      "filename": "frontend/src/components/VoiceSettings.tsx",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FVoiceSettings.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Fcomponents%2FVoiceSettings.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FVoiceSettings.tsx?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -1,5 +1,5 @@\n import { useState, useEffect, useRef } from 'react';\n-import type { VoiceConfig, StateConfig, UserState } from '../types/voice';\n+import type { VoiceConfig, StateConfig, UserState } from '../api/voiceApi';\n import { saveVoices, clearVoices, getMetaPrompt, saveMetaPrompt, getStateConfig, saveStateConfig } from '../utils/voiceStorage';\n import {\n   FaBrain, FaHeart, FaQuestion, FaCloud, FaTheaterMasks, FaEye,"
    },
    {
      "sha": "cee2487df923571f58e94c73a7c34b871cd4f2b2",
      "filename": "frontend/src/types/voice.ts",
      "status": "removed",
      "additions": 0,
      "deletions": 17,
      "changes": 17,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/9833c407d4ba089d87e152dbcf3e4a9c2be553c0/frontend%2Fsrc%2Ftypes%2Fvoice.ts",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/9833c407d4ba089d87e152dbcf3e4a9c2be553c0/frontend%2Fsrc%2Ftypes%2Fvoice.ts",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Ftypes%2Fvoice.ts?ref=9833c407d4ba089d87e152dbcf3e4a9c2be553c0",
      "patch": "@@ -1,17 +0,0 @@\n-export interface VoiceConfig {\n-  name: string;\n-  systemPrompt: string;\n-  enabled: boolean;\n-  icon: string;\n-  color: string;\n-}\n-\n-export interface UserState {\n-  name: string;\n-  prompt: string;\n-}\n-\n-export interface StateConfig {\n-  greeting: string;\n-  states: Record<string, UserState>;\n-}"
    },
    {
      "sha": "82c37e59eb25db4c75336de2ada920f997918068",
      "filename": "frontend/src/utils/voiceStorage.ts",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Futils%2FvoiceStorage.ts",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/dca7234449c4c380dcf332ea6cc9677016a65888/frontend%2Fsrc%2Futils%2FvoiceStorage.ts",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Futils%2FvoiceStorage.ts?ref=dca7234449c4c380dcf332ea6cc9677016a65888",
      "patch": "@@ -1,4 +1,4 @@\n-import type { VoiceConfig, StateConfig } from '../types/voice';\n+import type { VoiceConfig, StateConfig } from '../api/voiceApi';\n import { STORAGE_KEYS } from '../constants/storageKeys';\n \n // @@@ Default meta prompt: honest, pragmatic advice over role-playing fluff"
    }
  ]
}