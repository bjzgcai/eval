{
  "sha": "07aaff86a658c5cf0d8ef3d24462dc03fb917c91",
  "node_id": "C_kwDOP2Zrm9oAKDA3YWFmZjg2YTY1OGM1Y2YwZDhlZjNkMjQ0NjJkYzAzZmI5MTdjOTE",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-12T00:59:32Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-12T00:59:32Z"
    },
    "message": "Stop tracking .DS_Store and CLAUDE.md\n\n- Add .DS_Store and CLAUDE.md to .gitignore\n- Remove both files from git index (files remain locally)",
    "tree": {
      "sha": "8e28ff734d587a947eccb1d79ba30f098ada2902",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/8e28ff734d587a947eccb1d79ba30f098ada2902"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/07aaff86a658c5cf0d8ef3d24462dc03fb917c91",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/07aaff86a658c5cf0d8ef3d24462dc03fb917c91",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/07aaff86a658c5cf0d8ef3d24462dc03fb917c91",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/07aaff86a658c5cf0d8ef3d24462dc03fb917c91/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "93ca7345570de5d4ea75cbfb47999aefa508dda9",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/93ca7345570de5d4ea75cbfb47999aefa508dda9",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/93ca7345570de5d4ea75cbfb47999aefa508dda9"
    }
  ],
  "stats": {
    "total": 596,
    "additions": 6,
    "deletions": 590
  },
  "files": [
    {
      "sha": "9ad47cc5733d2b8cf05cf0dcfd1eaf2ee5f41db0",
      "filename": ".DS_Store",
      "status": "removed",
      "additions": 0,
      "deletions": 0,
      "changes": 0,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/93ca7345570de5d4ea75cbfb47999aefa508dda9/.DS_Store",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/93ca7345570de5d4ea75cbfb47999aefa508dda9/.DS_Store",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/.DS_Store?ref=93ca7345570de5d4ea75cbfb47999aefa508dda9"
    },
    {
      "sha": "d8dd376c3302667f2b9176d00ee065775a880dbc",
      "filename": ".gitignore",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/07aaff86a658c5cf0d8ef3d24462dc03fb917c91/.gitignore",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/07aaff86a658c5cf0d8ef3d24462dc03fb917c91/.gitignore",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/.gitignore?ref=07aaff86a658c5cf0d8ef3d24462dc03fb917c91",
      "patch": "@@ -18,3 +18,9 @@ frontend/node_modules/\n *.db\n *.db-shm\n *.db-wal\n+\n+# macOS system files\n+.DS_Store\n+\n+# Project documentation (private)\n+CLAUDE.md"
    },
    {
      "sha": "74b849bfec1d855b234536fe6af5c6b89e3559b2",
      "filename": "CLAUDE.md",
      "status": "removed",
      "additions": 0,
      "deletions": 590,
      "changes": 590,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/93ca7345570de5d4ea75cbfb47999aefa508dda9/CLAUDE.md",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/93ca7345570de5d4ea75cbfb47999aefa508dda9/CLAUDE.md",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/CLAUDE.md?ref=93ca7345570de5d4ea75cbfb47999aefa508dda9",
      "patch": "@@ -1,590 +0,0 @@\n-# CLAUDE.md\n-\n-This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\n-\n----\n-\n-## Project Overview\n-\n-**Ink & Memory** is a Disco Elysium-inspired journaling interface where inner voice personas comment on your writing in real-time. The system uses LLMs to generate commentary from distinct archetypes that interrupt and debate as you write.\n-\n-**Key Innovation**: Trace-based energy accumulation system where writing builds up energy until threshold is reached, then triggers LLM analysis. Comments appear as watercolor highlights with personas commenting in the margins.\n-\n----\n-\n-## Development Commands\n-\n-### Backend (Python + PolyCLI)\n-\n-```bash\n-# Setup\n-cd backend\n-uv venv\n-source .venv/bin/activate  # Windows: .venv\\Scripts\\activate\n-\n-# Install PolyCLI from local development\n-cd ~/Codebase/PolyCLI\n-uv pip install -e .\n-\n-cd ~/Codebase/ink-and-memory/backend\n-uv pip install beautifulsoup4 requests 'httpx[socks]' Pillow PyJWT\n-\n-# Start server\n-python server.py\n-# Runs on http://localhost:8765\n-```\n-\n-### Frontend (React + TypeScript + Vite)\n-\n-```bash\n-cd frontend\n-\n-# Development\n-npm install\n-npm run dev\n-# Runs on http://localhost:5173\n-\n-# Production build\n-npm run build\n-# Output: dist/\n-\n-# Lint\n-npm run lint\n-\n-# Preview production build\n-npm preview\n-```\n-\n----\n-\n-## Architecture Deep Dive\n-\n-### Core Data Flow\n-\n-```\n-User types â†’ Weight accumulates â†’ Threshold (40 energy) â†’ Backend analysis\n-         â†“                                                         â†“\n-    EditorEngine                                    PolyCLI session function\n-         â†“                                                         â†“\n-  Apply comment â†’ Collision detection â†’ Highlight phrase in cell\n-```\n-\n-### Critical Components\n-\n-#### 1. EditorEngine (`frontend/src/engine/EditorEngine.ts`)\n-\n-**Purpose**: Single source of truth for editor state. Manages cells, commentors, energy accumulation.\n-\n-**Key patterns**:\n-- **Weight function** (`computeWeight`): CJK chars = 2, sentence endings = 4, Chinese comma = 0, other = 1\n-- **Energy accumulation**: `delta = max(0, currentWeight - lastWeight)`, only positive deltas add energy\n-- **Collision detection**: Before applying comment, check if phrase overlaps with existing highlights\n-- **Cells system**: Editor content is an array of cells (text cells + widget cells like chat)\n-\n-**@@@ Critical**: When programmatically inserting text (e.g., quoting a comment), you MUST update the baseline weight to prevent false energy accumulation:\n-\n-```typescript\n-setTimeout(() => {\n-  lastPollWeightRef.current = getWeightedLength(currentTextRef.current);\n-}, 0);\n-```\n-\n-#### 2. Voice Analysis System (`backend/stateless_analyzer.py`)\n-\n-**Stateless design**: Receives applied comments, returns ONE new comment (gradual accumulation).\n-\n-**Key features**:\n-- **Explicit overlap avoidance**: Prompt shows LLM all existing highlighted phrases + rejected phrases\n-- **Voice ID system**: LLM returns `voice_id` (e.g., \"holder\"), backend auto-fills display name from config\n-- **Language matching**: LLM writes comments in same language as input text\n-- **Structured output**: Uses Pydantic schema for reliable JSON parsing\n-\n-**@@@ Important**: The prompt explicitly tells LLM to extract phrases ONLY from \"TEXT TO ANALYZE\" section, NOT from conversation context.\n-\n-#### 3. Authentication & Database (`backend/auth.py`, `backend/database.py`)\n-\n-**JWT-based auth**:\n-- Users register/login â†’ receive JWT token\n-- Frontend stores token in localStorage\n-- All API calls to `/polycli/api/trigger-sync` include `Authorization: Bearer <token>` header\n-- PolyCLI middleware extracts user_id from token, injects into session params\n-\n-**Database schema**:\n-- `users` - email, password_hash, display_name\n-- `sessions` - editor_state (JSON), user_id, session_id\n-- `daily_pictures` - base64 images, thumbnails, prompts\n-- `preferences` - voice_configs, meta_prompt, state_config, selected_state\n-- `analysis_reports` - echoes/traits/patterns analysis results\n-\n-**@@@ Migration system**: First-time login shows migration dialog to import localStorage data to database.\n-\n-#### 4. PolyCLI Integration\n-\n-**Session definitions** (`@session_def` in `backend/server.py`):\n-\n-```python\n-@session_def(name=\"Analyze Voices\", params={...})\n-def analyze_text(text: str, session_id: str, user_id: int, applied_comments: list, ...):\n-    # user_id injected by auth middleware\n-    # Loads voice configs from database using user_id\n-    prefs = database.get_preferences(user_id)\n-    voices = prefs['voice_configs'] or config.VOICE_ARCHETYPES\n-    # ...\n-```\n-\n-**Frontend calls**:\n-```typescript\n-fetch(`${API_BASE}/polycli/api/trigger-sync`, {\n-  method: 'POST',\n-  headers: {\n-    'Authorization': `Bearer ${token}`\n-  },\n-  body: JSON.stringify({\n-    session_id: 'analyze_voices',  // Matches @session_def name\n-    params: { text, session_id, applied_comments, ... },\n-    timeout: 60\n-  })\n-})\n-```\n-\n-**Response format**: `{success: true, result: {...}}` or `{success: false, error: \"...\"}`\n-\n----\n-\n-## Key Implementation Patterns\n-\n-### Pattern 1: Energy Pool System\n-\n-**Problem**: How to trigger LLM analysis without constant polling waste?\n-\n-**Solution**: Track weight changes over time, accumulate only positive deltas as energy:\n-\n-```typescript\n-// In App.tsx, every 5 seconds:\n-const currentWeight = computeWeight(allText);\n-const delta = Math.max(0, currentWeight - lastPollWeightRef.current);\n-energyRef.current += delta;\n-\n-if (energyRef.current >= 40 && !isAnalyzing) {\n-  // Trigger backend analysis\n-  energyRef.current -= 40;  // Consume energy, preserve remainder\n-}\n-\n-lastPollWeightRef.current = currentWeight;\n-```\n-\n-**@@@ Quote weight hack**: When quoting a voice comment, the quoted text gets inserted but should NOT count as \"new writing\". Solution: immediately update baseline after insertion.\n-\n-### Pattern 2: Collision Detection (Two-Layer Defense)\n-\n-**Layer 1 (Backend LLM prompt)**: Show LLM all existing highlighted phrases + rejected phrases\n-\n-```python\n-conversation_context += f\"âš ï¸ Already highlighted: {highlighted_phrases}\\n\"\n-rejected_section += f\"âœ— '{phrase}' - REJECTED, do NOT suggest again\\n\"\n-```\n-\n-**Layer 2 (Frontend engine)**: Before applying comment, check for overlap:\n-\n-```typescript\n-const hasCollision = existingHighlights.some(h =>\n-  (newStart >= h.start && newStart < h.end) ||\n-  (newEnd > h.start && newEnd <= h.end) ||\n-  (newStart <= h.start && newEnd >= h.end)\n-);\n-\n-if (hasCollision) {\n-  // Add to overlappedPhrases, send as feedback on next analysis\n-  return;\n-}\n-```\n-\n-**Why two layers?** LLMs are not 100% reliable, so frontend provides safety net.\n-\n-### Pattern 3: Per-Cell State Management\n-\n-**Why?** Multi-cell editor with IME composition (Chinese/Japanese input) requires careful state isolation.\n-\n-```typescript\n-// Track local text per cell ID\n-const [localTexts, setLocalTexts] = useState<Map<string, string>>(new Map());\n-const [composingCells, setComposingCells] = useState<Set<string>>(new Set());\n-\n-const handleTextChange = (cellId: string, newText: string) => {\n-  setLocalTexts(prev => {\n-    const next = new Map(prev);\n-    next.set(cellId, newText);\n-    return next;\n-  });\n-\n-  // Only update engine if NOT composing\n-  if (!composingCells.has(cellId)) {\n-    engineRef.current.updateTextCell(cellId, newText);\n-  }\n-};\n-\n-const handleCompositionEnd = (cellId: string, e: CompositionEvent) => {\n-  // Commit to engine only after composition finishes\n-  engineRef.current.updateTextCell(cellId, e.currentTarget.value);\n-};\n-```\n-\n-**@@@ Critical**: Never use array indices to track cells. Always use cell IDs (UUIDs).\n-\n-### Pattern 4: Voice Configuration Hierarchy\n-\n-**Three sources** (in priority order):\n-\n-1. **User's custom configs** (stored in database `preferences` table)\n-2. **Default archetypes** (`backend/config.py` â†’ `VOICE_ARCHETYPES`)\n-3. **Fallback** (if voice_id not found)\n-\n-```python\n-# Backend loads from database\n-prefs = database.get_preferences(user_id)\n-voice_configs = prefs['voice_configs'] if prefs else None\n-\n-# Lookup specific voice\n-if voice_id in voice_configs:\n-    voice_config = voice_configs[voice_id]\n-else:\n-    # Fall back to default\n-    voice_config = config.VOICE_ARCHETYPES.get(voice_id, {...})\n-```\n-\n-**Frontend never sends voice configs** - backend loads from database using `user_id` from JWT.\n-\n-### Pattern 5: Scroll-Independent Positioning\n-\n-**Problem**: Comments were shifting when user scrolled then clicked.\n-\n-**Solution**: Use `offsetTop` (document-relative) instead of `getBoundingClientRect()` (viewport-relative):\n-\n-```typescript\n-const cellWrapper = cellTextarea.parentElement; // The div with position: relative\n-const cellOffsetTop = cellWrapper.offsetTop;\n-\n-// Position using offsetTop (scroll-independent)\n-const topPosition = cellOffsetTop + group.centerY + containerPadding + stateChooserHeight - (lineHeight * 0.7);\n-```\n-\n-**Why 0.7 lineHeight?** Iteratively tested: 1.0 = too far up, 0.5 = too far down, 0.7 = perfect alignment.\n-\n----\n-\n-## Database-First Architecture (Recent Refactor)\n-\n-**Before**: Frontend sent voice configs in every API call, used localStorage\n-\n-**After**:\n-- Voice configs stored in database `preferences.voice_configs`\n-- Backend loads configs using `user_id` from JWT token\n-- Frontend only sends `voice_id` (e.g., \"holder\"), backend looks up full config\n-- localStorage only used for unauthenticated draft mode\n-\n-**Migration path**:\n-1. User logs in for first time\n-2. Frontend shows migration dialog\n-3. Calls `/api/import-local-data` with localStorage export\n-4. Backend imports sessions/pictures/preferences/reports to database\n-5. Sets `first_login_completed` flag\n-\n----\n-\n-## File Organization\n-\n-```\n-ink-and-memory/\n-â”œâ”€â”€ backend/\n-â”‚   â”œâ”€â”€ server.py              # FastAPI app + PolyCLI session definitions\n-â”‚   â”œâ”€â”€ stateless_analyzer.py  # LLM prompt + analysis logic\n-â”‚   â”œâ”€â”€ config.py              # Voice archetypes + model config\n-â”‚   â”œâ”€â”€ auth.py                # JWT token creation/verification\n-â”‚   â”œâ”€â”€ database.py            # SQLite operations\n-â”‚   â”œâ”€â”€ proxy_config.py        # GFW bypass for API calls\n-â”‚   â””â”€â”€ prompts/               # Voice persona system prompts\n-â”‚       â”œâ”€â”€ holder.md\n-â”‚       â”œâ”€â”€ unpacker.md\n-â”‚       â””â”€â”€ ...\n-â”‚\n-â””â”€â”€ frontend/\n-    â”œâ”€â”€ src/\n-    â”‚   â”œâ”€â”€ App.tsx            # Main application component\n-    â”‚   â”‚                      # - Energy polling system\n-    â”‚   â”‚                      # - Comment positioning logic\n-    â”‚   â”‚                      # - Per-cell state management\n-    â”‚   â”‚\n-    â”‚   â”œâ”€â”€ engine/\n-    â”‚   â”‚   â”œâ”€â”€ EditorEngine.ts    # Core state management + collision detection\n-    â”‚   â”‚   â””â”€â”€ ChatWidget.ts      # Chat widget data model\n-    â”‚   â”‚\n-    â”‚   â”œâ”€â”€ components/\n-    â”‚   â”‚   â”œâ”€â”€ VoiceSettings.tsx  # Voice persona CRUD\n-    â”‚   â”‚   â”œâ”€â”€ StateChooser.tsx   # Emotional state selector\n-    â”‚   â”‚   â”œâ”€â”€ AgentDropdown.tsx  # @ voice selection dropdown\n-    â”‚   â”‚   â”œâ”€â”€ ChatWidgetUI.tsx   # Chat widget UI\n-    â”‚   â”‚   â”œâ”€â”€ CalendarPopup.tsx  # Calendar for saving/loading entries\n-    â”‚   â”‚   â”œâ”€â”€ AnalysisView.tsx   # Echoes/traits/patterns analysis\n-    â”‚   â”‚   â””â”€â”€ ...\n-    â”‚   â”‚\n-    â”‚   â”œâ”€â”€ api/\n-    â”‚   â”‚   â””â”€â”€ voiceApi.ts        # Backend API calls\n-    â”‚   â”‚\n-    â”‚   â”œâ”€â”€ contexts/\n-    â”‚   â”‚   â””â”€â”€ AuthContext.tsx    # JWT token management\n-    â”‚   â”‚\n-    â”‚   â””â”€â”€ utils/\n-    â”‚       â”œâ”€â”€ voiceStorage.ts    # localStorage utilities\n-    â”‚       â”œâ”€â”€ calendarStorage.ts # Calendar entry management\n-    â”‚       â””â”€â”€ textNormalize.ts   # Case-insensitive phrase matching\n-    â”‚\n-    â””â”€â”€ vite.config.ts         # CRITICAL: base: '/ink-and-memory/'\n-```\n-\n----\n-\n-## Common Development Tasks\n-\n-### Adding a New Voice Persona\n-\n-1. Create prompt file: `backend/prompts/new_voice.md`\n-2. Add to `backend/config.py`:\n-   ```python\n-   VOICE_ARCHETYPES = {\n-       \"new_voice\": {\n-           \"name\": \"Display Name\",\n-           \"tagline\": _load_prompt(\"new_voice.md\"),\n-           \"icon\": \"brain\",  # Must be from icon list\n-           \"color\": \"blue\"   # Must be from color list\n-       }\n-   }\n-   ```\n-3. Icon options: brain, heart, question, cloud, masks, eye, fist, lightbulb, shield, wind, fire, compass\n-4. Color options: blue, pink, yellow, green, purple\n-\n-### Adding a New PolyCLI Session\n-\n-1. Define in `backend/server.py`:\n-   ```python\n-   @session_def(\n-       name=\"Your Session Name\",\n-       description=\"What it does\",\n-       params={\"param1\": {\"type\": \"str\"}, ...},\n-       category=\"Category\"\n-   )\n-   def your_function(param1: str, user_id: int):\n-       # user_id is auto-injected by auth middleware\n-       # ...\n-       return {\"result\": \"...\"}\n-   ```\n-\n-2. Call from frontend:\n-   ```typescript\n-   const token = localStorage.getItem(STORAGE_KEYS.AUTH_TOKEN);\n-\n-   const response = await fetch(`${API_BASE}/polycli/api/trigger-sync`, {\n-     method: 'POST',\n-     headers: {\n-       'Authorization': `Bearer ${token}`,\n-       'Content-Type': 'application/json'\n-     },\n-     body: JSON.stringify({\n-       session_id: 'your_session_name',  // Lowercase snake_case\n-       params: { param1: \"value\" },\n-       timeout: 60\n-     })\n-   });\n-\n-   const data = await response.json();\n-   if (data.success) {\n-     // Use data.result\n-   }\n-   ```\n-\n-### Debugging Energy System\n-\n-Check energy accumulation in browser console:\n-```\n-Energy accumulated: +5 (total: 12/40)\n-```\n-\n-Check weight calculation:\n-```typescript\n-console.log('Weight:', computeWeight(text));\n-console.log('Delta:', currentWeight - lastWeight);\n-```\n-\n-Check backend logs for LLM calls:\n-```\n-ðŸŽ¯ Stateless analyze_text() called\n-   Text: ...\n-   Applied comments: 3\n-```\n-\n-### Testing Collision Detection\n-\n-1. Write text with multiple distinct phrases\n-2. Wait for first comment to appear (energy >= 40)\n-3. Continue writing\n-4. Check if new comments avoid overlapping with existing highlights\n-5. Check console for:\n-   ```\n-   âš ï¸ Collision detected for \"phrase\", skipping\n-   ```\n-\n----\n-\n-## Important Patterns to Remember\n-\n-### @@@ Comment Format\n-Use `@@@title - explanation` format for tricky code sections to enable easy navigation:\n-\n-```typescript\n-// @@@ Quote Weight Hack - prevent false energy accumulation\n-setTimeout(() => {\n-  lastPollWeightRef.current = getWeightedLength(currentTextRef.current);\n-}, 0);\n-```\n-\n-### Minimal Implementation Principle\n-- Code is expensive (buys features with complexity)\n-- Prefer simple solutions over defensive edge cases\n-- Show what's there, don't guess (print-based debugging)\n-\n-### Authentication Headers\n-All `/polycli/api/trigger-sync` calls MUST include:\n-```typescript\n-headers: {\n-  'Authorization': `Bearer ${token}`\n-}\n-```\n-\n-### Response Format Pattern\n-PolyCLI always returns:\n-```typescript\n-{\n-  success: true,\n-  result: {...}  // Your data here\n-}\n-// or\n-{\n-  success: false,\n-  error: \"Error message\"\n-}\n-```\n-\n-Always check `data.success` before accessing `data.result`.\n-\n----\n-\n-## Deployment to Production\n-\n-**Server**: Alibaba Cloud (101.201.227.31)\n-**SSH Key**: `~/Codebase/serverManagement/keys/Jeffry.pem`\n-**Live URL**: https://lexicalmathical.com/ink-and-memory/\n-\n-### Full Deployment Process\n-\n-```bash\n-# 1. Build frontend\n-cd ~/Codebase/ink-and-memory/frontend\n-npm run build\n-\n-# 2. Deploy frontend\n-scp -i ~/Codebase/serverManagement/keys/Jeffry.pem -r dist/* \\\n-  root@101.201.227.31:/var/www/lexicalmathical.com/ink-and-memory/\n-\n-# 3. Fix permissions\n-ssh -i ~/Codebase/serverManagement/keys/Jeffry.pem root@101.201.227.31 \\\n-  \"chown -R www-data:www-data /var/www/lexicalmathical.com/ink-and-memory/\"\n-\n-# 4. Deploy backend\n-cd ~/Codebase/ink-and-memory/backend\n-scp -i ~/Codebase/serverManagement/keys/Jeffry.pem *.py \\\n-  root@101.201.227.31:/root/ink-and-memory/backend/\n-\n-# 5. Restart backend (running in tmux session 'ink-and-memory')\n-ssh -i ~/Codebase/serverManagement/keys/Jeffry.pem root@101.201.227.31 \"\n-  tmux send-keys -t ink-and-memory:0 C-c\n-  sleep 2\n-  tmux send-keys -t ink-and-memory:0 'cd /root/ink-and-memory/backend && source .venv/bin/activate && python server.py' Enter\n-\"\n-```\n-\n-**Verification**:\n-```bash\n-# Check backend is running\n-ssh -i ~/Codebase/serverManagement/keys/Jeffry.pem root@101.201.227.31 \\\n-  \"lsof -i :8765\"\n-\n-# Test live API\n-curl -s https://lexicalmathical.com/ink-and-memory/api/sessions | jq\n-```\n-\n-**CRITICAL**: `vite.config.ts` must have `base: '/ink-and-memory/'` to match deployment path.\n-\n----\n-\n-## Known Issues & Quirks\n-\n-### IME Composition\n-Chinese/Japanese input requires special handling. Never update state during composition, only on `compositionend` event.\n-\n-### Font Loading\n-Uses `font-display: swap` to prevent FOIT (Flash of Invisible Text). Fonts are preloaded in `index.html`.\n-\n-### Mobile Differences\n-- No left sidebar (hidden)\n-- Floating toolbar in top right\n-- Comment popup at bottom instead of right margin\n-- Detection: `useMobile()` hook checks `window.innerWidth < 768`\n-\n-### Browser Auto-Scroll\n-Prevent browser from scrolling element into view on focus:\n-```typescript\n-onFocus={(e) => {\n-  e.preventDefault();\n-}}\n-```\n-\n----\n-\n-## Testing Checklist\n-\n-Before deploying:\n-- [ ] Backend starts without errors on :8765\n-- [ ] Frontend builds without errors\n-- [ ] Voice comment analysis works (energy >= 40 triggers LLM)\n-- [ ] Chat widget works (can chat with voice personas)\n-- [ ] Authentication works (login/register/JWT)\n-- [ ] Calendar saves/loads entries correctly\n-- [ ] Voice settings CRUD works\n-- [ ] Mobile layout renders correctly\n-- [ ] No collision between highlighted phrases\n-- [ ] Image generation works (daily pictures)\n-\n----\n-\n-## Dependencies\n-\n-### Backend\n-- **PolyCLI** (local development): `~/Codebase/PolyCLI`\n-- **FastAPI**: Web server\n-- **Pillow**: Image conversion (PNG â†’ JPEG + thumbnails)\n-- **PyJWT**: JWT token handling\n-- **httpx[socks]**: Proxy support for GFW bypass\n-\n-### Frontend\n-- **React 19**: UI framework\n-- **Vite**: Build tool\n-- **TypeScript**: Type safety\n-- **react-icons**: Icon library\n-\n----\n-\n-## Related Documentation\n-\n-- **Server Infrastructure**: `~/Codebase/serverManagement/CLAUDE.md`\n-- **PolyCLI**: `~/Codebase/PolyCLI/README.md`\n-- **User Guide**: `README.md`\n-- **Refactor Status**: `/tmp/ink-and-memory-refactor-status.md` (recent changes)"
    }
  ]
}