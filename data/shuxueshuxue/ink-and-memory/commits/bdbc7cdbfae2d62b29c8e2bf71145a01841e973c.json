{
  "sha": "bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
  "node_id": "C_kwDOP2Zrm9oAKGJkYmM3Y2RiZmFlMmQ2MmIyOWM4ZTJiZjcxMTQ1YTAxODQxZTk3M2M",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-19T08:16:08Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-19T08:16:08Z"
    },
    "message": "feat: add friend system UI\n\n- Add FriendsView component with 3 tabs (My Friends, Requests, Add Friend)\n- Implement friend list, request management, and invite code system\n- Add friend system API functions to voiceApi.ts\n- Update TopNavBar with Friends navigation button\n- Add i18n translations for friend system (English + Chinese)\n- Integrate FriendsView into App.tsx routing",
    "tree": {
      "sha": "09b7ffbb5bd1a151c351636ed35ac13113217243",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/09b7ffbb5bd1a151c351636ed35ac13113217243"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/cf049f26eaf34f5d1b20486bf0b7e5bc737dc2fc"
    }
  ],
  "stats": {
    "total": 1306,
    "additions": 1292,
    "deletions": 14
  },
  "files": [
    {
      "sha": "0da689ceaa7260447ed32f5b067d2a53bc3fe888",
      "filename": "backend/database.py",
      "status": "modified",
      "additions": 337,
      "deletions": 0,
      "changes": 337,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/backend%2Fdatabase.py",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/backend%2Fdatabase.py",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/backend%2Fdatabase.py?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -198,6 +198,39 @@ def create_tables(db):\n     db.execute(\"CREATE INDEX IF NOT EXISTS idx_voices_deck ON voices(deck_id)\")\n     db.execute(\"CREATE INDEX IF NOT EXISTS idx_voices_owner ON voices(owner_id)\")\n \n+    # @@@ Friendships table - bidirectional friend relationships\n+    db.execute(\"\"\"\n+    CREATE TABLE IF NOT EXISTS friendships (\n+      id INTEGER PRIMARY KEY AUTOINCREMENT,\n+      user_id INTEGER NOT NULL,\n+      friend_id INTEGER NOT NULL,\n+      status TEXT NOT NULL CHECK(status IN ('pending', 'accepted', 'rejected')),\n+      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n+      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n+      FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE,\n+      FOREIGN KEY (friend_id) REFERENCES users (id) ON DELETE CASCADE,\n+      UNIQUE(user_id, friend_id)\n+    )\n+    \"\"\")\n+    db.execute(\"CREATE INDEX IF NOT EXISTS idx_friendships_user ON friendships(user_id, status)\")\n+    db.execute(\"CREATE INDEX IF NOT EXISTS idx_friendships_friend ON friendships(friend_id, status)\")\n+\n+    # @@@ Friend invites table - one-time invite codes\n+    db.execute(\"\"\"\n+    CREATE TABLE IF NOT EXISTS friend_invites (\n+      code TEXT PRIMARY KEY,\n+      user_id INTEGER NOT NULL,\n+      expires_at DATETIME NOT NULL,\n+      used_by INTEGER,\n+      used_at DATETIME,\n+      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n+      FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE,\n+      FOREIGN KEY (used_by) REFERENCES users (id) ON DELETE SET NULL\n+    )\n+    \"\"\")\n+    db.execute(\"CREATE INDEX IF NOT EXISTS idx_invites_user ON friend_invites(user_id)\")\n+    db.execute(\"CREATE INDEX IF NOT EXISTS idx_invites_expires ON friend_invites(expires_at)\")\n+\n     print(\"✅ Tables created\")\n \n def seed_system_decks():\n@@ -1407,6 +1440,310 @@ def import_user_data(user_id: int, sessions: list, pictures: list, preferences:\n     finally:\n         db.close()\n \n+# ========== Friend System ==========\n+\n+def generate_invite_code(user_id: int) -> dict:\n+    \"\"\"\n+    Generate a new friend invite code (6 chars, 7 days validity).\n+    Returns: {code, expires_at}\n+    \"\"\"\n+    import random\n+    import string\n+    from datetime import datetime, timedelta\n+\n+    db = get_db()\n+    try:\n+        # Generate unique 6-character code\n+        while True:\n+            code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))\n+            # Check if code already exists and is not expired\n+            existing = db.execute(\n+                \"SELECT code FROM friend_invites WHERE code = ? AND expires_at > datetime('now')\",\n+                (code,)\n+            ).fetchone()\n+            if not existing:\n+                break\n+\n+        expires_at = (datetime.now() + timedelta(days=7)).isoformat()\n+\n+        db.execute(\"\"\"\n+        INSERT INTO friend_invites (code, user_id, expires_at)\n+        VALUES (?, ?, ?)\n+        \"\"\", (code, user_id, expires_at))\n+\n+        db.commit()\n+        return {\"code\": code, \"expires_at\": expires_at}\n+    finally:\n+        db.close()\n+\n+def use_invite_code(code: str, requesting_user_id: int) -> dict:\n+    \"\"\"\n+    Use an invite code to send a friend request.\n+    Returns: {success, friend_request_id, inviter_id, inviter_name} or {success: False, error}\n+    \"\"\"\n+    from datetime import datetime\n+\n+    db = get_db()\n+    try:\n+        # Validate invite code\n+        invite = db.execute(\"\"\"\n+        SELECT user_id, expires_at, used_by\n+        FROM friend_invites\n+        WHERE code = ?\n+        \"\"\", (code,)).fetchone()\n+\n+        if not invite:\n+            return {\"success\": False, \"error\": \"Invalid invite code\"}\n+\n+        if invite['used_by']:\n+            return {\"success\": False, \"error\": \"Invite code already used\"}\n+\n+        if datetime.fromisoformat(invite['expires_at']) < datetime.now():\n+            return {\"success\": False, \"error\": \"Invite code expired\"}\n+\n+        inviter_id = invite['user_id']\n+\n+        if inviter_id == requesting_user_id:\n+            return {\"success\": False, \"error\": \"Cannot add yourself as friend\"}\n+\n+        # Check if friendship already exists\n+        existing = db.execute(\"\"\"\n+        SELECT id, status FROM friendships\n+        WHERE (user_id = ? AND friend_id = ?) OR (user_id = ? AND friend_id = ?)\n+        \"\"\", (requesting_user_id, inviter_id, inviter_id, requesting_user_id)).fetchone()\n+\n+        if existing:\n+            if existing['status'] == 'accepted':\n+                return {\"success\": False, \"error\": \"Already friends\"}\n+            elif existing['status'] == 'pending':\n+                return {\"success\": False, \"error\": \"Friend request already pending\"}\n+\n+        # Get inviter's display name\n+        inviter = db.execute(\n+            \"SELECT display_name, email FROM users WHERE id = ?\",\n+            (inviter_id,)\n+        ).fetchone()\n+\n+        # Create friendship request (requesting_user sends request to inviter)\n+        cursor = db.execute(\"\"\"\n+        INSERT INTO friendships (user_id, friend_id, status)\n+        VALUES (?, ?, 'pending')\n+        \"\"\", (requesting_user_id, inviter_id))\n+\n+        friend_request_id = cursor.lastrowid\n+\n+        # Mark invite as used\n+        db.execute(\"\"\"\n+        UPDATE friend_invites\n+        SET used_by = ?, used_at = datetime('now')\n+        WHERE code = ?\n+        \"\"\", (requesting_user_id, code))\n+\n+        db.commit()\n+\n+        return {\n+            \"success\": True,\n+            \"friend_request_id\": friend_request_id,\n+            \"inviter_id\": inviter_id,\n+            \"inviter_name\": inviter['display_name'] or inviter['email']\n+        }\n+    finally:\n+        db.close()\n+\n+def get_friend_requests(user_id: int) -> list:\n+    \"\"\"\n+    Get all pending friend requests FOR this user (others wanting to be friends).\n+    Returns: [{id, requester_id, requester_name, created_at}]\n+    \"\"\"\n+    db = get_db()\n+    try:\n+        rows = db.execute(\"\"\"\n+        SELECT f.id, f.user_id as requester_id, u.display_name, u.email, f.created_at\n+        FROM friendships f\n+        JOIN users u ON f.user_id = u.id\n+        WHERE f.friend_id = ? AND f.status = 'pending'\n+        ORDER BY f.created_at DESC\n+        \"\"\", (user_id,)).fetchall()\n+\n+        return [{\n+            \"id\": row['id'],\n+            \"requester_id\": row['requester_id'],\n+            \"requester_name\": row['display_name'] or row['email'],\n+            \"created_at\": row['created_at']\n+        } for row in rows]\n+    finally:\n+        db.close()\n+\n+def accept_friend_request(request_id: int, user_id: int) -> dict:\n+    \"\"\"\n+    Accept a friend request. user_id must be the friend_id in the request.\n+    Returns: {success, error?}\n+    \"\"\"\n+    db = get_db()\n+    try:\n+        # Verify this request is for current user and is pending\n+        request = db.execute(\"\"\"\n+        SELECT user_id, friend_id, status\n+        FROM friendships\n+        WHERE id = ?\n+        \"\"\", (request_id,)).fetchone()\n+\n+        if not request:\n+            return {\"success\": False, \"error\": \"Request not found\"}\n+\n+        if request['friend_id'] != user_id:\n+            return {\"success\": False, \"error\": \"Permission denied\"}\n+\n+        if request['status'] != 'pending':\n+            return {\"success\": False, \"error\": f\"Request already {request['status']}\"}\n+\n+        # Update status to accepted\n+        db.execute(\"\"\"\n+        UPDATE friendships\n+        SET status = 'accepted', updated_at = datetime('now')\n+        WHERE id = ?\n+        \"\"\", (request_id,))\n+\n+        db.commit()\n+        return {\"success\": True}\n+    finally:\n+        db.close()\n+\n+def reject_friend_request(request_id: int, user_id: int) -> dict:\n+    \"\"\"\n+    Reject a friend request. user_id must be the friend_id in the request.\n+    Returns: {success, error?}\n+    \"\"\"\n+    db = get_db()\n+    try:\n+        # Verify this request is for current user and is pending\n+        request = db.execute(\"\"\"\n+        SELECT user_id, friend_id, status\n+        FROM friendships\n+        WHERE id = ?\n+        \"\"\", (request_id,)).fetchone()\n+\n+        if not request:\n+            return {\"success\": False, \"error\": \"Request not found\"}\n+\n+        if request['friend_id'] != user_id:\n+            return {\"success\": False, \"error\": \"Permission denied\"}\n+\n+        if request['status'] != 'pending':\n+            return {\"success\": False, \"error\": f\"Request already {request['status']}\"}\n+\n+        # Update status to rejected\n+        db.execute(\"\"\"\n+        UPDATE friendships\n+        SET status = 'rejected', updated_at = datetime('now')\n+        WHERE id = ?\n+        \"\"\", (request_id,))\n+\n+        db.commit()\n+        return {\"success\": True}\n+    finally:\n+        db.close()\n+\n+def get_friends(user_id: int) -> list:\n+    \"\"\"\n+    Get all accepted friends for this user.\n+    Returns: [{friend_id, friend_name, friend_email, since}]\n+    \"\"\"\n+    db = get_db()\n+    try:\n+        # Get friends where I sent the request\n+        rows1 = db.execute(\"\"\"\n+        SELECT f.friend_id as friend_id, u.display_name, u.email, f.updated_at\n+        FROM friendships f\n+        JOIN users u ON f.friend_id = u.id\n+        WHERE f.user_id = ? AND f.status = 'accepted'\n+        \"\"\", (user_id,)).fetchall()\n+\n+        # Get friends where they sent the request\n+        rows2 = db.execute(\"\"\"\n+        SELECT f.user_id as friend_id, u.display_name, u.email, f.updated_at\n+        FROM friendships f\n+        JOIN users u ON f.user_id = u.id\n+        WHERE f.friend_id = ? AND f.status = 'accepted'\n+        \"\"\", (user_id,)).fetchall()\n+\n+        all_friends = []\n+        for row in rows1 + rows2:\n+            all_friends.append({\n+                \"friend_id\": row['friend_id'],\n+                \"friend_name\": row['display_name'] or row['email'],\n+                \"friend_email\": row['email'],\n+                \"since\": row['updated_at']\n+            })\n+\n+        # Sort by most recent first\n+        all_friends.sort(key=lambda x: x['since'], reverse=True)\n+\n+        return all_friends\n+    finally:\n+        db.close()\n+\n+def remove_friend(user_id: int, friend_id: int) -> dict:\n+    \"\"\"\n+    Remove a friend relationship.\n+    Returns: {success, error?}\n+    \"\"\"\n+    db = get_db()\n+    try:\n+        # Delete the friendship (bidirectional - delete either direction)\n+        result = db.execute(\"\"\"\n+        DELETE FROM friendships\n+        WHERE status = 'accepted' AND (\n+          (user_id = ? AND friend_id = ?) OR\n+          (user_id = ? AND friend_id = ?)\n+        )\n+        \"\"\", (user_id, friend_id, friend_id, user_id))\n+\n+        if result.rowcount == 0:\n+            return {\"success\": False, \"error\": \"Friendship not found\"}\n+\n+        db.commit()\n+        return {\"success\": True}\n+    finally:\n+        db.close()\n+\n+def get_friend_timeline(user_id: int, friend_id: int, limit: int = 30) -> list:\n+    \"\"\"\n+    Get friend's timeline pictures (only if they are friends).\n+    Returns: [{date, base64, prompt, created_at}] or None if not friends\n+    \"\"\"\n+    db = get_db()\n+    try:\n+        # Check if they are friends\n+        friendship = db.execute(\"\"\"\n+        SELECT id FROM friendships\n+        WHERE status = 'accepted' AND (\n+          (user_id = ? AND friend_id = ?) OR\n+          (user_id = ? AND friend_id = ?)\n+        )\n+        \"\"\", (user_id, friend_id, friend_id, user_id)).fetchone()\n+\n+        if not friendship:\n+            return None  # Not friends, no access\n+\n+        # Get friend's timeline pictures (thumbnails)\n+        rows = db.execute(\"\"\"\n+        SELECT date, COALESCE(thumbnail_base64, image_base64) as base64, prompt, created_at\n+        FROM daily_pictures\n+        WHERE user_id = ?\n+        ORDER BY date DESC\n+        LIMIT ?\n+        \"\"\", (friend_id, limit)).fetchall()\n+\n+        return [{\n+            \"date\": row['date'],\n+            \"base64\": row['base64'],\n+            \"prompt\": row['prompt'],\n+            \"created_at\": row['created_at']\n+        } for row in rows]\n+    finally:\n+        db.close()\n+\n if __name__ == \"__main__\":\n     # Initialize database\n     init_db()"
    },
    {
      "sha": "de72d4ce1f3f863fdd0c761381022dbe09ac81d4",
      "filename": "backend/server.py",
      "status": "modified",
      "additions": 85,
      "deletions": 0,
      "changes": 85,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/backend%2Fserver.py",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/backend%2Fserver.py",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/backend%2Fserver.py?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -1367,6 +1367,14 @@ class VoiceUpdateRequest(BaseModel):\n class VoiceForkRequest(BaseModel):\n     target_deck_id: str\n \n+# ========== Friend System Models ==========\n+\n+class UseInviteCodeRequest(BaseModel):\n+    code: str\n+\n+class FriendRequestActionRequest(BaseModel):\n+    pass  # No body needed, just request_id in URL\n+\n @app.get(\"/api/decks\")\n def list_decks(published: bool = False, current_user: dict = Depends(get_current_user)):\n     \"\"\"Get decks - either user's own or published community decks\"\"\"\n@@ -1523,6 +1531,74 @@ def fork_voice(voice_id: str, request: VoiceForkRequest, current_user: dict = De\n     except ValueError as e:\n         raise HTTPException(status_code=400, detail=str(e))\n \n+# ========== Friend System Endpoints ==========\n+\n+@app.post(\"/api/friends/invite/generate\")\n+def generate_friend_invite(current_user: dict = Depends(get_current_user)):\n+    \"\"\"Generate a new friend invite code (6 chars, 7 days validity)\"\"\"\n+    user_id = current_user['user_id']\n+    result = database.generate_invite_code(user_id)\n+    return result\n+\n+@app.post(\"/api/friends/invite/use\")\n+def use_friend_invite(request: UseInviteCodeRequest, current_user: dict = Depends(get_current_user)):\n+    \"\"\"Use an invite code to send a friend request\"\"\"\n+    user_id = current_user['user_id']\n+    result = database.use_invite_code(request.code, user_id)\n+    if not result.get('success'):\n+        raise HTTPException(status_code=400, detail=result.get('error'))\n+    return result\n+\n+@app.get(\"/api/friends/requests\")\n+def get_friend_requests(current_user: dict = Depends(get_current_user)):\n+    \"\"\"Get all pending friend requests for current user\"\"\"\n+    user_id = current_user['user_id']\n+    requests = database.get_friend_requests(user_id)\n+    return {\"requests\": requests}\n+\n+@app.post(\"/api/friends/requests/{request_id}/accept\")\n+def accept_friend_request(request_id: int, current_user: dict = Depends(get_current_user)):\n+    \"\"\"Accept a friend request\"\"\"\n+    user_id = current_user['user_id']\n+    result = database.accept_friend_request(request_id, user_id)\n+    if not result.get('success'):\n+        raise HTTPException(status_code=400, detail=result.get('error'))\n+    return result\n+\n+@app.post(\"/api/friends/requests/{request_id}/reject\")\n+def reject_friend_request(request_id: int, current_user: dict = Depends(get_current_user)):\n+    \"\"\"Reject a friend request\"\"\"\n+    user_id = current_user['user_id']\n+    result = database.reject_friend_request(request_id, user_id)\n+    if not result.get('success'):\n+        raise HTTPException(status_code=400, detail=result.get('error'))\n+    return result\n+\n+@app.get(\"/api/friends\")\n+def get_friends(current_user: dict = Depends(get_current_user)):\n+    \"\"\"Get all accepted friends for current user\"\"\"\n+    user_id = current_user['user_id']\n+    friends = database.get_friends(user_id)\n+    return {\"friends\": friends}\n+\n+@app.delete(\"/api/friends/{friend_id}\")\n+def remove_friend(friend_id: int, current_user: dict = Depends(get_current_user)):\n+    \"\"\"Remove a friend\"\"\"\n+    user_id = current_user['user_id']\n+    result = database.remove_friend(user_id, friend_id)\n+    if not result.get('success'):\n+        raise HTTPException(status_code=400, detail=result.get('error'))\n+    return result\n+\n+@app.get(\"/api/friends/{friend_id}/timeline\")\n+def get_friend_timeline(friend_id: int, limit: int = 30, current_user: dict = Depends(get_current_user)):\n+    \"\"\"Get a friend's timeline pictures (only if friends)\"\"\"\n+    user_id = current_user['user_id']\n+    timeline = database.get_friend_timeline(user_id, friend_id, limit)\n+    if timeline is None:\n+        raise HTTPException(status_code=403, detail=\"Not friends or friend not found\")\n+    return {\"pictures\": timeline}\n+\n # @@@ Removed /api/analyze wrapper - frontend now calls /polycli/api/trigger-sync directly\n \n # @@@ Removed /api/chat wrapper - frontend now calls /polycli/api/trigger-sync directly\n@@ -1575,6 +1651,15 @@ def fork_voice(voice_id: str, request: VoiceForkRequest, current_user: dict = De\n     print(\"    PUT  /api/voices/{id}     - Update voice\")\n     print(\"    DELETE /api/voices/{id}   - Delete voice\")\n     print(\"    POST /api/voices/{id}/fork - Fork voice\")\n+    print(\"  Friend System:\")\n+    print(\"    POST /api/friends/invite/generate - Generate invite code\")\n+    print(\"    POST /api/friends/invite/use      - Use invite code\")\n+    print(\"    GET  /api/friends/requests        - Get friend requests\")\n+    print(\"    POST /api/friends/requests/{id}/accept - Accept request\")\n+    print(\"    POST /api/friends/requests/{id}/reject - Reject request\")\n+    print(\"    GET  /api/friends                 - Get friends list\")\n+    print(\"    DELETE /api/friends/{id}          - Remove friend\")\n+    print(\"    GET  /api/friends/{id}/timeline   - Get friend's timeline\")\n     print(\"\\n  PolyCLI (AI Functions):\")\n     print(\"    /polycli                  - Control panel UI\")\n     print(\"    /polycli/api/trigger-sync - Direct sync API\")"
    },
    {
      "sha": "69284599defc4b29aef1f783cae8ec8e5f7742a0",
      "filename": "backend/stateless_analyzer.py",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/backend%2Fstateless_analyzer.py",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/backend%2Fstateless_analyzer.py",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/backend%2Fstateless_analyzer.py?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -115,7 +115,10 @@ def analyze_stateless(agent: PolyAgent, text: str, applied_comments: List[dict],\n - DO NOT suggest any rejected phrases: {overlapped_phrases}\n - DO NOT CREATE NEW VOICE NAMES - Only use from the available list\n - Return null if nothing is worth commenting on\n-- Write in the SAME LANGUAGE as the text\n+- Write your comment in the EXACT SAME LANGUAGE as the user's text\n+  * If user writes in Chinese, comment in Chinese\n+  * If user writes in English, comment in English\n+  * Match the user's language REGARDLESS of what language the voice's name or system prompt uses\n \n IMPORTANT: Return voice_id only (e.g., \"holder\"). Do NOT fill voice_name - it will be auto-filled.\"\"\"\n "
    },
    {
      "sha": "51d5f58195f578129ce1c108ad3afa2c6820ce34",
      "filename": "frontend/src/App.tsx",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2FApp.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2FApp.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2FApp.tsx?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -18,6 +18,7 @@ import { saveEntryToToday, type CalendarEntry } from './utils/calendarStorage';\n import CollectionsView from './components/CollectionsView';\n import AnalysisView from './components/AnalysisView';\n import AboutView from './components/AboutView';\n+import FriendsView from './components/FriendsView';\n import AgentDropdown from './components/AgentDropdown';\n import ChatWidgetUI from './components/ChatWidgetUI';\n import StateChooser from './components/StateChooser';\n@@ -2428,6 +2429,21 @@ export default function App() {\n         </div>\n       )}\n \n+      {currentView === 'friends' && (\n+        <div style={{\n+          position: 'fixed',\n+          top: 48,\n+          left: 0,\n+          right: 0,\n+          bottom: 0,\n+          background: '#f8f0e6',\n+          display: 'flex',\n+          overflow: 'hidden'\n+        }}>\n+          <FriendsView isVisible={currentView === 'friends'} />\n+        </div>\n+      )}\n+\n       {/* Warning Dialog */}\n       {showWarning && (\n         <div style={{"
    },
    {
      "sha": "db2d0b3d11c179926fb23062fffe96ef219ec4ff",
      "filename": "frontend/src/api/voiceApi.ts",
      "status": "modified",
      "additions": 165,
      "deletions": 2,
      "changes": 167,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fapi%2FvoiceApi.ts",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fapi%2FvoiceApi.ts",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fapi%2FvoiceApi.ts?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -899,8 +899,9 @@ export async function loadVoicesFromDecks(): Promise<Record<string, VoiceConfig>\n           for (const voice of fullDeck.voices) {\n             if (!voice.enabled) continue;\n \n-            // Convert Voice to VoiceConfig format\n-            voiceConfigs[voice.name] = {\n+            // @@@ Convert Voice to VoiceConfig format\n+            // Key by voice.id (UUID) so backend can find it in database\n+            voiceConfigs[voice.id] = {\n               name: voice.name,\n               systemPrompt: voice.system_prompt,\n               enabled: voice.enabled,\n@@ -922,3 +923,165 @@ export async function loadVoicesFromDecks(): Promise<Record<string, VoiceConfig>\n     return {};\n   }\n }\n+\n+// ========== Friend System API ==========\n+\n+export interface FriendInvite {\n+  code: string;\n+  expires_at: string;\n+  created_at: string;\n+}\n+\n+export interface FriendRequest {\n+  id: number;\n+  requester_id: number;\n+  requester_name: string;\n+  requester_email: string;\n+  created_at: string;\n+}\n+\n+export interface Friend {\n+  id: number;\n+  user_id: number;\n+  friend_id: number;\n+  friend_name: string;\n+  friend_email: string;\n+  created_at: string;\n+}\n+\n+/**\n+ * Generate a new friend invite code (6 chars, 7 days validity)\n+ */\n+export async function generateInviteCode(): Promise<FriendInvite> {\n+  const response = await fetch(`${API_BASE}/api/friends/invite/generate`, {\n+    method: 'POST',\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Generate invite code failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Use an invite code to send a friend request\n+ */\n+export async function useInviteCode(code: string): Promise<{ success: boolean; message: string }> {\n+  const response = await fetch(`${API_BASE}/api/friends/invite/use`, {\n+    method: 'POST',\n+    headers: getAuthHeaders(),\n+    body: JSON.stringify({ code })\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Use invite code failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Get all pending friend requests for current user\n+ */\n+export async function getFriendRequests(): Promise<FriendRequest[]> {\n+  const response = await fetch(`${API_BASE}/api/friends/requests`, {\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Get friend requests failed');\n+  }\n+\n+  const data = await response.json();\n+  return data.requests;\n+}\n+\n+/**\n+ * Accept a friend request\n+ */\n+export async function acceptFriendRequest(requestId: number): Promise<{ success: boolean }> {\n+  const response = await fetch(`${API_BASE}/api/friends/requests/${requestId}/accept`, {\n+    method: 'POST',\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Accept friend request failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Reject a friend request\n+ */\n+export async function rejectFriendRequest(requestId: number): Promise<{ success: boolean }> {\n+  const response = await fetch(`${API_BASE}/api/friends/requests/${requestId}/reject`, {\n+    method: 'POST',\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Reject friend request failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Get all accepted friends\n+ */\n+export async function getFriends(): Promise<Friend[]> {\n+  const response = await fetch(`${API_BASE}/api/friends`, {\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Get friends failed');\n+  }\n+\n+  const data = await response.json();\n+  return data.friends;\n+}\n+\n+/**\n+ * Remove a friend\n+ */\n+export async function removeFriend(friendId: number): Promise<{ success: boolean }> {\n+  const response = await fetch(`${API_BASE}/api/friends/${friendId}`, {\n+    method: 'DELETE',\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Remove friend failed');\n+  }\n+\n+  return await response.json();\n+}\n+\n+/**\n+ * Get friend's timeline (pictures)\n+ */\n+export async function getFriendTimeline(friendId: number, limit: number = 30): Promise<any[]> {\n+  const response = await fetch(`${API_BASE}/api/friends/${friendId}/timeline?limit=${limit}`, {\n+    headers: getAuthHeaders()\n+  });\n+\n+  if (!response.ok) {\n+    const error = await response.json();\n+    throw new Error(error.detail || 'Get friend timeline failed');\n+  }\n+\n+  const data = await response.json();\n+  return data.pictures;\n+}"
    },
    {
      "sha": "0a2f40d773b96a61557e3328a09b3bb84b2f5de6",
      "filename": "frontend/src/components/DeckManager.tsx",
      "status": "modified",
      "additions": 7,
      "deletions": 9,
      "changes": 16,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -277,7 +277,7 @@ export default function DeckManager({ onUpdate }: Props) {\n   async function handlePublishToggle(deckId: string) {\n     try {\n       const result = await publishDeck(deckId);\n-      alert(result.published ? '✅ Deck published to community!' : '✅ Deck unpublished');\n+      alert(result.published ? t('deck.messages.publishSuccess') : t('deck.messages.unpublishSuccess'));\n       await loadDecks(true);\n       await loadCommunityDecks();\n       onUpdate?.();\n@@ -291,7 +291,7 @@ export default function DeckManager({ onUpdate }: Props) {\n   async function handleInstallDeck(deckId: string) {\n     try {\n       await forkDeck(deckId);\n-      alert('✅ Deck installed to your collection!');\n+      alert(t('deck.messages.installSuccess'));\n       await loadDecks(true);\n       await loadCommunityDecks();\n       onUpdate?.();\n@@ -1507,17 +1507,15 @@ export default function DeckManager({ onUpdate }: Props) {\n             onClick={(e) => e.stopPropagation()}\n           >\n             <h3 style={{ marginBottom: '16px', fontSize: '18px', fontWeight: 600 }}>\n-              ⚠️ Publish Deck Warning\n+              {t('deck.publishWarning.heading')}\n             </h3>\n \n             <p style={{ marginBottom: '16px', lineHeight: '1.5', fontSize: '14px' }}>\n-              Publishing will <strong>break the parent link</strong>. This deck will become\n-              a standalone deck in the community store.\n+              <span dangerouslySetInnerHTML={{ __html: t('deck.publishWarning.body') }} />\n             </p>\n \n             <p style={{ marginBottom: '16px', color: '#e74c3c', fontSize: '13px', lineHeight: '1.5' }}>\n-              This action cannot be undone. You can unpublish later, but the parent\n-              link will remain broken.\n+              {t('deck.publishWarning.note')}\n             </p>\n \n             <div style={{ display: 'flex', gap: '8px', justifyContent: 'flex-end' }}>\n@@ -1534,7 +1532,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                   fontWeight: 500\n                 }}\n               >\n-                Cancel\n+                {t('deck.publishWarning.cancel')}\n               </button>\n               <button\n                 onClick={() => handlePublishToggle(publishWarning)}\n@@ -1549,7 +1547,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                   fontWeight: 500\n                 }}\n               >\n-                Publish Anyway\n+                {t('deck.publishWarning.confirm')}\n               </button>\n             </div>\n           </div>"
    },
    {
      "sha": "6e894ad9bc5b703501e59755141def42e5927018",
      "filename": "frontend/src/components/FriendsView.tsx",
      "status": "added",
      "additions": 570,
      "deletions": 0,
      "changes": 570,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fcomponents%2FFriendsView.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fcomponents%2FFriendsView.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FFriendsView.tsx?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -0,0 +1,570 @@\n+import { useState, useEffect } from 'react';\n+import { useTranslation } from 'react-i18next';\n+import {\n+  generateInviteCode,\n+  useInviteCode,\n+  getFriendRequests,\n+  acceptFriendRequest,\n+  rejectFriendRequest,\n+  getFriends,\n+  removeFriend,\n+  type FriendInvite,\n+  type FriendRequest,\n+  type Friend\n+} from '../api/voiceApi';\n+\n+interface Props {\n+  isVisible: boolean;\n+  onViewFriendTimeline?: (friendId: number, friendName: string) => void;\n+}\n+\n+export default function FriendsView({ isVisible, onViewFriendTimeline }: Props) {\n+  const { t } = useTranslation();\n+  const [activeTab, setActiveTab] = useState<'friends' | 'requests' | 'invite'>('friends');\n+\n+  // Invite state\n+  const [inviteCode, setInviteCode] = useState<FriendInvite | null>(null);\n+  const [generatingInvite, setGeneratingInvite] = useState(false);\n+  const [inputCode, setInputCode] = useState('');\n+  const [usingCode, setUsingCode] = useState(false);\n+  const [codeMessage, setCodeMessage] = useState('');\n+\n+  // Friends state\n+  const [friends, setFriends] = useState<Friend[]>([]);\n+  const [loadingFriends, setLoadingFriends] = useState(false);\n+\n+  // Requests state\n+  const [requests, setRequests] = useState<FriendRequest[]>([]);\n+  const [loadingRequests, setLoadingRequests] = useState(false);\n+\n+  // Load friends on mount\n+  useEffect(() => {\n+    if (isVisible && activeTab === 'friends') {\n+      loadFriends();\n+    }\n+  }, [isVisible, activeTab]);\n+\n+  // Load requests on mount\n+  useEffect(() => {\n+    if (isVisible && activeTab === 'requests') {\n+      loadRequests();\n+    }\n+  }, [isVisible, activeTab]);\n+\n+  const loadFriends = async () => {\n+    setLoadingFriends(true);\n+    try {\n+      const data = await getFriends();\n+      setFriends(data);\n+    } catch (err) {\n+      console.error('Failed to load friends:', err);\n+    } finally {\n+      setLoadingFriends(false);\n+    }\n+  };\n+\n+  const loadRequests = async () => {\n+    setLoadingRequests(true);\n+    try {\n+      const data = await getFriendRequests();\n+      setRequests(data);\n+    } catch (err) {\n+      console.error('Failed to load requests:', err);\n+    } finally {\n+      setLoadingRequests(false);\n+    }\n+  };\n+\n+  const handleGenerateInvite = async () => {\n+    setGeneratingInvite(true);\n+    try {\n+      const invite = await generateInviteCode();\n+      setInviteCode(invite);\n+    } catch (err) {\n+      console.error('Failed to generate invite:', err);\n+      alert(t('friends.generateError') || 'Failed to generate invite code');\n+    } finally {\n+      setGeneratingInvite(false);\n+    }\n+  };\n+\n+  const handleUseCode = async () => {\n+    if (!inputCode.trim()) return;\n+\n+    setUsingCode(true);\n+    setCodeMessage('');\n+    try {\n+      const result = await useInviteCode(inputCode.trim());\n+      setCodeMessage(result.message || t('friends.requestSent') || 'Friend request sent!');\n+      setInputCode('');\n+      // Refresh requests to see if there are any new ones\n+      setTimeout(() => loadRequests(), 500);\n+    } catch (err: any) {\n+      setCodeMessage(err.message || t('friends.useCodeError') || 'Invalid or expired code');\n+    } finally {\n+      setUsingCode(false);\n+    }\n+  };\n+\n+  const handleAcceptRequest = async (requestId: number) => {\n+    try {\n+      await acceptFriendRequest(requestId);\n+      // Refresh both requests and friends\n+      loadRequests();\n+      loadFriends();\n+    } catch (err) {\n+      console.error('Failed to accept request:', err);\n+      alert(t('friends.acceptError') || 'Failed to accept request');\n+    }\n+  };\n+\n+  const handleRejectRequest = async (requestId: number) => {\n+    try {\n+      await rejectFriendRequest(requestId);\n+      loadRequests();\n+    } catch (err) {\n+      console.error('Failed to reject request:', err);\n+      alert(t('friends.rejectError') || 'Failed to reject request');\n+    }\n+  };\n+\n+  const handleRemoveFriend = async (friendId: number) => {\n+    if (!confirm(t('friends.confirmRemove') || 'Remove this friend?')) return;\n+\n+    try {\n+      await removeFriend(friendId);\n+      loadFriends();\n+    } catch (err) {\n+      console.error('Failed to remove friend:', err);\n+      alert(t('friends.removeError') || 'Failed to remove friend');\n+    }\n+  };\n+\n+  const handleCopyCode = () => {\n+    if (inviteCode) {\n+      navigator.clipboard.writeText(inviteCode.code);\n+      alert(t('friends.codeCopied') || 'Code copied to clipboard!');\n+    }\n+  };\n+\n+  if (!isVisible) return null;\n+\n+  return (\n+    <div style={{\n+      width: '100%',\n+      height: '100%',\n+      display: 'flex',\n+      flexDirection: 'column',\n+      fontFamily: \"'Excalifont', 'Xiaolai', 'Georgia', serif\",\n+      background: '#f8f0e6',\n+      overflow: 'hidden'\n+    }}>\n+      {/* Tab Navigation */}\n+      <div style={{\n+        display: 'flex',\n+        gap: 16,\n+        padding: '24px 32px 0',\n+        borderBottom: '1px solid #d0c4b0'\n+      }}>\n+        <button\n+          onClick={() => setActiveTab('friends')}\n+          style={{\n+            padding: '12px 24px',\n+            border: 'none',\n+            background: 'transparent',\n+            fontSize: 15,\n+            fontWeight: activeTab === 'friends' ? 600 : 400,\n+            cursor: 'pointer',\n+            color: activeTab === 'friends' ? '#2c2c2c' : '#888',\n+            borderBottom: activeTab === 'friends' ? '3px solid #2c2c2c' : '3px solid transparent',\n+            transition: 'all 0.2s'\n+          }}\n+        >\n+          {t('friends.myFriends') || 'My Friends'} {friends.length > 0 && `(${friends.length})`}\n+        </button>\n+        <button\n+          onClick={() => setActiveTab('requests')}\n+          style={{\n+            padding: '12px 24px',\n+            border: 'none',\n+            background: 'transparent',\n+            fontSize: 15,\n+            fontWeight: activeTab === 'requests' ? 600 : 400,\n+            cursor: 'pointer',\n+            color: activeTab === 'requests' ? '#2c2c2c' : '#888',\n+            borderBottom: activeTab === 'requests' ? '3px solid #2c2c2c' : '3px solid transparent',\n+            transition: 'all 0.2s'\n+          }}\n+        >\n+          {t('friends.requests') || 'Requests'} {requests.length > 0 && `(${requests.length})`}\n+        </button>\n+        <button\n+          onClick={() => setActiveTab('invite')}\n+          style={{\n+            padding: '12px 24px',\n+            border: 'none',\n+            background: 'transparent',\n+            fontSize: 15,\n+            fontWeight: activeTab === 'invite' ? 600 : 400,\n+            cursor: 'pointer',\n+            color: activeTab === 'invite' ? '#2c2c2c' : '#888',\n+            borderBottom: activeTab === 'invite' ? '3px solid #2c2c2c' : '3px solid transparent',\n+            transition: 'all 0.2s'\n+          }}\n+        >\n+          {t('friends.addFriend') || 'Add Friend'}\n+        </button>\n+      </div>\n+\n+      {/* Content Area */}\n+      <div style={{\n+        flex: 1,\n+        overflow: 'auto',\n+        padding: 32\n+      }}>\n+        {/* Friends Tab */}\n+        {activeTab === 'friends' && (\n+          <div>\n+            <h2 style={{ fontSize: 24, marginBottom: 24, fontWeight: 600 }}>\n+              {t('friends.myFriends') || 'My Friends'}\n+            </h2>\n+\n+            {loadingFriends ? (\n+              <div style={{ textAlign: 'center', padding: 40, color: '#888' }}>\n+                {t('friends.loading') || 'Loading...'}\n+              </div>\n+            ) : friends.length === 0 ? (\n+              <div style={{\n+                textAlign: 'center',\n+                padding: 60,\n+                color: '#888',\n+                fontSize: 15\n+              }}>\n+                {t('friends.noFriends') || 'No friends yet. Use an invite code to add your first friend!'}\n+              </div>\n+            ) : (\n+              <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n+                {friends.map(friend => (\n+                  <div key={friend.id} style={{\n+                    background: '#fff',\n+                    border: '1px solid #d0c4b0',\n+                    borderRadius: 8,\n+                    padding: 20,\n+                    display: 'flex',\n+                    alignItems: 'center',\n+                    gap: 16\n+                  }}>\n+                    <div style={{\n+                      width: 48,\n+                      height: 48,\n+                      borderRadius: 24,\n+                      background: '#4CAF50',\n+                      display: 'flex',\n+                      alignItems: 'center',\n+                      justifyContent: 'center',\n+                      color: '#fff',\n+                      fontSize: 20,\n+                      fontWeight: 600\n+                    }}>\n+                      {friend.friend_name?.[0]?.toUpperCase() || friend.friend_email?.[0]?.toUpperCase() || 'F'}\n+                    </div>\n+                    <div style={{ flex: 1 }}>\n+                      <div style={{ fontWeight: 600, fontSize: 16, marginBottom: 4 }}>\n+                        {friend.friend_name}\n+                      </div>\n+                      <div style={{ fontSize: 13, color: '#666' }}>\n+                        {friend.friend_email}\n+                      </div>\n+                    </div>\n+                    <button\n+                      onClick={() => onViewFriendTimeline?.(friend.friend_id, friend.friend_name)}\n+                      style={{\n+                        padding: '8px 16px',\n+                        background: '#4CAF50',\n+                        color: '#fff',\n+                        border: 'none',\n+                        borderRadius: 6,\n+                        cursor: 'pointer',\n+                        fontSize: 14,\n+                        fontWeight: 500,\n+                        transition: 'background 0.2s'\n+                      }}\n+                      onMouseEnter={e => e.currentTarget.style.background = '#45a049'}\n+                      onMouseLeave={e => e.currentTarget.style.background = '#4CAF50'}\n+                    >\n+                      {t('friends.viewTimeline') || 'View Timeline'}\n+                    </button>\n+                    <button\n+                      onClick={() => handleRemoveFriend(friend.friend_id)}\n+                      style={{\n+                        padding: '8px 16px',\n+                        background: '#f44336',\n+                        color: '#fff',\n+                        border: 'none',\n+                        borderRadius: 6,\n+                        cursor: 'pointer',\n+                        fontSize: 14,\n+                        fontWeight: 500,\n+                        transition: 'background 0.2s'\n+                      }}\n+                      onMouseEnter={e => e.currentTarget.style.background = '#da190b'}\n+                      onMouseLeave={e => e.currentTarget.style.background = '#f44336'}\n+                    >\n+                      {t('friends.remove') || 'Remove'}\n+                    </button>\n+                  </div>\n+                ))}\n+              </div>\n+            )}\n+          </div>\n+        )}\n+\n+        {/* Requests Tab */}\n+        {activeTab === 'requests' && (\n+          <div>\n+            <h2 style={{ fontSize: 24, marginBottom: 24, fontWeight: 600 }}>\n+              {t('friends.requests') || 'Friend Requests'}\n+            </h2>\n+\n+            {loadingRequests ? (\n+              <div style={{ textAlign: 'center', padding: 40, color: '#888' }}>\n+                {t('friends.loading') || 'Loading...'}\n+              </div>\n+            ) : requests.length === 0 ? (\n+              <div style={{\n+                textAlign: 'center',\n+                padding: 60,\n+                color: '#888',\n+                fontSize: 15\n+              }}>\n+                {t('friends.noRequests') || 'No pending friend requests'}\n+              </div>\n+            ) : (\n+              <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n+                {requests.map(request => (\n+                  <div key={request.id} style={{\n+                    background: '#fff',\n+                    border: '1px solid #d0c4b0',\n+                    borderRadius: 8,\n+                    padding: 20,\n+                    display: 'flex',\n+                    alignItems: 'center',\n+                    gap: 16\n+                  }}>\n+                    <div style={{\n+                      width: 48,\n+                      height: 48,\n+                      borderRadius: 24,\n+                      background: '#2196F3',\n+                      display: 'flex',\n+                      alignItems: 'center',\n+                      justifyContent: 'center',\n+                      color: '#fff',\n+                      fontSize: 20,\n+                      fontWeight: 600\n+                    }}>\n+                      {request.requester_name?.[0]?.toUpperCase() || request.requester_email?.[0]?.toUpperCase() || 'R'}\n+                    </div>\n+                    <div style={{ flex: 1 }}>\n+                      <div style={{ fontWeight: 600, fontSize: 16, marginBottom: 4 }}>\n+                        {request.requester_name}\n+                      </div>\n+                      <div style={{ fontSize: 13, color: '#666' }}>\n+                        {request.requester_email}\n+                      </div>\n+                    </div>\n+                    <button\n+                      onClick={() => handleAcceptRequest(request.id)}\n+                      style={{\n+                        padding: '8px 16px',\n+                        background: '#4CAF50',\n+                        color: '#fff',\n+                        border: 'none',\n+                        borderRadius: 6,\n+                        cursor: 'pointer',\n+                        fontSize: 14,\n+                        fontWeight: 500,\n+                        transition: 'background 0.2s'\n+                      }}\n+                      onMouseEnter={e => e.currentTarget.style.background = '#45a049'}\n+                      onMouseLeave={e => e.currentTarget.style.background = '#4CAF50'}\n+                    >\n+                      {t('friends.accept') || 'Accept'}\n+                    </button>\n+                    <button\n+                      onClick={() => handleRejectRequest(request.id)}\n+                      style={{\n+                        padding: '8px 16px',\n+                        background: '#f44336',\n+                        color: '#fff',\n+                        border: 'none',\n+                        borderRadius: 6,\n+                        cursor: 'pointer',\n+                        fontSize: 14,\n+                        fontWeight: 500,\n+                        transition: 'background 0.2s'\n+                      }}\n+                      onMouseEnter={e => e.currentTarget.style.background = '#da190b'}\n+                      onMouseLeave={e => e.currentTarget.style.background = '#f44336'}\n+                    >\n+                      {t('friends.reject') || 'Reject'}\n+                    </button>\n+                  </div>\n+                ))}\n+              </div>\n+            )}\n+          </div>\n+        )}\n+\n+        {/* Invite Tab */}\n+        {activeTab === 'invite' && (\n+          <div>\n+            <h2 style={{ fontSize: 24, marginBottom: 24, fontWeight: 600 }}>\n+              {t('friends.addFriend') || 'Add Friend'}\n+            </h2>\n+\n+            {/* Generate Invite Code */}\n+            <div style={{\n+              background: '#fff',\n+              border: '1px solid #d0c4b0',\n+              borderRadius: 8,\n+              padding: 24,\n+              marginBottom: 32\n+            }}>\n+              <h3 style={{ fontSize: 18, marginBottom: 12, fontWeight: 600 }}>\n+                {t('friends.generateInvite') || 'Generate Invite Code'}\n+              </h3>\n+              <p style={{ fontSize: 14, color: '#666', marginBottom: 16 }}>\n+                {t('friends.generateHint') || 'Share this code with someone to let them send you a friend request. Code expires in 7 days.'}\n+              </p>\n+\n+              {inviteCode ? (\n+                <div>\n+                  <div style={{\n+                    background: '#f5f5f5',\n+                    padding: 16,\n+                    borderRadius: 6,\n+                    marginBottom: 12,\n+                    display: 'flex',\n+                    alignItems: 'center',\n+                    gap: 12\n+                  }}>\n+                    <div style={{\n+                      flex: 1,\n+                      fontSize: 24,\n+                      fontWeight: 700,\n+                      fontFamily: 'monospace',\n+                      letterSpacing: 4,\n+                      textAlign: 'center'\n+                    }}>\n+                      {inviteCode.code}\n+                    </div>\n+                    <button\n+                      onClick={handleCopyCode}\n+                      style={{\n+                        padding: '8px 16px',\n+                        background: '#2196F3',\n+                        color: '#fff',\n+                        border: 'none',\n+                        borderRadius: 6,\n+                        cursor: 'pointer',\n+                        fontSize: 14,\n+                        fontWeight: 500\n+                      }}\n+                    >\n+                      {t('friends.copy') || 'Copy'}\n+                    </button>\n+                  </div>\n+                  <div style={{ fontSize: 12, color: '#888' }}>\n+                    {t('friends.expiresAt') || 'Expires'}: {new Date(inviteCode.expires_at).toLocaleString()}\n+                  </div>\n+                </div>\n+              ) : (\n+                <button\n+                  onClick={handleGenerateInvite}\n+                  disabled={generatingInvite}\n+                  style={{\n+                    padding: '12px 24px',\n+                    background: generatingInvite ? '#ccc' : '#4CAF50',\n+                    color: '#fff',\n+                    border: 'none',\n+                    borderRadius: 6,\n+                    cursor: generatingInvite ? 'not-allowed' : 'pointer',\n+                    fontSize: 15,\n+                    fontWeight: 500\n+                  }}\n+                >\n+                  {generatingInvite ? (t('friends.generating') || 'Generating...') : (t('friends.generate') || 'Generate Code')}\n+                </button>\n+              )}\n+            </div>\n+\n+            {/* Use Invite Code */}\n+            <div style={{\n+              background: '#fff',\n+              border: '1px solid #d0c4b0',\n+              borderRadius: 8,\n+              padding: 24\n+            }}>\n+              <h3 style={{ fontSize: 18, marginBottom: 12, fontWeight: 600 }}>\n+                {t('friends.useInvite') || 'Use Invite Code'}\n+              </h3>\n+              <p style={{ fontSize: 14, color: '#666', marginBottom: 16 }}>\n+                {t('friends.useHint') || 'Enter a friend\\'s invite code to send them a friend request.'}\n+              </p>\n+\n+              <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>\n+                <input\n+                  type=\"text\"\n+                  value={inputCode}\n+                  onChange={e => setInputCode(e.target.value.toUpperCase())}\n+                  placeholder={t('friends.codePlaceholder') || 'Enter 6-character code'}\n+                  maxLength={6}\n+                  style={{\n+                    flex: 1,\n+                    padding: '12px 16px',\n+                    border: '1px solid #d0c4b0',\n+                    borderRadius: 6,\n+                    fontSize: 16,\n+                    fontFamily: 'monospace',\n+                    letterSpacing: 2,\n+                    textTransform: 'uppercase'\n+                  }}\n+                />\n+                <button\n+                  onClick={handleUseCode}\n+                  disabled={usingCode || inputCode.length !== 6}\n+                  style={{\n+                    padding: '12px 24px',\n+                    background: (usingCode || inputCode.length !== 6) ? '#ccc' : '#2196F3',\n+                    color: '#fff',\n+                    border: 'none',\n+                    borderRadius: 6,\n+                    cursor: (usingCode || inputCode.length !== 6) ? 'not-allowed' : 'pointer',\n+                    fontSize: 15,\n+                    fontWeight: 500\n+                  }}\n+                >\n+                  {usingCode ? (t('friends.sending') || 'Sending...') : (t('friends.send') || 'Send Request')}\n+                </button>\n+              </div>\n+\n+              {codeMessage && (\n+                <div style={{\n+                  marginTop: 12,\n+                  padding: 12,\n+                  background: codeMessage.includes('sent') || codeMessage.includes('成功') ? '#e8f5e9' : '#ffebee',\n+                  color: codeMessage.includes('sent') || codeMessage.includes('成功') ? '#2e7d32' : '#c62828',\n+                  borderRadius: 6,\n+                  fontSize: 14\n+                }}>\n+                  {codeMessage}\n+                </div>\n+              )}\n+            </div>\n+          </div>\n+        )}\n+      </div>\n+    </div>\n+  );\n+}"
    },
    {
      "sha": "245e7e5c987bf6e5821822669a726c37d821ff11",
      "filename": "frontend/src/components/TopNavBar.tsx",
      "status": "modified",
      "additions": 20,
      "deletions": 2,
      "changes": 22,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fcomponents%2FTopNavBar.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fcomponents%2FTopNavBar.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FTopNavBar.tsx?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -3,8 +3,8 @@ import { useTranslation } from 'react-i18next';\n import { useAuth } from '../contexts/AuthContext';\n \n interface Props {\n-  currentView: 'writing' | 'settings' | 'timeline' | 'analysis' | 'decks';\n-  onViewChange: (view: 'writing' | 'settings' | 'timeline' | 'analysis' | 'decks') => void;\n+  currentView: 'writing' | 'settings' | 'timeline' | 'analysis' | 'decks' | 'friends';\n+  onViewChange: (view: 'writing' | 'settings' | 'timeline' | 'analysis' | 'decks' | 'friends') => void;\n }\n \n export default function LeftSidebar({ currentView, onViewChange }: Props) {\n@@ -152,6 +152,24 @@ export default function LeftSidebar({ currentView, onViewChange }: Props) {\n         >\n           {t('nav.decks')}\n         </button>\n+\n+        <button\n+          onClick={() => onViewChange('friends')}\n+          style={buttonStyle(currentView === 'friends')}\n+          title={t('nav.friends')}\n+          onMouseEnter={e => {\n+            if (currentView !== 'friends') {\n+              e.currentTarget.style.background = 'rgba(44, 44, 44, 0.04)';\n+            }\n+          }}\n+          onMouseLeave={e => {\n+            if (currentView !== 'friends') {\n+              e.currentTarget.style.background = 'transparent';\n+            }\n+          }}\n+        >\n+          {t('nav.friends') || 'Friends'}\n+        </button>\n       </div>\n \n       <div style={{ flex: 1 }} />"
    },
    {
      "sha": "7d9fe859046b7e9a11be3cc5eb7fe40e4da2fbf7",
      "filename": "frontend/src/i18n.ts",
      "status": "modified",
      "additions": 88,
      "deletions": 0,
      "changes": 88,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fi18n.ts",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/bdbc7cdbfae2d62b29c8e2bf71145a01841e973c/frontend%2Fsrc%2Fi18n.ts",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fi18n.ts?ref=bdbc7cdbfae2d62b29c8e2bf71145a01841e973c",
      "patch": "@@ -11,6 +11,7 @@ const resources = {\n         timeline: 'Timeline',\n         analysis: 'Reflections',\n         decks: 'Decks',\n+        friends: 'Friends',\n         settings: 'Settings'\n       },\n       settings: {\n@@ -106,6 +107,18 @@ const resources = {\n         confirm: {\n           delete: 'Delete this deck and all its voices?',\n           sync: 'Sync with original template? This will overwrite any changes you made to this deck.'\n+        },\n+        publishWarning: {\n+          heading: '⚠️ Publish Deck Warning',\n+          body: 'Publishing will <strong>break the parent link</strong>. This deck becomes a standalone deck in the community store.',\n+          note: 'This action cannot be undone. Even if you unpublish later, the parent link stays broken.',\n+          cancel: 'Cancel',\n+          confirm: 'Publish Anyway'\n+        },\n+        messages: {\n+          publishSuccess: '✅ Deck published to community!',\n+          unpublishSuccess: '✅ Deck unpublished',\n+          installSuccess: '✅ Deck installed to your collection!'\n         }\n       },\n       timeline: {\n@@ -142,6 +155,37 @@ const resources = {\n         noEntriesForDate: 'No entries for this date',\n         todayLabel: 'Today',\n         deleteError: 'Failed to delete entry'\n+      },\n+      friends: {\n+        myFriends: 'My Friends',\n+        requests: 'Requests',\n+        addFriend: 'Add Friend',\n+        noFriends: 'No friends yet. Use an invite code to add your first friend!',\n+        noRequests: 'No pending friend requests',\n+        loading: 'Loading...',\n+        viewTimeline: 'View Timeline',\n+        remove: 'Remove',\n+        accept: 'Accept',\n+        reject: 'Reject',\n+        generateInvite: 'Generate Invite Code',\n+        generateHint: 'Share this code with someone to let them send you a friend request. Code expires in 7 days.',\n+        generate: 'Generate Code',\n+        generating: 'Generating...',\n+        copy: 'Copy',\n+        codeCopied: 'Code copied to clipboard!',\n+        expiresAt: 'Expires',\n+        useInvite: 'Use Invite Code',\n+        useHint: 'Enter a friend\\'s invite code to send them a friend request.',\n+        codePlaceholder: 'Enter 6-character code',\n+        send: 'Send Request',\n+        sending: 'Sending...',\n+        requestSent: 'Friend request sent!',\n+        confirmRemove: 'Remove this friend?',\n+        generateError: 'Failed to generate invite code',\n+        useCodeError: 'Invalid or expired code',\n+        acceptError: 'Failed to accept request',\n+        rejectError: 'Failed to reject request',\n+        removeError: 'Failed to remove friend'\n       }\n     }\n   },\n@@ -152,6 +196,7 @@ const resources = {\n         timeline: '时间线',\n         analysis: '回顾',\n         decks: '卡组',\n+        friends: '好友',\n         settings: '设置'\n       },\n       settings: {\n@@ -247,6 +292,18 @@ const resources = {\n         confirm: {\n           delete: '确定删除这个卡组以及所有声线？',\n           sync: '与原模板同步？这会覆盖你在卡组里的修改。'\n+        },\n+        publishWarning: {\n+          heading: '⚠️ 发布提醒',\n+          body: '发布后会<strong>断开与父卡组的链接</strong>，并在社区中以独立卡组存在。',\n+          note: '此操作不可逆，就算之后取消发布，父子链接也无法恢复。',\n+          cancel: '取消',\n+          confirm: '仍要发布'\n+        },\n+        messages: {\n+          publishSuccess: '✅ 已发布到社区！',\n+          unpublishSuccess: '✅ 已取消发布',\n+          installSuccess: '✅ 已安装到你的卡组'\n         }\n       },\n       timeline: {\n@@ -283,6 +340,37 @@ const resources = {\n         noEntriesForDate: '这一天暂无记录',\n         todayLabel: '今天',\n         deleteError: '删除失败'\n+      },\n+      friends: {\n+        myFriends: '我的好友',\n+        requests: '好友申请',\n+        addFriend: '添加好友',\n+        noFriends: '还没有好友。使用邀请码添加你的第一个好友吧！',\n+        noRequests: '暂无待处理的好友申请',\n+        loading: '加载中...',\n+        viewTimeline: '查看时间线',\n+        remove: '移除',\n+        accept: '接受',\n+        reject: '拒绝',\n+        generateInvite: '生成邀请码',\n+        generateHint: '将此邀请码分享给朋友，让对方向你发送好友申请。邀请码 7 天后过期。',\n+        generate: '生成邀请码',\n+        generating: '生成中...',\n+        copy: '复制',\n+        codeCopied: '邀请码已复制到剪贴板！',\n+        expiresAt: '过期时间',\n+        useInvite: '使用邀请码',\n+        useHint: '输入朋友的邀请码，向对方发送好友申请。',\n+        codePlaceholder: '输入 6 位邀请码',\n+        send: '发送申请',\n+        sending: '发送中...',\n+        requestSent: '好友申请已发送！',\n+        confirmRemove: '确定要移除这位好友吗？',\n+        generateError: '生成邀请码失败',\n+        useCodeError: '邀请码无效或已过期',\n+        acceptError: '接受申请失败',\n+        rejectError: '拒绝申请失败',\n+        removeError: '移除好友失败'\n       }\n     }\n   }"
    }
  ]
}