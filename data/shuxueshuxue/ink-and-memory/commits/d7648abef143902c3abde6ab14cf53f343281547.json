{
  "sha": "d7648abef143902c3abde6ab14cf53f343281547",
  "node_id": "C_kwDOP2Zrm9oAKGQ3NjQ4YWJlZjE0MzkwMmMzYWJkZTZhYjE0Y2Y1M2YzNDMyODE1NDc",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-20T09:39:31Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-20T09:39:31Z"
    },
    "message": "UI adjustment",
    "tree": {
      "sha": "7d21ab730237480c756d56067b5f204c210309fd",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/7d21ab730237480c756d56067b5f204c210309fd"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/d7648abef143902c3abde6ab14cf53f343281547",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/d7648abef143902c3abde6ab14cf53f343281547",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/d7648abef143902c3abde6ab14cf53f343281547",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/d7648abef143902c3abde6ab14cf53f343281547/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "d174b45cd7e94458f9251a2993e479e54188a260",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/d174b45cd7e94458f9251a2993e479e54188a260",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/d174b45cd7e94458f9251a2993e479e54188a260"
    }
  ],
  "stats": {
    "total": 375,
    "additions": 320,
    "deletions": 55
  },
  "files": [
    {
      "sha": "9fd657cb3e53cde9011271de3d98a43babc7382f",
      "filename": "frontend/src/App.tsx",
      "status": "modified",
      "additions": 51,
      "deletions": 3,
      "changes": 54,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2FApp.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2FApp.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2FApp.tsx?ref=d7648abef143902c3abde6ab14cf53f343281547",
      "patch": "@@ -248,8 +248,9 @@ export default function App() {\n     }\n   }, [currentLanguage, i18n]);\n \n-  const [currentView, setCurrentView] = useState<'writing' | 'settings' | 'timeline' | 'analysis' | 'decks'>('writing');\n+  const [currentView, setCurrentView] = useState<'writing' | 'settings' | 'timeline' | 'analysis' | 'decks' | 'friends'>('writing');\n   const [showCalendarPopup, setShowCalendarPopup] = useState(false);\n+  const [timelineFriendToSelect, setTimelineFriendToSelect] = useState<number | null>(null);\n   const [voiceConfigs, setVoiceConfigs] = useState<Record<string, VoiceConfig>>({});\n \n   const engineRef = useRef<EditorEngine | null>(null);\n@@ -638,6 +639,35 @@ export default function App() {\n     }\n   }, [state, composingCells]);\n \n+  // @@@ Keep focus on the lone blank text cell (after resets / clears)\n+  useEffect(() => {\n+    if (!state) return;\n+\n+    const textCells = state.cells.filter(c => c.type === 'text') as TextCell[];\n+    if (textCells.length !== 1) return;\n+\n+    const firstCell = textCells[0];\n+    if (firstCell.content.trim().length > 0) return;\n+\n+    const focusEditor = () => {\n+      const textarea = textareaRefs.current.get(firstCell.id);\n+      if (textarea && document.activeElement !== textarea) {\n+        textarea.focus();\n+        textarea.selectionStart = 0;\n+        textarea.selectionEnd = 0;\n+      }\n+    };\n+\n+    const textarea = textareaRefs.current.get(firstCell.id);\n+    if (textarea) {\n+      focusEditor();\n+      return;\n+    }\n+\n+    const timer = window.setTimeout(focusEditor, 0);\n+    return () => window.clearTimeout(timer);\n+  }, [state, refsReady]);\n+\n   // @@@ Auto-save to database for authenticated users\n   useEffect(() => {\n     if (!isAuthenticated || !state) return;\n@@ -1212,6 +1242,15 @@ export default function App() {\n     }\n   }, []);\n \n+  const handleViewFriendTimeline = useCallback((friendId: number, _friendName?: string) => {\n+    setTimelineFriendToSelect(friendId);\n+    setCurrentView('timeline');\n+  }, []);\n+\n+  const handleFriendSelectionHandled = useCallback(() => {\n+    setTimelineFriendToSelect(null);\n+  }, []);\n+\n   const handleStateChoose = useCallback(async (stateId: string) => {\n     setSelectedState(stateId);\n     const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n@@ -2412,7 +2451,12 @@ export default function App() {\n         display: currentView === 'timeline' ? 'flex' : 'none',\n         overflow: 'hidden'\n       }}>\n-        <CollectionsView isVisible={currentView === 'timeline'} voiceConfigs={voiceConfigs} />\n+        <CollectionsView\n+          isVisible={currentView === 'timeline'}\n+          voiceConfigs={voiceConfigs}\n+          friendToSelect={timelineFriendToSelect}\n+          onFriendSelectionHandled={handleFriendSelectionHandled}\n+        />\n       </div>\n       {currentView === 'analysis' && (\n         <div style={{\n@@ -2440,7 +2484,10 @@ export default function App() {\n           display: 'flex',\n           overflow: 'hidden'\n         }}>\n-          <FriendsView isVisible={currentView === 'friends'} />\n+          <FriendsView\n+            isVisible={currentView === 'friends'}\n+            onViewFriendTimeline={handleViewFriendTimeline}\n+          />\n         </div>\n       )}\n \n@@ -2542,6 +2589,7 @@ export default function App() {\n       {showCalendarPopup && (\n         <CalendarPopup\n           onLoadEntry={handleLoadEntry}\n+          currentEntryId={state.currentEntryId}\n           onClose={() => setShowCalendarPopup(false)}\n         />\n       )}"
    },
    {
      "sha": "8660a416304e952efed8e2a1795c395b7138edae",
      "filename": "frontend/src/components/CalendarPopup.tsx",
      "status": "modified",
      "additions": 31,
      "deletions": 7,
      "changes": 38,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fcomponents%2FCalendarPopup.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fcomponents%2FCalendarPopup.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FCalendarPopup.tsx?ref=d7648abef143902c3abde6ab14cf53f343281547",
      "patch": "@@ -13,9 +13,10 @@ import { useAuth } from '../contexts/AuthContext';\n interface Props {\n   onLoadEntry: (entry: CalendarEntry) => void;\n   onClose: () => void;\n+  currentEntryId?: string | null;\n }\n \n-export default function CalendarPopup({ onLoadEntry, onClose }: Props) {\n+export default function CalendarPopup({ onLoadEntry, onClose, currentEntryId }: Props) {\n   const { isAuthenticated } = useAuth();\n   const { t, i18n } = useTranslation();\n   const dateLocale = getDateLocale(i18n.language);\n@@ -402,6 +403,7 @@ export default function CalendarPopup({ onLoadEntry, onClose }: Props) {\n                   overflow: 'auto'\n                 }}>\n                   {selectedEntries.map((entry) => {\n+                    const isCurrentEntry = currentEntryId === entry.id;\n                     const time = new Date(entry.timestamp).toLocaleTimeString(dateLocale, {\n                       hour: '2-digit',\n                       minute: '2-digit'\n@@ -411,14 +413,15 @@ export default function CalendarPopup({ onLoadEntry, onClose }: Props) {\n                       <div\n                         key={entry.id}\n                         style={{\n-                          border: '1px solid #d0c4b0',\n+                          border: isCurrentEntry ? '2px solid #4CAF50' : '1px solid #d0c4b0',\n                           borderRadius: '6px',\n                           padding: '12px',\n-                          background: '#fff',\n+                          background: isCurrentEntry ? '#f0fff4' : '#fff',\n                           display: 'flex',\n                           justifyContent: 'space-between',\n                           alignItems: 'center',\n-                          gap: '12px'\n+                          gap: '12px',\n+                          boxShadow: isCurrentEntry ? '0 0 0 1px rgba(76, 175, 80, 0.1)' : 'none'\n                         }}\n                       >\n                         <button\n@@ -435,11 +438,32 @@ export default function CalendarPopup({ onLoadEntry, onClose }: Props) {\n                           }}\n                         >\n                           <div style={{\n-                            fontSize: '12px',\n-                            color: '#999',\n+                            display: 'flex',\n+                            alignItems: 'center',\n+                            gap: '8px',\n                             marginBottom: '4px'\n                           }}>\n-                            {time}\n+                            <div style={{\n+                              fontSize: '12px',\n+                              color: '#999'\n+                            }}>\n+                              {time}\n+                            </div>\n+                            {isCurrentEntry && (\n+                              <span style={{\n+                                fontSize: '11px',\n+                                letterSpacing: '0.05em',\n+                                textTransform: 'uppercase',\n+                                padding: '2px 6px',\n+                                borderRadius: '999px',\n+                                border: '1px solid #4CAF50',\n+                                color: '#256029',\n+                                background: '#e8f5e9',\n+                                fontWeight: 600\n+                              }}>\n+                                {t('calendar.currentEntryLabel')}\n+                              </span>\n+                            )}\n                           </div>\n                           <div style={{\n                             fontSize: '14px',"
    },
    {
      "sha": "8006ea1a551129a104c2601c94169035c23bc431",
      "filename": "frontend/src/components/CollectionsView.tsx",
      "status": "modified",
      "additions": 158,
      "deletions": 39,
      "changes": 197,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fcomponents%2FCollectionsView.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fcomponents%2FCollectionsView.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FCollectionsView.tsx?ref=d7648abef143902c3abde6ab14cf53f343281547",
      "patch": "@@ -1,4 +1,4 @@\n-import { useState, useEffect, useLayoutEffect, useRef, useMemo } from 'react';\n+import { useState, useEffect, useLayoutEffect, useRef, useMemo, useCallback } from 'react';\n import { useTranslation } from 'react-i18next';\n import type { Commentor } from '../engine/EditorEngine';\n import { findNormalizedPhrase } from '../utils/textNormalize';\n@@ -28,7 +28,14 @@ interface TimelineEntryData {\n   comments: Commentor[];\n }\n \n-export default function CollectionsView({ isVisible, voiceConfigs }: { isVisible: boolean; voiceConfigs: Record<string, any> }) {\n+interface CollectionsViewProps {\n+  isVisible: boolean;\n+  voiceConfigs: Record<string, any>;\n+  friendToSelect?: number | null;\n+  onFriendSelectionHandled?: () => void;\n+}\n+\n+export default function CollectionsView({ isVisible, voiceConfigs, friendToSelect, onFriendSelectionHandled }: CollectionsViewProps) {\n   const { i18n } = useTranslation();\n   const dateLocale = getDateLocale(i18n.language);\n   return (\n@@ -40,7 +47,13 @@ export default function CollectionsView({ isVisible, voiceConfigs }: { isVisible\n       background: '#f8f0e6',\n       overflow: 'hidden'\n     }}>\n-      <TimelinePage isVisible={isVisible} voiceConfigs={voiceConfigs} dateLocale={dateLocale} />\n+      <TimelinePage\n+        isVisible={isVisible}\n+        voiceConfigs={voiceConfigs}\n+        dateLocale={dateLocale}\n+        friendToSelect={friendToSelect}\n+        onFriendSelectionHandled={onFriendSelectionHandled}\n+      />\n     </div>\n   );\n }\n@@ -429,7 +442,15 @@ const getInitialLetter = (name?: string, fallback: string = '?') => {\n   return first || fallback;\n };\n \n-function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: boolean; voiceConfigs: Record<string, any>; dateLocale: string }) {\n+interface TimelinePageProps {\n+  isVisible: boolean;\n+  voiceConfigs: Record<string, any>;\n+  dateLocale: string;\n+  friendToSelect?: number | null;\n+  onFriendSelectionHandled?: () => void;\n+}\n+\n+function TimelinePage({ isVisible, voiceConfigs, dateLocale, friendToSelect, onFriendSelectionHandled }: TimelinePageProps) {\n   const { t } = useTranslation();\n   const { isAuthenticated } = useAuth();\n   const [starredComments, setStarredComments] = useState<Commentor[]>([]);\n@@ -465,12 +486,13 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n   const [isFriendPickerOpen, setIsFriendPickerOpen] = useState(false);\n   const [friendSearchTerm, setFriendSearchTerm] = useState('');\n   const [friendPictures, setFriendPictures] = useState<TimelinePicture[]>([]);\n-  const [loadingFriends, setLoadingFriends] = useState(false);\n+  const [, setLoadingFriends] = useState(false);\n   const [friendLoadError, setFriendLoadError] = useState<string | null>(null);\n-  const [friendTimelineError, setFriendTimelineError] = useState<string | null>(null);\n-  const [loadingFriendTimeline, setLoadingFriendTimeline] = useState(false);\n+  const [, setFriendTimelineError] = useState<string | null>(null);\n+  const [, setLoadingFriendTimeline] = useState(false);\n   const scrollContainerRef = useRef<HTMLDivElement | null>(null);\n   const emptyTextMap = useMemo(() => new Map<string, string>(), []);\n+  const allTimelineDays = useMemo(() => generateTimelineDays(), []);\n   const filteredFriends = useMemo(() => {\n     const term = friendSearchTerm.trim().toLowerCase();\n     if (!term) return friends;\n@@ -484,10 +506,14 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n       prev.filter(id => friends.some(friend => friend.friend_id === id))\n     );\n   }, [friends]);\n-  const selectedFriend = useMemo(\n-    () => friends.find(friend => friend.friend_id === selectedFriendId),\n-    [friends, selectedFriendId]\n-  );\n+\n+  // @@@ Reset friend selection when auth state changes (guests can't view friends)\n+  useEffect(() => {\n+    if (!isAuthenticated) {\n+      setSelectedFriendId(null);\n+      localStorage.removeItem(STORAGE_KEYS.SELECTED_FRIEND);\n+    }\n+  }, [isAuthenticated]);\n   useEffect(() => {\n     if (typeof window === 'undefined') return;\n     localStorage.setItem(STORAGE_KEYS.RECENT_FRIENDS, JSON.stringify(recentFriendIds));\n@@ -498,12 +524,26 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n     return map;\n   }, [friends]);\n   const orderedFriendIds = useMemo(() => {\n-    const ids = recentFriendIds.filter(id => friendMap.has(id));\n-    if (selectedFriendId && friendMap.has(selectedFriendId)) {\n-      return [selectedFriendId, ...ids.filter(id => id !== selectedFriendId)].slice(0, MAX_RECENT_FRIENDS);\n+    const recentValid = recentFriendIds.filter(id => friendMap.has(id));\n+    const prioritized = selectedFriendId && friendMap.has(selectedFriendId)\n+      ? [selectedFriendId, ...recentValid.filter(id => id !== selectedFriendId)]\n+      : [...recentValid];\n+\n+    if (prioritized.length < MAX_RECENT_FRIENDS) {\n+      for (const friend of friends) {\n+        if (!friendMap.has(friend.friend_id)) continue;\n+        if (!prioritized.includes(friend.friend_id)) {\n+          prioritized.push(friend.friend_id);\n+        }\n+        if (prioritized.length >= MAX_RECENT_FRIENDS) {\n+          break;\n+        }\n+      }\n     }\n-    return ids.slice(0, MAX_RECENT_FRIENDS);\n-  }, [recentFriendIds, selectedFriendId, friendMap]);\n+\n+    return prioritized.slice(0, MAX_RECENT_FRIENDS);\n+  }, [recentFriendIds, selectedFriendId, friendMap, friends]);\n+  const selectedFriend = selectedFriendId ? friendMap.get(selectedFriendId) : null;\n   const orderedRecentFriends = orderedFriendIds\n     .map(id => friendMap.get(id))\n     .filter((friend): friend is Friend => Boolean(friend));\n@@ -757,26 +797,26 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n   // @@@ Set initial scroll position to show today's row at top\n   // Use useLayoutEffect to position BEFORE browser paints (prevents flash)\n   useLayoutEffect(() => {\n-    // @@@ Only scroll when timeline is visible AND data has loaded\n-    if (!isVisible || initialLoading) return;\n+    if (!isVisible || initialLoading || !scrollContainerRef.current) return;\n+\n+    const container = scrollContainerRef.current;\n+    const todayIndex = allTimelineDays.findIndex(day => day.isToday);\n+    if (todayIndex === -1) return;\n \n-    // Double RAF to ensure layout is complete\n     requestAnimationFrame(() => {\n       requestAnimationFrame(() => {\n-        if (scrollContainerRef.current) {\n-          // Today is at index 7 (after 7 past days)\n-          // Each row is roughly 98px (80px card + 1.5rem gap ~= 24px)\n-          const todayIndex = 7;\n-          const rowHeight = 98; // Approximate height of row + gap\n-          const topPadding = 48; // 3rem top padding\n-\n-          // Scroll to today's row\n-          const scrollTop = topPadding + (todayIndex * rowHeight);\n-          scrollContainerRef.current.scrollTop = scrollTop;\n+        const rows = container.querySelectorAll('[data-timeline-row]');\n+        const todayRow = rows[todayIndex] as HTMLElement | undefined;\n+        if (todayRow) {\n+          const containerRect = container.getBoundingClientRect();\n+          const todayRect = todayRow.getBoundingClientRect();\n+          const offset = todayRect.top - containerRect.top;\n+          const centerAdjustment = (container.clientHeight / 2) - (todayRect.height / 2);\n+          container.scrollTop += offset - centerAdjustment;\n         }\n       });\n     });\n-  }, [isVisible, initialLoading]);\n+  }, [isVisible, initialLoading, allTimelineDays]);\n \n   // @@@ Reload comments for a specific date from backend\n   const reloadCommentsForDate = async (dateStr: string) => {\n@@ -865,7 +905,7 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n     }\n   };\n \n-  const handleFriendSelection = (friendId: number | null) => {\n+  const handleFriendSelection = useCallback((friendId: number | null) => {\n     setSelectedFriendId(friendId);\n     if (typeof window !== 'undefined') {\n       if (friendId) {\n@@ -882,7 +922,21 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n     }\n     setFriendSearchTerm('');\n     setIsFriendPickerOpen(false);\n-  };\n+  }, []);\n+\n+  useEffect(() => {\n+    if (friendToSelect === undefined || friendToSelect === null) {\n+      return;\n+    }\n+\n+    if (friendToSelect === selectedFriendId) {\n+      onFriendSelectionHandled?.();\n+      return;\n+    }\n+\n+    handleFriendSelection(friendToSelect);\n+    onFriendSelectionHandled?.();\n+  }, [friendToSelect, selectedFriendId, handleFriendSelection, onFriendSelectionHandled]);\n \n   const handleGenerateForDate = async (dateStr: string) => {\n     // @@@ Block image generation for guests\n@@ -933,9 +987,6 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n     return null;\n   }\n \n-  // @@@ Generate all timeline days using helper function (always show timeline structure)\n-  const allTimelineDays = generateTimelineDays();\n-\n   return (\n     <div\n       ref={scrollContainerRef}\n@@ -952,7 +1003,8 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n       <div style={{\n         position: 'fixed',\n         right: '1rem',\n-        top: '160px',\n+        top: '50%',\n+        transform: 'translateY(-50%)',\n         display: 'flex',\n         flexDirection: 'column',\n         gap: '0.4rem',\n@@ -1022,6 +1074,70 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n         </button>\n       </div>\n \n+      {!selectedFriendId && !isFriendPickerOpen && (\n+        <div style={{\n+          position: 'fixed',\n+          right: '6.5rem',\n+          top: '50%',\n+          transform: 'translateY(-50%)',\n+          width: '260px',\n+          borderRadius: '16px',\n+          border: '1px solid #d0c4b0',\n+          background: '#fffefb',\n+          padding: '1.5rem',\n+          boxShadow: '0 20px 60px rgba(0,0,0,0.18)',\n+          zIndex: 3\n+        }}>\n+          <div style={{\n+            fontSize: '15px',\n+            fontWeight: 600,\n+            color: '#3d342a',\n+            marginBottom: '0.75rem'\n+          }}>\n+            {t('timeline.friendSelector.selfOnlyTitle') || 'Your private timeline'}\n+          </div>\n+          <div style={{\n+            fontSize: '13px',\n+            color: '#5c5145',\n+            lineHeight: 1.5\n+          }}>\n+            {t('timeline.friendSelector.selfOnlyHint') || 'Pick a friend from the badges on the right to compare timelines side by side.'}\n+          </div>\n+        </div>\n+      )}\n+\n+      {selectedFriendId && !isFriendPickerOpen && friendPictures.length === 0 && (\n+        <div style={{\n+          position: 'fixed',\n+          right: '6.5rem',\n+          top: '50%',\n+          transform: 'translateY(-50%)',\n+          width: '260px',\n+          borderRadius: '16px',\n+          border: '1px solid #d0c4b0',\n+          background: '#fffefb',\n+          padding: '1.5rem',\n+          boxShadow: '0 20px 60px rgba(0,0,0,0.18)',\n+          zIndex: 3\n+        }}>\n+          <div style={{\n+            fontSize: '15px',\n+            fontWeight: 600,\n+            color: '#3d342a',\n+            marginBottom: '0.75rem'\n+          }}>\n+            {t('timeline.friendSelector.friendEmptyTitle') || 'No friend timeline yet'}\n+          </div>\n+          <div style={{\n+            fontSize: '13px',\n+            color: '#5c5145',\n+            lineHeight: 1.5\n+          }}>\n+            {t('timeline.friendSelector.friendEmptyHint', { name: selectedFriend?.friend_name || '' }) || 'They have not shared anything for these days yet.'}\n+          </div>\n+        </div>\n+      )}\n+\n       {isFriendPickerOpen && (\n         <div\n           style={{\n@@ -1093,12 +1209,14 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n                 onClick={() => handleFriendSelection(null)}\n                 style={{\n                   flex: 1,\n-                  border: '1px solid #c7b9a4',\n-                  background: '#f8f0e6',\n+                  border: selectedFriendId === null ? '1px solid #2c2c2c' : '1px solid #c7b9a4',\n+                  background: selectedFriendId === null ? '#f0e8de' : '#fff',\n                   borderRadius: '8px',\n                   padding: '0.6rem 0.75rem',\n                   fontSize: '13px',\n-                  cursor: 'pointer'\n+                  cursor: 'pointer',\n+                  color: '#2c2c2c',\n+                  fontWeight: 600\n                 }}\n               >\n                 {t('timeline.friendSelector.none')}\n@@ -1165,6 +1283,7 @@ function TimelinePage({ isVisible, voiceConfigs, dateLocale }: { isVisible: bool\n \n           return (\n             <div\n+              data-timeline-row\n               key={day.date}\n               style={{\n                 position: 'relative',"
    },
    {
      "sha": "10fb3e74f2ef2a4348ecf03b1971eddcbd013b61",
      "filename": "frontend/src/components/DeckManager.tsx",
      "status": "modified",
      "additions": 27,
      "deletions": 3,
      "changes": 30,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx?ref=d7648abef143902c3abde6ab14cf53f343281547",
      "patch": "@@ -1,4 +1,4 @@\n-import { useState, useEffect, useRef } from 'react';\n+import { useMemo, useState, useEffect, useRef } from 'react';\n import { createPortal } from 'react-dom';\n import { useTranslation } from 'react-i18next';\n import {\n@@ -53,6 +53,9 @@ interface Props {\n \n export default function DeckManager({ onUpdate }: Props) {\n   const { t } = useTranslation();\n+  const spinnerKeyframes = useMemo(() => (\n+    `@keyframes deck-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`\n+  ), []);\n   const [decks, setDecks] = useState<Deck[]>([]);\n   const [communityDecks, setCommunityDecks] = useState<Deck[]>([]);\n   const [expandedDecks, setExpandedDecks] = useState<Set<string>>(new Set());\n@@ -304,12 +307,33 @@ export default function DeckManager({ onUpdate }: Props) {\n     return (\n       <div style={{\n         display: 'flex',\n+        flexDirection: 'column',\n         alignItems: 'center',\n         justifyContent: 'center',\n-        height: '100vh',\n+        width: '100%',\n+        minHeight: '100vh',\n         background: '#f8f0e6'\n       }}>\n-        <div style={{ fontSize: 18, color: '#666' }}>Loading decks...</div>\n+        <style>{spinnerKeyframes}</style>\n+        <div style={{\n+          fontSize: 18,\n+          color: '#666',\n+          display: 'flex',\n+          alignItems: 'center',\n+          justifyContent: 'center',\n+          gap: '0.75rem',\n+          textAlign: 'center'\n+        }}>\n+          <span style={{\n+            width: '18px',\n+            height: '18px',\n+            borderRadius: '50%',\n+            border: '2px solid rgba(0,0,0,0.1)',\n+            borderTopColor: '#666',\n+            animation: 'deck-spin 0.9s linear infinite'\n+          }} />\n+          Loading decks…\n+        </div>\n       </div>\n     );\n   }"
    },
    {
      "sha": "2bd3d48fe3816438e1a300eb32eacd941d84dfae",
      "filename": "frontend/src/engine/EditorEngine.ts",
      "status": "modified",
      "additions": 41,
      "deletions": 1,
      "changes": 42,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fengine%2FEditorEngine.ts",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fengine%2FEditorEngine.ts",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fengine%2FEditorEngine.ts?ref=d7648abef143902c3abde6ab14cf53f343281547",
      "patch": "@@ -155,6 +155,12 @@ export class EditorEngine {\n   private applyTextUpdate() {\n     const combinedText = this.getCombinedText();\n \n+    // @@@ Auto-reset when editor is cleared (no widgets + empty text cells)\n+    if (this.shouldResetEditorState(combinedText)) {\n+      this.resetEditorToBlank();\n+      return;\n+    }\n+\n     // Compute new weight entry\n     const weight = computeWeight(combinedText);\n     const lastEntry = this.state.weightPath[this.state.weightPath.length - 1];\n@@ -200,6 +206,40 @@ export class EditorEngine {\n       .join('');\n   }\n \n+  // @@@ Detect when all text cells are empty and no other cells remain\n+  private shouldResetEditorState(combinedText: string): boolean {\n+    const hasNonTextCells = this.state.cells.some(cell => cell.type !== 'text');\n+    if (hasNonTextCells) {\n+      return false;\n+    }\n+\n+    return combinedText.trim().length === 0;\n+  }\n+\n+  // @@@ Restore editor to pristine state while preserving session metadata\n+  private resetEditorToBlank() {\n+    const { sessionId, currentEntryId, selectedState, createdAt } = this.state;\n+\n+    this.state = {\n+      cells: [{ id: generateId(), type: 'text', content: '' }],\n+      commentors: [],\n+      tasks: [],\n+      weightPath: [],\n+      overlappedPhrases: [],\n+      sessionId,\n+      currentEntryId,\n+      selectedState,\n+      createdAt\n+    };\n+\n+    this.usedEnergy = 0;\n+    this.commentorWaitlist = [];\n+    this.sentCache.clear();\n+    this.isRequesting = false;\n+\n+    this.notifyChange();\n+  }\n+\n \n   // @@@ Check if we should send text for analysis\n   private checkAnalysisTrigger(text: string, _currentEnergy: number) {\n@@ -722,4 +762,4 @@ export class EditorEngine {\n // @@@ Helper to generate IDs\n function generateId(): string {\n   return `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n-}\n\\ No newline at end of file\n+}"
    },
    {
      "sha": "cb849157d466d2babeb19e150006feb641c6ada2",
      "filename": "frontend/src/i18n.ts",
      "status": "modified",
      "additions": 12,
      "deletions": 2,
      "changes": 14,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fi18n.ts",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/d7648abef143902c3abde6ab14cf53f343281547/frontend%2Fsrc%2Fi18n.ts",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fi18n.ts?ref=d7648abef143902c3abde6ab14cf53f343281547",
      "patch": "@@ -140,7 +140,11 @@ const resources = {\n           noMatches: 'No matches found',\n           close: 'Close',\n           personal: 'You',\n-          more: 'More'\n+          more: 'More',\n+          selfOnlyTitle: 'Just you today',\n+          selfOnlyHint: 'Pick a friend badge on the right to pull in their timeline beside yours.',\n+          friendEmptyTitle: 'No timeline yet',\n+          friendEmptyHint: 'This friend has not shared anything for these recent days.'\n         },\n         friendTimeline: {\n           loading: 'Loading friend timeline...',\n@@ -170,6 +174,7 @@ const resources = {\n         deleteConfirm: 'Delete this entry?',\n         entriesLabel_one: '{{count}} entry',\n         entriesLabel_other: '{{count}} entries',\n+        currentEntryLabel: 'Current note',\n         openButton: 'Open',\n         deleteButton: 'Delete',\n         close: 'Close',\n@@ -348,7 +353,11 @@ const resources = {\n           noMatches: '没有符合条件的好友',\n           close: '关闭',\n           personal: '仅自己',\n-          more: '更多'\n+          more: '更多',\n+          selfOnlyTitle: '只有你在这里',\n+          selfOnlyHint: '点右侧的好友圆标，就能把 TA 的时间线拉来并排浏览。',\n+          friendEmptyTitle: '最近没有内容',\n+          friendEmptyHint: '这位好友在最近几天都没有留下时间线。'\n         },\n         friendTimeline: {\n           loading: '正在加载好友时间线...',\n@@ -378,6 +387,7 @@ const resources = {\n         deleteConfirm: '确定删除这篇记录？',\n         entriesLabel_one: '{{count}} 篇',\n         entriesLabel_other: '{{count}} 篇',\n+        currentEntryLabel: '当前笔记',\n         openButton: '打开',\n         deleteButton: '删除',\n         close: '关闭',"
    }
  ]
}