{
  "sha": "62ab025479cd7c39442d80a1b62feebfe3d34620",
  "node_id": "C_kwDOP2Zrm9oAKDYyYWIwMjU0NzljZDdjMzk0NDJkODBhMWI2MmZlZWJmZTNkMzQ2MjA",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-10-30T01:34:38Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-10-30T01:34:38Z"
    },
    "message": "Refactor: Move hardcoded values to config and cleanup code\n\nBackend cleanup:\n- Move image generation API keys and endpoints to config.py\n- Extract magic numbers to named constants (timeouts, retry counts, max tokens)\n- Remove duplicate 'requests' import\n- Remove unused 'base64' import\n- Consolidate duplicate API key definitions\n- All hardcoded values now in config.IMAGE_* constants\n\nBenefits:\n- Single source of truth for configuration\n- Easier to modify timeouts and retry logic\n- Better code maintainability\n- Proxy functionality already integrated\n\nü§ñ Generated with Claude Code\n\nCo-Authored-By: Claude <noreply@anthropic.com>",
    "tree": {
      "sha": "401f6cf58aa6551da26a610145cfdb3c20c38f94",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/401f6cf58aa6551da26a610145cfdb3c20c38f94"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/62ab025479cd7c39442d80a1b62feebfe3d34620",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/62ab025479cd7c39442d80a1b62feebfe3d34620",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/62ab025479cd7c39442d80a1b62feebfe3d34620",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/62ab025479cd7c39442d80a1b62feebfe3d34620/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "ec1a90378ee9e0a84c842f2c084b8521cd2a757e",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/ec1a90378ee9e0a84c842f2c084b8521cd2a757e",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/ec1a90378ee9e0a84c842f2c084b8521cd2a757e"
    }
  ],
  "stats": {
    "total": 60,
    "additions": 31,
    "deletions": 29
  },
  "files": [
    {
      "sha": "f913ea0ff7f824553418f522eec5f41775adef44",
      "filename": "backend/config.py",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/62ab025479cd7c39442d80a1b62feebfe3d34620/backend%2Fconfig.py",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/62ab025479cd7c39442d80a1b62feebfe3d34620/backend%2Fconfig.py",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/backend%2Fconfig.py?ref=62ab025479cd7c39442d80a1b62feebfe3d34620",
      "patch": "@@ -8,6 +8,20 @@\n MIN_TEXT_LENGTH = 20\n SINGLE_COMMENT_MODE = True  # If True, only add 1 comment per request (gradual accumulation)\n \n+# @@@ Image generation configuration\n+IMAGE_API_KEY = \"sk-yz0JLc7sGbCHnwam70Bc9e29Dc684bAe904102C95dF32fB1\"\n+IMAGE_API_ENDPOINT = \"https://api.dou.chat/v1\"\n+IMAGE_DESCRIPTION_MODEL = \"anthropic/claude-haiku-4.5\"\n+IMAGE_GENERATION_MODEL = \"google/gemini-2.5-flash-image-preview\"\n+\n+# Retry configuration for image generation\n+IMAGE_RETRY_MAX_ATTEMPTS = 3\n+IMAGE_RETRY_BASE_TIMEOUT = 60  # First attempt: 60s, then +30s per retry\n+IMAGE_RETRY_TIMEOUT_INCREMENT = 30\n+IMAGE_MAX_TOKENS = 1000\n+IMAGE_DESCRIPTION_MAX_TOKENS = 500\n+IMAGE_DESCRIPTION_TIMEOUT = 30\n+\n # Voice archetypes (Disco Elysium skills adapted for general writing)\n VOICE_ARCHETYPES = {\n     \"Logic\": {"
    },
    {
      "sha": "0ea204e8aea9fe3726a1ca246483863d3334cbea",
      "filename": "backend/server.py",
      "status": "modified",
      "additions": 17,
      "deletions": 29,
      "changes": 46,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/62ab025479cd7c39442d80a1b62feebfe3d34620/backend%2Fserver.py",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/62ab025479cd7c39442d80a1b62feebfe3d34620/backend%2Fserver.py",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/backend%2Fserver.py?ref=62ab025479cd7c39442d80a1b62feebfe3d34620",
      "patch": "@@ -329,17 +329,8 @@ def generate_daily_picture(all_notes: str):\n     print(f\"{'='*60}\\n\")\n \n     import requests\n-    import base64\n-\n-    API_KEY = \"sk-yz0JLc7sGbCHnwam70Bc9e29Dc684bAe904102C95dF32fB1\"\n-    ENDPOINT = \"https://api.dou.chat/v1\"\n \n     # @@@ Step 1: Convert notes to artistic image description using Claude Haiku\n-    import requests as req\n-\n-    CLAUDE_API_KEY = \"sk-yz0JLc7sGbCHnwam70Bc9e29Dc684bAe904102C95dF32fB1\"\n-    CLAUDE_ENDPOINT = \"https://api.dou.chat/v1\"\n-    CLAUDE_MODEL = \"anthropic/claude-haiku-4.5\"\n \n     description_prompt = f\"\"\"Read these personal notes and create a vivid, artistic image description that captures the essence, mood, and themes.\n \n@@ -363,19 +354,19 @@ def generate_daily_picture(all_notes: str):\n     # @@@ Use proxy for GFW bypass (if configured)\n     proxies = get_image_api_proxies()\n \n-    claude_response = req.post(\n-        f\"{CLAUDE_ENDPOINT}/chat/completions\",\n+    claude_response = requests.post(\n+        f\"{config.IMAGE_API_ENDPOINT}/chat/completions\",\n         headers={\n-            \"Authorization\": f\"Bearer {CLAUDE_API_KEY}\",\n+            \"Authorization\": f\"Bearer {config.IMAGE_API_KEY}\",\n             \"Content-Type\": \"application/json\"\n         },\n         json={\n-            \"model\": CLAUDE_MODEL,\n+            \"model\": config.IMAGE_DESCRIPTION_MODEL,\n             \"messages\": [{\"role\": \"user\", \"content\": description_prompt}],\n-            \"max_tokens\": 500\n+            \"max_tokens\": config.IMAGE_DESCRIPTION_MAX_TOKENS\n         },\n         proxies=proxies,\n-        timeout=30\n+        timeout=config.IMAGE_DESCRIPTION_TIMEOUT\n     )\n \n     if claude_response.status_code != 200:\n@@ -390,36 +381,33 @@ def generate_daily_picture(all_notes: str):\n     print(f\"üìù Image description: {image_description}\")\n \n     # @@@ Step 2: Generate image from description with retry logic\n-    MODEL = \"google/gemini-2.5-flash-image-preview\"\n-\n-    url = f\"{ENDPOINT}/chat/completions\"\n+    url = f\"{config.IMAGE_API_ENDPOINT}/chat/completions\"\n     headers = {\n-        \"Authorization\": f\"Bearer {API_KEY}\",\n+        \"Authorization\": f\"Bearer {config.IMAGE_API_KEY}\",\n         \"Content-Type\": \"application/json\"\n     }\n \n     payload = {\n-        \"model\": MODEL,\n+        \"model\": config.IMAGE_GENERATION_MODEL,\n         \"messages\": [\n             {\n                 \"role\": \"user\",\n                 \"content\": image_description\n             }\n         ],\n-        \"max_tokens\": 1000\n+        \"max_tokens\": config.IMAGE_MAX_TOKENS\n     }\n \n-    # @@@ Retry logic: 3 attempts with increasing timeouts\n-    max_attempts = 3\n-    for attempt in range(1, max_attempts + 1):\n+    # @@@ Retry logic with increasing timeouts\n+    for attempt in range(1, config.IMAGE_RETRY_MAX_ATTEMPTS + 1):\n         try:\n-            timeout_seconds = 60 + (attempt - 1) * 30  # 60s, 90s, 120s\n-            print(f\"üé® Generating image (attempt {attempt}/{max_attempts}, timeout={timeout_seconds}s)...\")\n+            timeout_seconds = config.IMAGE_RETRY_BASE_TIMEOUT + (attempt - 1) * config.IMAGE_RETRY_TIMEOUT_INCREMENT\n+            print(f\"üé® Generating image (attempt {attempt}/{config.IMAGE_RETRY_MAX_ATTEMPTS}, timeout={timeout_seconds}s)...\")\n             response = requests.post(url, headers=headers, json=payload, proxies=proxies, timeout=timeout_seconds)\n \n             if response.status_code != 200:\n                 print(f\"‚ùå Error: {response.status_code}\")\n-                if attempt < max_attempts:\n+                if attempt < config.IMAGE_RETRY_MAX_ATTEMPTS:\n                     print(f\"‚è≥ Retrying in 2 seconds...\")\n                     import time\n                     time.sleep(2)\n@@ -448,7 +436,7 @@ def generate_daily_picture(all_notes: str):\n                             \"prompt\": image_description  # Return the creative description\n                         }\n \n-            if attempt < max_attempts:\n+            if attempt < config.IMAGE_RETRY_MAX_ATTEMPTS:\n                 print(f\"‚ö†Ô∏è No image in response, retrying...\")\n                 import time\n                 time.sleep(2)\n@@ -457,7 +445,7 @@ def generate_daily_picture(all_notes: str):\n \n         except Exception as e:\n             print(f\"‚ùå Exception on attempt {attempt}: {e}\")\n-            if attempt < max_attempts:\n+            if attempt < config.IMAGE_RETRY_MAX_ATTEMPTS:\n                 print(f\"‚è≥ Retrying in 2 seconds...\")\n                 import time\n                 time.sleep(2)"
    }
  ]
}