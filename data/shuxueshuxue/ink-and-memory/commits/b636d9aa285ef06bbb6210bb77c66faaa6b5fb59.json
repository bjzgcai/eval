{
  "sha": "b636d9aa285ef06bbb6210bb77c66faaa6b5fb59",
  "node_id": "C_kwDOP2Zrm9oAKGI2MzZkOWFhMjg1ZWYwNmJiYjYyMTBiYjc3YzY2ZmFhYTZiNWZiNTk",
  "commit": {
    "author": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-18T14:44:10Z"
    },
    "committer": {
      "name": "lexicalmathical",
      "email": "lexicalmathical@gmail.com",
      "date": "2025-11-18T14:44:10Z"
    },
    "message": "Fix deck icon picker z-index and update button colors\n\n- Use React portal to render deck icon picker at top level, preventing clipping\n- Change button colors to warmer, lighter tones (peach, soft blue, coral)\n- Add transparent overlay for click-outside to close picker",
    "tree": {
      "sha": "d99f75d362318e9c3fe9d1f5e598e7cf3a8c95a9",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/trees/d99f75d362318e9c3fe9d1f5e598e7cf3a8c95a9"
    },
    "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/git/commits/b636d9aa285ef06bbb6210bb77c66faaa6b5fb59",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null,
      "verified_at": null
    }
  },
  "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/b636d9aa285ef06bbb6210bb77c66faaa6b5fb59",
  "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/b636d9aa285ef06bbb6210bb77c66faaa6b5fb59",
  "comments_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/b636d9aa285ef06bbb6210bb77c66faaa6b5fb59/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "a5cc4b1a504ce90e7fe5ee48d8631e2ecccc8b40",
      "url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/commits/a5cc4b1a504ce90e7fe5ee48d8631e2ecccc8b40",
      "html_url": "https://github.com/shuxueshuxue/ink-and-memory/commit/a5cc4b1a504ce90e7fe5ee48d8631e2ecccc8b40"
    }
  ],
  "stats": {
    "total": 393,
    "additions": 305,
    "deletions": 88
  },
  "files": [
    {
      "sha": "657a660b3e442e6d9f7c5527ae7b520b2bd9bcf8",
      "filename": "frontend/src/components/DeckManager.tsx",
      "status": "modified",
      "additions": 305,
      "deletions": 88,
      "changes": 393,
      "blob_url": "https://github.com/shuxueshuxue/ink-and-memory/blob/b636d9aa285ef06bbb6210bb77c66faaa6b5fb59/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "raw_url": "https://github.com/shuxueshuxue/ink-and-memory/raw/b636d9aa285ef06bbb6210bb77c66faaa6b5fb59/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx",
      "contents_url": "https://api.github.com/repos/shuxueshuxue/ink-and-memory/contents/frontend%2Fsrc%2Fcomponents%2FDeckManager.tsx?ref=b636d9aa285ef06bbb6210bb77c66faaa6b5fb59",
      "patch": "@@ -1,4 +1,5 @@\n import { useState, useEffect, useRef } from 'react';\n+import { createPortal } from 'react-dom';\n import { useTranslation } from 'react-i18next';\n import {\n   listDecks,\n@@ -60,6 +61,9 @@ export default function DeckManager({ onUpdate }: Props) {\n   const [editingVoice, setEditingVoice] = useState<string | null>(null);\n   const [editingField, setEditingField] = useState<'name' | 'prompt' | null>(null);\n   const [iconPickerOpen, setIconPickerOpen] = useState<string | null>(null); // @@@ Track which voice's icon picker is open\n+  const [editingDeck, setEditingDeck] = useState<string | null>(null); // @@@ Track which deck is being edited\n+  const [deckEditingField, setDeckEditingField] = useState<'name' | 'description' | null>(null); // @@@ Track which deck field\n+  const [deckIconPickerOpen, setDeckIconPickerOpen] = useState<string | null>(null); // @@@ Track which deck's icon picker is open\n   const [creatingDeck, setCreatingDeck] = useState(false);\n   const [creatingVoice, setCreatingVoice] = useState<string | null>(null);\n   const [publishWarning, setPublishWarning] = useState<string | null>(null);\n@@ -149,6 +153,18 @@ export default function DeckManager({ onUpdate }: Props) {\n     }\n   }\n \n+  async function handleUpdateDeck(deckId: string, data: Partial<Deck>) {\n+    try {\n+      await updateDeck(deckId, data);\n+      await loadDecks(true);\n+      setEditingDeck(null);\n+      setDeckEditingField(null);\n+      onUpdate?.();\n+    } catch (err: any) {\n+      alert(`Failed to update deck: ${err.message}`);\n+    }\n+  }\n+\n   async function handleDeleteDeck(deckId: string) {\n     if (!confirm(t('deck.confirm.delete'))) return;\n \n@@ -333,44 +349,41 @@ export default function DeckManager({ onUpdate }: Props) {\n \n   return (\n     <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: '#f8f0e6', overflow: 'hidden' }}>\n-      {/* Fixed Header */}\n-      <div style={{\n-        padding: '24px 32px',\n-        background: '#f8f0e6',\n-        flexShrink: 0,\n-        borderBottom: '2px solid #d0c4b0'\n-      }}>\n-        <h1 style={{\n-          margin: 0,\n-          fontSize: 28,\n-          fontWeight: 700,\n-          color: '#2c2c2c',\n-          fontFamily: 'Georgia, serif',\n-          letterSpacing: '-0.5px'\n-        }}>\n-          {t('deck.heading')}\n-        </h1>\n-        <p style={{\n-          margin: '6px 0 0',\n-          fontSize: 14,\n-          color: '#666',\n-          fontStyle: 'italic'\n-        }}>\n-          {t('deck.subheading')}\n-        </p>\n-      </div>\n-\n-      {/* Scrollable Content */}\n+      {/* Scrollable Content with embedded header */}\n       <div ref={scrollContainerRef} style={{ flex: 1, overflowY: 'auto', padding: '32px' }}>\n         <div style={{ maxWidth: 1200, margin: '0 auto', display: 'flex', flexDirection: 'column', gap: 24 }}>\n+          {/* Embedded Header */}\n+          <div style={{\n+            padding: '0 0 24px 0',\n+            borderBottom: '2px solid #d0c4b0'\n+          }}>\n+            <h1 style={{\n+              margin: 0,\n+              fontSize: 28,\n+              fontWeight: 700,\n+              color: '#2c2c2c',\n+              fontFamily: 'Georgia, serif',\n+              letterSpacing: '-0.5px'\n+            }}>\n+              {t('deck.heading')}\n+            </h1>\n+            <p style={{\n+              margin: '6px 0 0',\n+              fontSize: 14,\n+              color: '#666',\n+              fontStyle: 'italic'\n+            }}>\n+              {t('deck.subheading')}\n+            </p>\n+          </div>\n           {/* Create New Deck Button */}\n           <button\n             onClick={handleCreateDeck}\n             disabled={creatingDeck}\n             style={{\n               padding: '12px 24px',\n               marginBottom: '8px',\n-              background: '#4a90e2',\n+              background: '#f9a875',\n               color: 'white',\n               border: 'none',\n               borderRadius: '8px',\n@@ -382,10 +395,10 @@ export default function DeckManager({ onUpdate }: Props) {\n               alignSelf: 'flex-start'\n             }}\n             onMouseEnter={(e) => {\n-              if (!creatingDeck) e.currentTarget.style.background = '#357abd';\n+              if (!creatingDeck) e.currentTarget.style.background = '#f89560';\n             }}\n             onMouseLeave={(e) => {\n-              if (!creatingDeck) e.currentTarget.style.background = '#4a90e2';\n+              if (!creatingDeck) e.currentTarget.style.background = '#f9a875';\n             }}\n           >\n             {creatingDeck ? t('deck.actions.creating') : t('deck.actions.create')}\n@@ -405,6 +418,7 @@ export default function DeckManager({ onUpdate }: Props) {\n           {decks.map(deck => {\n             const isExpanded = expandedDecks.has(deck.id);\n             const isSystem = !!deck.is_system; // @@@ Convert to boolean to prevent React from rendering \"0\"\n+            const isDeckEditing = editingDeck === deck.id;\n             const Icon = iconMap[deck.icon as keyof typeof iconMap] || FaBrain;\n             const colorHex = COLORS[deck.color as keyof typeof COLORS]?.hex || '#4a90e2';\n             const voiceCount = deck.voice_count || deck.voices?.length || 0;\n@@ -424,73 +438,276 @@ export default function DeckManager({ onUpdate }: Props) {\n               >\n                 {/* Deck Header */}\n                 <div\n-                  onClick={() => toggleDeck(deck.id)}\n                   style={{\n                     padding: 20,\n                     background: isSystem ? '#f9f9f9' : '#fafafa',\n-                    cursor: 'pointer',\n                     display: 'flex',\n                     alignItems: 'center',\n                     gap: 16,\n                     transition: 'background 0.2s'\n                   }}\n-                  onMouseEnter={(e) => {\n-                    e.currentTarget.style.background = isSystem ? '#f0f0f0' : '#f5f5f5';\n-                  }}\n-                  onMouseLeave={(e) => {\n-                    e.currentTarget.style.background = isSystem ? '#f9f9f9' : '#fafafa';\n-                  }}\n                 >\n                   {/* Expand/Collapse Icon */}\n-                  <div style={{ fontSize: 20, color: '#666' }}>\n+                  <div\n+                    onClick={() => toggleDeck(deck.id)}\n+                    style={{ fontSize: 20, color: '#666', cursor: 'pointer' }}\n+                  >\n                     {isExpanded ? <FaChevronDown /> : <FaChevronRight />}\n                   </div>\n \n-                  {/* Deck Icon */}\n-                  <div style={{\n-                    width: 56,\n-                    height: 56,\n-                    borderRadius: 28,\n-                    background: `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}cc 100%)`,\n-                    display: 'flex',\n-                    alignItems: 'center',\n-                    justifyContent: 'center',\n-                    color: '#fff',\n-                    flexShrink: 0,\n-                    boxShadow: `0 3px 8px ${colorHex}40`\n-                  }}>\n-                    <Icon size={28} />\n+                  {/* Deck Icon with picker */}\n+                  <div style={{ position: 'relative' }}>\n+                    <div\n+                      data-deck-icon={deck.id}\n+                      onClick={(e) => {\n+                        e.stopPropagation();\n+                        if (!isSystem) {\n+                          setDeckIconPickerOpen(deckIconPickerOpen === deck.id ? null : deck.id);\n+                        }\n+                      }}\n+                      style={{\n+                        width: 56,\n+                        height: 56,\n+                        borderRadius: 28,\n+                        background: `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}cc 100%)`,\n+                        display: 'flex',\n+                        alignItems: 'center',\n+                        justifyContent: 'center',\n+                        color: '#fff',\n+                        flexShrink: 0,\n+                        boxShadow: `0 3px 8px ${colorHex}40`,\n+                        cursor: isSystem ? 'default' : 'pointer',\n+                        transition: 'transform 0.2s, box-shadow 0.2s'\n+                      }}\n+                      onMouseEnter={(e) => {\n+                        if (!isSystem) {\n+                          e.currentTarget.style.transform = 'scale(1.1)';\n+                          e.currentTarget.style.boxShadow = `0 6px 16px ${colorHex}60`;\n+                        }\n+                      }}\n+                      onMouseLeave={(e) => {\n+                        if (!isSystem) {\n+                          e.currentTarget.style.transform = 'scale(1)';\n+                          e.currentTarget.style.boxShadow = `0 3px 8px ${colorHex}40`;\n+                        }\n+                      }}\n+                      title={isSystem ? '' : 'Click to change icon'}\n+                    >\n+                      <Icon size={28} />\n+                    </div>\n+\n+                    {/* Icon Picker Dropdown for Deck - Rendered at top level using portal */}\n+                    {deckIconPickerOpen === deck.id && (() => {\n+                      const iconBadge = document.querySelector(`[data-deck-icon=\"${deck.id}\"]`) as HTMLElement;\n+                      if (!iconBadge) return null;\n+                      const rect = iconBadge.getBoundingClientRect();\n+\n+                      return createPortal(\n+                        <>\n+                          {/* Transparent overlay to capture clicks outside */}\n+                          <div\n+                            onClick={() => setDeckIconPickerOpen(null)}\n+                            style={{\n+                              position: 'fixed',\n+                              top: 0,\n+                              left: 0,\n+                              right: 0,\n+                              bottom: 0,\n+                              zIndex: 9999\n+                            }}\n+                          />\n+                          {/* Icon picker dropdown */}\n+                          <div\n+                            style={{\n+                              position: 'fixed',\n+                              top: rect.bottom + 4,\n+                              left: rect.left,\n+                              background: '#fff',\n+                              border: '2px solid #4a90e2',\n+                              borderRadius: 8,\n+                              padding: 8,\n+                              boxShadow: '0 4px 16px rgba(0,0,0,0.2)',\n+                              zIndex: 10000,\n+                              display: 'grid',\n+                              gridTemplateColumns: 'repeat(4, 1fr)',\n+                              gap: 4,\n+                              minWidth: 180\n+                            }}\n+                          >\n+                            {Object.entries(iconMap).map(([iconName, IconComponent]) => {\n+                              const isSelected = deck.icon === iconName;\n+                              return (\n+                                <div\n+                                  key={iconName}\n+                                  onClick={(e) => {\n+                                    e.stopPropagation();\n+                                    handleUpdateDeck(deck.id, { icon: iconName });\n+                                    setDeckIconPickerOpen(null);\n+                                  }}\n+                                  style={{\n+                                    width: 40,\n+                                    height: 40,\n+                                    borderRadius: 8,\n+                                    background: isSelected ? colorHex : '#f0f0f0',\n+                                    display: 'flex',\n+                                    alignItems: 'center',\n+                                    justifyContent: 'center',\n+                                    color: isSelected ? '#fff' : '#666',\n+                                    cursor: 'pointer',\n+                                    transition: 'all 0.2s'\n+                                  }}\n+                                  onMouseEnter={(e) => {\n+                                    if (!isSelected) {\n+                                      e.currentTarget.style.background = '#e0e0e0';\n+                                      e.currentTarget.style.transform = 'scale(1.1)';\n+                                    }\n+                                  }}\n+                                  onMouseLeave={(e) => {\n+                                    if (!isSelected) {\n+                                      e.currentTarget.style.background = '#f0f0f0';\n+                                      e.currentTarget.style.transform = 'scale(1)';\n+                                    }\n+                                  }}\n+                                  title={iconName}\n+                                >\n+                                  <IconComponent size={20} />\n+                                </div>\n+                              );\n+                            })}\n+                          </div>\n+                        </>,\n+                        document.body\n+                      );\n+                    })()}\n                   </div>\n \n-                  {/* Deck Info */}\n+                  {/* Deck Info with inline editing */}\n                   <div style={{ flex: 1, minWidth: 0 }}>\n-                    <div style={{\n-                      fontSize: 20,\n-                      fontWeight: 700,\n-                      color: '#2c2c2c',\n-                      marginBottom: 4\n-                    }}>\n-                      {deck.name}\n-                      {isSystem && (\n-                        <span style={{\n-                          marginLeft: 12,\n-                          fontSize: 12,\n-                          fontWeight: 500,\n-                          color: '#888',\n-                          background: '#e0e0e0',\n-                          padding: '2px 8px',\n-                          borderRadius: 4\n-                        }}>\n-                          {t('deck.labels.system')}\n-                        </span>\n-                      )}\n-                    </div>\n-                    <div style={{\n-                      fontSize: 14,\n-                      color: '#666'\n-                    }}>\n-                      {deck.description || t('deck.labels.noDescription')}\n-                    </div>\n+                    {/* Deck Name */}\n+                    {!isDeckEditing || deckEditingField !== 'name' ? (\n+                      <div\n+                        onClick={(e) => {\n+                          e.stopPropagation();\n+                          if (!isSystem) {\n+                            setEditingDeck(deck.id);\n+                            setDeckEditingField('name');\n+                          }\n+                        }}\n+                        style={{\n+                          fontSize: 20,\n+                          fontWeight: 700,\n+                          color: '#2c2c2c',\n+                          marginBottom: 4,\n+                          cursor: isSystem ? 'default' : 'pointer',\n+                          transition: 'opacity 0.2s'\n+                        }}\n+                        onMouseEnter={(e) => {\n+                          if (!isSystem) e.currentTarget.style.opacity = '0.7';\n+                        }}\n+                        onMouseLeave={(e) => {\n+                          if (!isSystem) e.currentTarget.style.opacity = '1';\n+                        }}\n+                      >\n+                        {deck.name}\n+                        {isSystem && (\n+                          <span style={{\n+                            marginLeft: 12,\n+                            fontSize: 12,\n+                            fontWeight: 500,\n+                            color: '#888',\n+                            background: '#e0e0e0',\n+                            padding: '2px 8px',\n+                            borderRadius: 4\n+                          }}>\n+                            {t('deck.labels.system')}\n+                          </span>\n+                        )}\n+                      </div>\n+                    ) : (\n+                      <input\n+                        autoFocus\n+                        defaultValue={deck.name}\n+                        onClick={(e) => e.stopPropagation()}\n+                        onBlur={(e) => {\n+                          handleUpdateDeck(deck.id, { name: e.target.value });\n+                        }}\n+                        onKeyDown={(e) => {\n+                          if (e.key === 'Enter') {\n+                            e.currentTarget.blur();\n+                          } else if (e.key === 'Escape') {\n+                            setEditingDeck(null);\n+                            setDeckEditingField(null);\n+                          }\n+                        }}\n+                        style={{\n+                          width: '100%',\n+                          fontSize: 20,\n+                          fontWeight: 700,\n+                          color: '#2c2c2c',\n+                          padding: '4px 8px',\n+                          border: '2px solid #4a90e2',\n+                          borderRadius: 4,\n+                          background: '#f0f8ff',\n+                          marginBottom: 4\n+                        }}\n+                      />\n+                    )}\n+\n+                    {/* Deck Description */}\n+                    {!isDeckEditing || deckEditingField !== 'description' ? (\n+                      <div\n+                        onClick={(e) => {\n+                          e.stopPropagation();\n+                          if (!isSystem) {\n+                            setEditingDeck(deck.id);\n+                            setDeckEditingField('description');\n+                          }\n+                        }}\n+                        style={{\n+                          fontSize: 14,\n+                          color: '#666',\n+                          cursor: isSystem ? 'default' : 'pointer',\n+                          transition: 'opacity 0.2s'\n+                        }}\n+                        onMouseEnter={(e) => {\n+                          if (!isSystem) e.currentTarget.style.opacity = '0.7';\n+                        }}\n+                        onMouseLeave={(e) => {\n+                          if (!isSystem) e.currentTarget.style.opacity = '1';\n+                        }}\n+                      >\n+                        {deck.description || t('deck.labels.noDescription')}\n+                      </div>\n+                    ) : (\n+                      <textarea\n+                        autoFocus\n+                        defaultValue={deck.description || ''}\n+                        onClick={(e) => e.stopPropagation()}\n+                        onBlur={(e) => {\n+                          handleUpdateDeck(deck.id, { description: e.target.value });\n+                        }}\n+                        onKeyDown={(e) => {\n+                          if (e.key === 'Escape') {\n+                            setEditingDeck(null);\n+                            setDeckEditingField(null);\n+                          }\n+                        }}\n+                        style={{\n+                          width: '100%',\n+                          minHeight: '60px',\n+                          fontSize: 14,\n+                          color: '#666',\n+                          padding: '6px 8px',\n+                          border: '2px solid #4a90e2',\n+                          borderRadius: 4,\n+                          background: '#f0f8ff',\n+                          fontFamily: 'inherit',\n+                          resize: 'vertical',\n+                          boxSizing: 'border-box'\n+                        }}\n+                      />\n+                    )}\n+\n                     <div style={{\n                       fontSize: 12,\n                       color: '#999',\n@@ -563,7 +780,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                             onClick={() => handleSyncDeck(deck.id)}\n                             style={{\n                               padding: '8px 16px',\n-                              background: '#3498db',\n+                              background: '#81b7d2',\n                               color: '#fff',\n                               border: 'none',\n                               borderRadius: 6,\n@@ -574,7 +791,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                             }}\n                             onMouseEnter={(e) => {\n                               e.currentTarget.style.transform = 'translateY(-1px)';\n-                              e.currentTarget.style.boxShadow = '0 4px 12px rgba(52, 152, 219, 0.4)';\n+                              e.currentTarget.style.boxShadow = '0 4px 12px rgba(129, 183, 210, 0.4)';\n                             }}\n                             onMouseLeave={(e) => {\n                               e.currentTarget.style.transform = 'translateY(0)';\n@@ -589,7 +806,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                           onClick={() => handlePublishClick(deck)}\n                           style={{\n                             padding: '8px 16px',\n-                            background: deck.published ? '#e74c3c' : '#9b59b6',\n+                            background: deck.published ? '#f39c7a' : '#b47ed7',\n                             color: '#fff',\n                             border: 'none',\n                             borderRadius: 6,\n@@ -600,7 +817,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                           }}\n                           onMouseEnter={(e) => {\n                             e.currentTarget.style.transform = 'translateY(-1px)';\n-                            const color = deck.published ? 'rgba(231, 76, 60, 0.4)' : 'rgba(155, 89, 182, 0.4)';\n+                            const color = deck.published ? 'rgba(243, 156, 122, 0.4)' : 'rgba(180, 126, 215, 0.4)';\n                             e.currentTarget.style.boxShadow = `0 4px 12px ${color}`;\n                           }}\n                           onMouseLeave={(e) => {\n@@ -614,7 +831,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                           onClick={() => handleDeleteDeck(deck.id)}\n                           style={{\n                             padding: '8px 16px',\n-                            background: '#e74c3c',\n+                            background: '#e8956c',\n                             color: '#fff',\n                             border: 'none',\n                             borderRadius: 6,\n@@ -625,7 +842,7 @@ export default function DeckManager({ onUpdate }: Props) {\n                           }}\n                           onMouseEnter={(e) => {\n                             e.currentTarget.style.transform = 'translateY(-1px)';\n-                            e.currentTarget.style.boxShadow = '0 4px 12px rgba(231, 76, 60, 0.4)';\n+                            e.currentTarget.style.boxShadow = '0 4px 12px rgba(232, 149, 108, 0.4)';\n                           }}\n                           onMouseLeave={(e) => {\n                             e.currentTarget.style.transform = 'translateY(0)';"
    }
  ]
}